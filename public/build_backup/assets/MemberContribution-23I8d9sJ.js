import{r as d,s as y,f as a,o as i,b as e,F as A,G as T,n as O,u as b,t as n,W as F,l as W,j as Y,e as S,J as q,x as G,a as I,g as H,w as J,h as U,i as z,D as K,N as Q,I as X,d as Z}from"./app-CV9WLblb.js";import{_ as ee}from"./not_found-DvAnRRcV.js";import{C as te}from"./CollectorLayout-DN7CMljN.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as oe}from"./ToggleContribution-COPnNeBq.js";import{h as se}from"./html2pdf-DTrJQ22S.js";import"./logo1-BZ0h4foK.js";const le={class:"d-flex flex-row justify-content-between align-items-center px-0"},ne=["onClick"],ae={__name:"PurokComponentForCollector",props:{activePurok:{type:String,default:()=>""},deceasedId:{type:Number,default:()=>0}},setup(x){const u=x;let c=d("");y(()=>u.activePurok,f=>{c.value=f},{immediate:!0});const _=["purok1","purok2","purok3","purok4"],h=f=>{F.get(route("collectorContribution.togglePurok",{purok:f,deceasedId:u.deceasedId}),{onSuccess:()=>console.log("changing purok"),onError:p=>console.log("An error occured: ",p)})};return(f,p)=>(i(),a("div",le,[e("div",null,[(i(),a(A,null,T(_,k=>e("span",{key:k,class:O(["mx-2 purok",{"fw-bold active":k===b(c)}]),onClick:g=>h(k)},n(k),11,ne)),64))]),e("div",{class:O(["mx-2 purok",{"fw-bold active":b(c)=="all"}]),onClick:p[0]||(p[0]=k=>h("all"))}," All members ",2)]))}},ie=V(ae,[["__scopeId","data-v-2017e254"]]),re={class:"header"},de={class:"deceased-name"},ue={class:"fw-light"},ce={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},be={class:"fw-bold"},pe={class:"fw-bold"},ve={class:"table-container"},_e={class:"members-table"},fe={class:"total-amount"},ke={__name:"ViewAsCollector",props:{deceased:{type:Object,default:()=>({})},purok:String},setup(x){const u=x,c=d([]),_=d(null),h=d({}),f=d(""),p=d(!1),k=async(r,s)=>{if(!(!r||!s))try{console.log("id: ",r),console.log("purok: ",s),p.value=!0;const v=await q.get(`/collector/contributions/${r}/${s}`);c.value=v.data.contributions||[],console.log(" Contributions fetched:",c.value)}catch(v){console.error(" Error fetching contributions:",v)}finally{p.value=!1}};y([()=>u.purok],([r])=>{f.value=r},{immediate:!1}),y(()=>u.deceased,r=>{h.value=r,console.log("deceased: ",h.value)},{immediate:!0}),W(()=>{var r;(r=u.deceased)!=null&&r.member_id&&u.purok&&k(u.deceased.member_id,u.purok)});const g=Y(()=>c.value.reduce((r,s)=>r+parseFloat(s.amount||0),0)),m=()=>{const r=_.value,s={filename:"Contributions_Report.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};se().from(r).set(s).save()};return(r,s)=>{var v,w,M,E,N;return i(),a(A,null,[e("button",{onClick:m,class:"download-btn btn btn-dark px-3 ms-2",title:"Download PDF"},s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:`M12 3a1 1 0 011 1v9.586l3.293-3.293a1 1 0 011.414 1.414l-5 
        5a1 1 0 01-1.414 0l-5-5a1 1 0 
        011.414-1.414L11 13.586V4a1 1 0 011-1zm-7 
        14a1 1 0 100 2h14a1 1 0 100-2H5z`})],-1)])),e("div",{ref_key:"pdfContent",ref:_,class:"document-container"},[e("div",re,[s[3]||(s[3]=e("div",{class:"organization-name"},"BULAN P.R.O.T.E.C DAMAYAN FEDERATION",-1)),s[4]||(s[4]=e("div",{class:"organization-subtitle"},"(People's Responsible Organization Transforming Community)",-1)),s[5]||(s[5]=e("div",{class:"chapter-info fst-italic"},"Affiliated Bulan, Sorsogon Chapter Brgy. ______ C.Y 2021",-1)),s[6]||(s[6]=e("div",{class:"established fst-italic"},"Since 2016",-1)),e("div",de,[s[1]||(s[1]=S(" Deceased Name: ")),s[2]||(s[2]=e("br",null,null,-1)),e("p",ue,n(((v=h.value)==null?void 0:v.deceased_name)||""),1)])]),e("div",ce,[e("div",null,[s[7]||(s[7]=S(" Collector Name: ")),e("span",be,n(((w=c.value[0])==null?void 0:w.collector)||""),1)]),e("div",null,[s[8]||(s[8]=S(" Purok: ")),e("span",pe,n(((N=c.value[0])==null?void 0:N.purok.charAt(((E=(M=c.value[0])==null?void 0:M.purok)==null?void 0:E.length)-1))||""),1)])]),e("div",ve,[s[10]||(s[10]=e("div",{class:"mb-3"},[e("strong",null,"MEMBERS")],-1)),e("table",_e,[s[9]||(s[9]=e("thead",null,[e("tr",null,[e("th",null,"No."),e("th",null,"NAME"),e("th",null,"STATUS"),e("th",null,"AMOUNT")])],-1)),e("tbody",null,[(i(!0),a(A,null,T(c.value,(C,D)=>{var P,L;return i(),a("tr",{key:D},[e("td",null,n(D+1),1),e("td",null,n(((P=C==null?void 0:C.member_contribution)==null?void 0:P.first_name)||"Member")+" "+n(((L=C==null?void 0:C.member_contribution)==null?void 0:L.last_name)||""),1),e("td",null,n(C.status),1),e("td",null,"₱"+n(Math.floor(C.amount).toLocaleString()),1)])}),128))])]),e("div",fe," TOTAL AMOUNT: ₱"+n(g.value.toLocaleString()),1)]),s[11]||(s[11]=e("div",{class:"signature"},[e("div",null,"Noted By:"),e("div",{class:"president-name"},"Melva Canale Delariarte"),e("div",null,"DAMAYAN PRESIDENT")],-1))],512)],64)}}},ge=V(ke,[["__scopeId","data-v-7322785c"]]),Ce={class:"container main-container"},ye={class:"bg-light p-2 pt-0"},he={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},we={class:"mt-3 mb-3 search-container"},Me={class:"mt-5"},Ae={key:0,class:"table-wrapper mt-3 desktop-view"},me={class:"table-responsive"},Pe={class:"table table-bordered table-hover align-middle text-center mb-0"},Se={class:"text-start"},xe=["onClick"],Ne=["onClick"],De={key:1,class:"mobile-view"},$e={class:"mobile-cards-container"},Ie={class:"mobile-card-header"},Te={class:"mobile-member-id"},Ee={class:"mobile-purok"},Le={class:"mobile-card-body"},Oe={class:"mobile-field"},Re={class:"mobile-value"},je={class:"mobile-field"},Fe={class:"mobile-value"},Ve={class:"mobile-actions"},Be=["onClick"],Ue=["onClick"],ze={key:2,class:"container mt-4 text-center"},Ye={class:"fw-light"},We={class:"text-success"},qe={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Ge={class:"modal-dialog"},He={class:"modal-content"},Je={class:"modal-body"},Ke=["value"],Qe={class:"modal-footer"},Xe=["disabled"],Ze={class:"custom-modal"},et={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(x){const u=x;let c=d([]),_=d(""),h=d([]),f=d([]),p=d(null),k=d(""),g=d(""),m=d({});const r=d([]),s=d({});y(()=>u.member,l=>c.value=l,{immediate:!0}),y(()=>u.selectedPurok,l=>_.value=l,{immediate:!0}),y(()=>u.collectors,l=>h.value=l,{immediate:!0}),y(()=>u.paidMembersId,l=>f.value=l,{immediate:!0}),y(()=>u.currentCollector,l=>{m.value=l},{immediate:!0}),y(()=>u.currentDeceasedMembers,l=>{r.value=l?Object.values(l):[]},{immediate:!0}),y(()=>u.currentDeceasedMember,l=>{s.value=l,console.log("current deceased: ",s.value)},{immediate:!0});const v=d(""),w=Y(()=>{if(!v.value.trim())return c.value;const l=v.value.toLowerCase();return c.value.filter(o=>o.first_name&&o.first_name.toLowerCase().includes(l)||o.last_name&&o.last_name.toLowerCase().includes(l)||o.middle_name&&o.middle_name.toLowerCase().includes(l)||o.contact_number&&o.contact_number.toLowerCase().includes(l)||o.purok&&o.purok.toLowerCase().includes(l))}),M=G({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),E=l=>l?l.toLowerCase().replace(/\s+/g,""):"",N=(l,o,t)=>{p.value=l,k.value=o,g.value="",F.post(route("smsNotification.sendScheduleContribution"),{id:l,message:"Successfully paid.",contact_number:t,collector:m.value.name,purok:o,deceasedId:s.value.member_id||null},{onSuccess:()=>alert("Schedule Contribution sent successfully!"),onError:()=>alert("Error sending Schedule Contribution")})},C=()=>{M.member_id=p.value,M.purok=E(k.value),M.collector=g.value,M.post(route("contributions.store"),{onSuccess:()=>{const l=c.value.find(o=>o.id===p.value);l&&(l.paid=!0)}})},D=l=>{const o=c.value.find(t=>t.id===l);o&&(o.paid=!1,F.delete(route("collectorContribution.deleteContribution",l),{onSuccess:()=>{alert("Member marked as unpaid successfully.")},onError:()=>{alert("An error occurred, please try again.")}}))},P=d(!1),L=()=>{P.value=!0},B=()=>{P.value=!1};return(l,o)=>(i(),a(A,null,[I(b(H),{title:"Member contribution"}),I(te,null,{default:J(()=>[e("div",Ce,[e("div",ye,[e("div",he,[o[3]||(o[3]=e("div",{class:"page-title"},[e("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),e("div",we,[z(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>v.value=t),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[K,v.value]])])]),I(ie,{activePurok:b(_),deceasedId:s.value.member_id},null,8,["activePurok","deceasedId"]),e("div",Me,[I(oe,{allDeceased:r.value,purok:b(_),data:s.value,deceased:s.value,"onUpdate:deceased":o[1]||(o[1]=t=>s.value=t)},null,8,["allDeceased","purok","data","deceased"])]),e("div",{class:"action-buttons"},[e("button",{class:"btn btn-dark view-report",onClick:L},"View Reports")]),w.value.length>0?(i(),a("div",Ae,[e("div",me,[e("table",Pe,[o[5]||(o[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ID"),e("th",null,"NAME"),e("th",null,"CONTACT NO."),e("th",null,"PUROK"),e("th",null,"STATUS")])],-1)),e("tbody",null,[(i(!0),a(A,null,T(w.value,(t,R)=>{var $;return i(),a("tr",{key:R},[e("td",null,n(t==null?void 0:t.id),1),e("td",Se,n(t==null?void 0:t.first_name)+" "+n(t==null?void 0:t.middle_name)+" "+n(t==null?void 0:t.last_name),1),e("td",null,n((t==null?void 0:t.contact_number)||"undefined"),1),e("td",null,n((t==null?void 0:t.purok)||"N/A"),1),e("td",null,[(b(f)||[]).includes(t==null?void 0:t.id)?(i(),a("button",{key:1,class:"btn btn-success",onClick:j=>D(t.id),title:"Mark member as unpaid"},o[4]||(o[4]=[e("i",{class:"bi bi-check-lg"},null,-1)]),8,Ne)):(i(),a("button",{key:0,class:O(["btn btn-danger",{disabled:t.purok.slice(-1)!==(($=b(m))==null?void 0:$.purok)}]),onClick:j=>N(t.id,t.purok,t.contact_number),title:"Mark member as paid"}," Paid ",10,xe))])])}),128))])])])])):U("",!0),w.value.length>0?(i(),a("div",De,[e("div",$e,[(i(!0),a(A,null,T(w.value,(t,R)=>{var $;return i(),a("div",{class:"mobile-card",key:R},[e("div",Ie,[e("div",Te,"ID: "+n(t==null?void 0:t.id),1),e("div",Ee,n((t==null?void 0:t.purok)||"N/A"),1)]),e("div",Le,[e("div",Oe,[o[6]||(o[6]=e("label",null,"Name:",-1)),e("span",Re,n(t==null?void 0:t.first_name)+" "+n(t==null?void 0:t.middle_name)+" "+n(t==null?void 0:t.last_name),1)]),e("div",je,[o[7]||(o[7]=e("label",null,"Contact:",-1)),e("span",Fe,n((t==null?void 0:t.contact_number)||"undefined"),1)]),e("div",Ve,[(b(f)||[]).includes(t==null?void 0:t.id)?(i(),a("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:j=>D(t.id),title:"Mark member as unpaid"},o[8]||(o[8]=[e("i",{class:"bi bi-check-lg"},null,-1),S(" Paid ")]),8,Ue)):(i(),a("button",{key:0,class:O(["btn btn-danger btn-sm mobile-pay-btn",{disabled:t.purok.slice(-1)!==(($=b(m))==null?void 0:$.purok)}]),onClick:j=>N(t.id,t.purok,t.contact_number),title:"Mark member as paid"}," Mark as Paid ",10,Be))])])])}),128))])])):(i(),a("div",ze,[o[11]||(o[11]=e("img",{src:ee,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),e("h5",Ye,[o[9]||(o[9]=S(" No contribution found for ")),e("span",We,n(b(_)||"N/A"),1),o[10]||(o[10]=S(". "))])]))])]),o[15]||(o[15]=e("div",{class:"container extra-space bg-dark"},null,-1)),e("div",qe,[e("div",Ge,[e("div",He,[o[14]||(o[14]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Select Collector"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Je,[z(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>Q(g)?g.value=t:g=t),class:"form-select"},[o[12]||(o[12]=e("option",{value:"",disabled:""},"Select collector",-1)),(i(!0),a(A,null,T(b(h),t=>(i(),a("option",{key:t.id,value:t.name},n(t.name),9,Ke))),128))],512),[[X,b(g)]])]),e("div",Qe,[o[13]||(o[13]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:C,disabled:!b(g),"data-bs-dismiss":"modal"}," Done ",8,Xe)])])])]),P.value?(i(),a("div",{key:0,class:"custom-modal-overlay",onClick:Z(B,["self"])},[e("div",Ze,[e("button",{class:"close-btn",onClick:B},"×"),I(ge,{deceased:s.value,purok:b(_)},null,8,["deceased","purok"])])])):U("",!0)]),_:1})],64))}},rt=V(et,[["__scopeId","data-v-bf3e0be6"]]);export{rt as default};
