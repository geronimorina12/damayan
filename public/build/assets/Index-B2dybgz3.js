import{C as R}from"./CollectorLayout-9oLTOnIg.js";import{r as i,s as m,f as _,o as f,b as e,t as k,u as g,j as S,n as P,i as T,h as A,D as U,F as N,G as w,W as C,M as j,C as F,a as M,g as L,w as O}from"./app-DKMPW3fR.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";const E={class:"table-wrapper mt-3"},B={class:"container-fluid header-container"},V={class:"table"},H={class:"tbody"},K={style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},W={class:"bg-light"},q={class:"bg-light"},z={class:"bg-light"},G={class:"bg-light"},Q={class:"bg-light"},J={__name:"SubHeaderForCollectorReport",props:{membersCount:{type:Number,default:0},amount:{type:Number,default:0},activePurok:{type:String,default:""},paidMembers:{type:Number,default:0},unpaidMembers:{type:Number,default:0}},setup(y){const t=y;let p=i(0),c=i(0),d=i(""),b=i(""),v=i("");return m(()=>t.amount,n=>{c.value=n},{immediate:!0}),m(()=>t.membersCount,n=>{p.value=n},{immediate:!0}),m(()=>t.activePurok,n=>{d.value=n},{immediate:!0}),m(()=>t.paidMembers,n=>{b.value=c.value/100},{immediate:!0}),m(()=>t.unpaidMembers,n=>{v.value=n.toString()+(n===1?" Member":" Members")},{immediate:!0}),(n,u)=>(f(),_("div",E,[e("div",B,[e("table",V,[u[0]||(u[0]=e("thead",{class:"thead"},[e("tr",{style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},[e("td",{class:"bg-light"},"MEMBERS"),e("td",{class:"bg-light"},"AMOUNT"),e("td",{class:"bg-light"},"PUROK"),e("td",{class:"bg-light"},"PAID"),e("td",{class:"bg-light"},"UNPAID")])],-1)),e("tbody",H,[e("tr",K,[e("td",W,k(g(p))+" Members",1),e("td",q,k(g(c)),1),e("td",z,k(g(d)[5]||"All"),1),e("td",G,k(g(b)),1),e("td",Q,k(g(p)-g(b)),1)])])])])]))}},X=D(J,[["__scopeId","data-v-565aad73"]]),Y={class:"container-fluid d-flex gap-3 align-items-center mb-3 justify-content-between"},Z={class:"d-flex gap-3"},ee={class:"search-box position-relative"},te={key:0,class:"spinner-border text-primary spinner-sm position-absolute end-0 top-50 translate-middle-y me-3",role:"status"},se={class:"table-responsive table-container"},ae={key:0,class:"table"},re={class:"bg-light"},le={class:"bg-light"},oe={class:"bg-light"},ne={class:"bg-light text-center"},ie={key:0,class:"bg-success rounded px-2 py-1 text-light"},ue={key:1,class:"bg-danger rounded px-2 py-1 text-light"},de={key:1,class:"text-center p-3"},ce={__name:"ReportTable",props:{activeStatus:{type:String,default:"paid"},activePurok:{type:String,default:"all"},members:{type:Array,default:()=>[]},contributionsIds:{type:Array,default:()=>[]}},setup(y){const t=y,p=i([]),c=S(()=>t.activePurok),d=i(t.activeStatus),b=i(""),v=i(!1),n=()=>{d.value==="paid"?p.value=t.members.filter(r=>t.contributionsIds.includes(r.id)):d.value==="not_paid"?p.value=t.members.filter(r=>!t.contributionsIds.includes(r.id)):p.value=t.members},u=S(()=>{const r=b.value.trim().toLowerCase();return r?p.value.filter(l=>{var I,$;const s=`${l.first_name} ${l.middle_name||""} ${l.last_name}`.toLowerCase(),h=((I=l.contact_number)==null?void 0:I.toLowerCase())||"",x=(($=l.purok)==null?void 0:$.toLowerCase())||"";return s.includes(r)||h.includes(r)||x.includes(r)}):p.value});let o;m(b,()=>{v.value=!0,clearTimeout(o),o=setTimeout(()=>{v.value=!1},400)}),m(()=>[t.members,d.value],()=>{n()},{immediate:!0,deep:!0});const a=r=>{if(console.log("Status:",r),console.log("Purok:",c.value),d.value=r,c.value==="all"){n();return}C.get(route("collector.toggleStatus",{status:r,purok:c.value}),{},{preserveState:!0,replace:!0})};return(r,l)=>(f(),_("div",null,[e("div",Y,[e("div",Z,[e("h5",{class:P(["choice",{"text-success":d.value==="paid"}]),onClick:l[0]||(l[0]=s=>a("paid"))}," PAID ",2),e("h5",{class:P(["choice",{"text-success":d.value==="not_paid"}]),onClick:l[1]||(l[1]=s=>a("not_paid"))}," UNPAID ",2)]),e("div",ee,[T(e("input",{type:"text",class:"form-control",placeholder:"Search by name, contact, or purok...","onUpdate:modelValue":l[2]||(l[2]=s=>b.value=s)},null,512),[[U,b.value]]),v.value?(f(),_("div",te,l[3]||(l[3]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):A("",!0)])]),e("div",se,[u.value.length>0?(f(),_("table",ae,[l[4]||(l[4]=e("thead",null,[e("tr",null,[e("th",{class:"bg-light"},"NAME"),e("th",{class:"bg-light"},"CONTACT"),e("th",{class:"bg-light"},"PUROK"),e("th",{class:"bg-light"},"STATUS")])],-1)),e("tbody",null,[(f(!0),_(N,null,w(u.value,s=>(f(),_("tr",{key:s.id},[e("td",re,k(s.first_name)+" "+k(s.middle_name)+" "+k(s.last_name),1),e("td",le,k(s.contact_number),1),e("td",oe,k(s.purok),1),e("td",ne,[t.contributionsIds.includes(s.id)?(f(),_("span",ie," paid ")):(f(),_("span",ue," unpaid "))])]))),128))])])):(f(),_("div",de,l[5]||(l[5]=[e("p",{class:"text-muted"},"No members found.",-1)])))])]))}},me=D(ce,[["__scopeId","data-v-2c72293c"]]),pe={class:"d-flex flex-row justify-content-between align-items-center px-0"},be=["onClick"],ge={__name:"PurokComponentForCollectorReport",props:{activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},deceasedId:{type:Number,default:()=>0}},setup(y){const t=y;let p=i(""),c=i("all"),d=i(0);m(()=>t.activePurok,u=>{c.value=u},{immediate:!0}),m(()=>t.activeStatus,u=>{p.value=u},{immediate:!0}),m(()=>t.deceasedId,u=>{d.value=u},{immediate:!0});const b=["purok1","purok2","purok3","purok4"],v=u=>{C.get(route("collector.togglePurok",{status:p.value,purok:u,deceasedId:d.value}),{onSuccess:()=>console.log("changing purok"),onError:o=>console.log("An error occured: ",o)})},n=u=>`Purok ${u.replace("purok","")}`;return(u,o)=>(f(),_("div",pe,[e("div",null,[(f(),_(N,null,w(b,a=>e("span",{key:a,class:P(["mx-2 purok",{"fw-bold active":a===g(c)}]),onClick:r=>v(a)},k(n(a)),11,be)),64))])]))}},ve=D(ge,[["__scopeId","data-v-7d1eccef"]]),_e={class:"d-flex flex-column align-items-center",style:{height:"120px"}},fe={class:"d-flex align-items-center gap-4"},he={class:"fw-bold text-dark mb-0"},ke={__name:"Toggle",props:j({data:{type:Object,default:()=>({})},allDeceased:{type:Array,default:()=>[]},purok:{type:String,default:()=>""}},{deceased:{},deceasedModifiers:{}}),emits:["update:deceased"],setup(y){const t=y,p=i(t.data.report_id??null);i(t.data.member_id??null);const c=F(y,"deceased"),d=S(()=>t.allDeceased.findIndex(o=>Number(o.report_id)===Number(p.value)));function b(o){var l;if(!t.allDeceased.length)return-1;const a=t.allDeceased.length,r=(l=t.allDeceased[o])==null?void 0:l.member_id;for(let s=1;s<=a;s++){const h=(o+s)%a,x=t.allDeceased[h];if(x&&String(x.member_id)!==String(r))return h}return-1}function v(o){var l;if(!t.allDeceased.length)return-1;const a=t.allDeceased.length,r=(l=t.allDeceased[o])==null?void 0:l.member_id;for(let s=1;s<=a;s++){const h=(o-s+a)%a,x=t.allDeceased[h];if(x&&String(x.member_id)!==String(r))return h}return-1}const n=()=>{const o=d.value;if(o===-1)return;const a=v(o);if(a===-1)return;const r=t.allDeceased[a];r&&C.get(route("collector.toggleDeceased",{id:r.member_id,purok:t.purok}),{},{preserveScroll:!0})},u=()=>{const o=d.value;if(o===-1)return;const a=b(o);if(a===-1)return;const r=t.allDeceased[a];r&&(c.value=r,console.log("deceased_id: ",r.member_id),console.log("deceased_id: ",t.purok),C.get(route("collector.toggleDeceased",{id:r.member_id,purok:t.purok}),{},{preserveScroll:!0}))};return(o,a)=>(f(),_("div",_e,[a[2]||(a[2]=e("h5",{class:"mb-3"},"This contribution belongs to:",-1)),e("div",fe,[e("button",{onClick:n,class:"btn btn-light rounded-circle shadow-sm"},a[0]||(a[0]=[e("i",{class:"bi bi-arrow-left fs-4"},null,-1)])),e("h5",he,k(t.data.deceased_name||"No name available"),1),e("button",{onClick:u,class:"btn btn-light rounded-circle shadow-sm"},a[1]||(a[1]=[e("i",{class:"bi bi-arrow-right fs-4"},null,-1)]))])]))}},ye={key:0,class:"mt-3"},xe={class:"purok-container container-fluid d-flex justify-content-end align-items-center"},De={__name:"Index",props:{contributions:{type:Array,default:()=>[]},activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},contributionsIds:{type:Array,default:()=>[]},members:{type:Array,default:()=>[]},currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(y){const t=y;let p=i([]),c=i("all"),d=i(0),b=i("paid"),v=i([]);const n=i([]),u=i([]),o=i({});m(()=>t.contributions,s=>{p.value=s,d.value=parseInt(s.reduce((h,x)=>h+parseFloat(x.amount),0))},{immediate:!0}),m(()=>t.activePurok,s=>{c.value=s},{immediate:!0}),m(()=>t.activeStatus,s=>{b.value=s},{immediate:!0}),m(()=>t.contributionsIds,s=>{v.value=Array.isArray(s)?[...s]:[]},{immediate:!0}),m(()=>t.members,s=>{n.value=s},{immediate:!0}),m(()=>t.currentDeceasedMembers,s=>{u.value=s?Object.values(s):[]},{immediate:!0}),m(()=>t.currentDeceasedMember,s=>{o.value=s},{immediate:!0});const a=S(()=>n.value.filter(s=>v.value.includes(s.id)).length),r=S(()=>n.value.filter(s=>!v.value.includes(s.id)).length),l=S(()=>n.value.length);return(s,h)=>(f(),_("div",null,[M(g(L),{title:"Report"}),M(R,null,{default:O(()=>[h[0]||(h[0]=e("div",{class:"head container"},[e("h5",{class:"mb-0"},"Report"),e("p",{class:"d-none d-lg-block"},"Contribution Report")],-1)),o.value?(f(),_("div",ye,[M(ke,{allDeceased:u.value,data:o.value,purok:g(c)},null,8,["allDeceased","data","purok"])])):A("",!0),e("div",xe,[M(ve,{activePurok:g(c),activeStatus:g(b),deceasedId:o.value.member_id},null,8,["activePurok","activeStatus","deceasedId"])]),M(X,{membersCount:l.value,amount:Number(g(d)),activePurok:g(c),paidMembers:a.value,unpaidMembers:r.value},null,8,["membersCount","amount","activePurok","paidMembers","unpaidMembers"]),M(me,{activeStatus:g(b),contributionsIds:g(v),members:n.value},null,8,["activeStatus","contributionsIds","members"])]),_:1})]))}};export{De as default};
