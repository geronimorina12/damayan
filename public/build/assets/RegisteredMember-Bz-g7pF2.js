import{q as ue,r as m,j as G,x as Z,s as I,C as ce,f as i,o as u,b as e,h as S,e as F,t as f,d as R,i as $,D as x,u as a,n as P,I as H,E as ae,F as W,G as Y,l as ee,J as te,a as E,w as O,T as X,S as Q,W as J,m as me,g as ve,K as be,z as pe}from"./app-Dn18HhzK.js";import{A as fe}from"./AdminLayout-DcOACJ-d.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";const ne=ue("modalStore",()=>{const B=m(!1);return{closeAddMemberModal:B,triggerCloseMemberModal:()=>{B.value=!0},resetModal:()=>{B.value=!1}}}),ge={class:"container-fluid d-flex flex-row justify-content-center main-container"},ye={class:"container mt-5"},_e={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},he={class:"row g-3"},$e={class:"col-md-6"},ke={class:"col-md-6"},we=["max"],Me={key:0,class:"invalid-feedback d-block"},xe={class:"col-md-6"},Ce={class:"col-md-6"},Se={class:"col-md-6"},Ae={class:"col-md-6"},Ne={class:"col-md-6"},Be={class:"col-md-6"},Ve={class:"col-md-6"},Ee={class:"col-md-6"},Ue={key:0,class:"text-danger small mt-1"},De={class:"col-12"},Ie={class:"mt-4"},Te={key:0,class:"text-center mt-3 text-muted"},Le={key:1,class:"table-responsive mt-2"},Fe={class:"table table-bordered table-striped align-middle"},qe=["onClick"],Re={class:"d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 gap-3"},Oe={key:1,class:"card mt-4 p-3 shadow-sm"},Pe={class:"col-md-6"},je={class:"col-md-6"},He={class:"col-md-6"},We={class:"col-md-6"},ze={key:0,class:"invalid-feedback d-block"},Ge={class:"col-12 d-flex justify-content-end gap-2 mt-3"},Ye=["disabled"],Ke={__name:"AddNewMember",props:{show:{},showModifiers:{}},emits:["update:show"],setup(B){const c=ne(),s=m({name:"",relation:"",age:"",birth_date:""}),v=m([]),w=m(!1),M=m(""),y=m(""),n=m("");m(!1),G(()=>new Date().getFullYear());const k=C=>{if(!C)return"";const t=new Date,d=new Date(C);let D=t.getFullYear()-d.getFullYear();const z=t.getMonth()-d.getMonth();return(z<0||z===0&&t.getDate()<d.getDate())&&D--,console.log("Calculated age: ",D.toString()),D.toString()},T=(C,t)=>{if(!C)return t.value="",!0;const d=new Date(C),D=new Date;return d.setHours(0,0,0,0),D.setHours(0,0,0,0),d>D?(t.value="Birth date cannot be in the future.",!1):(t.value="",!0)},g=Z({first_name:"",last_name:"",address:"Bonga, Bulan, Sorsogon",contact_number:"",date_of_birth:"",purok:"",age:"",middle_name:"",status:"active",occupation:"",gender:"",beneficiaries:[]});I(()=>g.date_of_birth,C=>{const t=T(C,n);C&&t?g.age=k(C):g.age=""}),I(()=>s.value.birth_date,C=>{const t=T(C,y);C&&t?s.value.age=k(C):s.value.age=""});const L=()=>{if(g.clearErrors(),!/^0\d{10}$/.test(g.contact_number)){g.setError("contact_number","Contact number must start with 0 and be exactly 11 digits.");return}c.triggerCloseMemberModal(),T(g.date_of_birth,n)&&(c.triggerCloseMemberModal(),g.beneficiaries=v.value,g.post(route("addMemberPost"),{onSuccess:()=>{M.value="Member added successfully!",A.value=!0,U.value=!0,setTimeout(()=>M.value="",4e3)},onError:t=>console.log("An error occurred => ",t)}))},h=()=>{T(s.value.birth_date,y)&&(v.value.push({...s.value}),s.value={name:"",relation:"",age:"",birth_date:""},y.value="",w.value=!1)},l=C=>{v.value.splice(C,1)},o=C=>{const t={year:"numeric",month:"long",day:"numeric"};return new Date(C).toLocaleDateString(void 0,t)},_=G(()=>{const C=new Date,t=C.getFullYear()-16,d=String(C.getMonth()+1).padStart(2,"0"),D=String(C.getDate()).padStart(2,"0");return`${t}-${d}-${D}`}),A=ce(B,"show"),U=m(!1);return c.triggerCloseMemberModal(),(C,t)=>(u(),i("div",ge,[e("div",ye,[M.value?(u(),i("div",_e,[F(f(M.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=d=>M.value="")})])):S("",!0),e("form",{onSubmit:R(L,["prevent"]),class:"form"},[e("div",he,[e("div",$e,[t[21]||(t[21]=e("label",{class:"form-label"},"Last name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Marinda","onUpdate:modelValue":t[1]||(t[1]=d=>a(g).last_name=d)},null,512),[[x,a(g).last_name]])]),e("div",ke,[t[22]||(t[22]=e("label",{class:"form-label"},"Birth date",-1)),$(e("input",{type:"date",id:"birthDate",class:P(["form-control",{"is-invalid":n.value}]),"onUpdate:modelValue":t[2]||(t[2]=d=>a(g).date_of_birth=d),max:_.value},null,10,we),[[x,a(g).date_of_birth]]),n.value?(u(),i("div",Me,f(n.value),1)):S("",!0)]),e("div",xe,[t[23]||(t[23]=e("label",{class:"form-label"},"First name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Jovan","onUpdate:modelValue":t[3]||(t[3]=d=>a(g).first_name=d),required:""},null,512),[[x,a(g).first_name]])]),e("div",Ce,[t[24]||(t[24]=e("label",{class:"form-label"},"Age",-1)),$(e("input",{type:"number",class:"form-control",placeholder:"0","onUpdate:modelValue":t[4]||(t[4]=d=>a(g).age=d),required:"",disabled:""},null,512),[[x,a(g).age]])]),e("div",Se,[t[25]||(t[25]=e("label",{class:"form-label"},"Middle name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Munticalbo","onUpdate:modelValue":t[5]||(t[5]=d=>a(g).middle_name=d)},null,512),[[x,a(g).middle_name]])]),e("div",Ae,[t[27]||(t[27]=e("label",{class:"form-label"},"Gender",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=d=>a(g).gender=d),required:""},t[26]||(t[26]=[e("option",{value:"",disabled:""},"Select gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[H,a(g).gender]])]),e("div",Ne,[t[29]||(t[29]=e("label",{class:"form-label"},"status",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=d=>a(g).status=d),disabled:""},t[28]||(t[28]=[e("option",{value:"active",selected:""},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[H,a(g).status]])]),e("div",Be,[t[31]||(t[31]=e("label",{class:"form-label"},"Purok",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[8]||(t[8]=d=>a(g).purok=d),required:""},t[30]||(t[30]=[ae('<option value="" disabled selected data-v-b46d650b>Select Purok</option><option value="Purok 1" data-v-b46d650b>Purok 1</option><option value="Purok 2" data-v-b46d650b>Purok 2</option><option value="Purok 3" data-v-b46d650b>Purok 3</option><option value="Purok 4" data-v-b46d650b>Purok 4</option>',5)]),512),[[H,a(g).purok]])]),e("div",Ve,[t[32]||(t[32]=e("label",{class:"form-label"},"Occupation",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Farmer","onUpdate:modelValue":t[9]||(t[9]=d=>a(g).occupation=d),required:""},null,512),[[x,a(g).occupation]])]),e("div",Ee,[t[33]||(t[33]=e("label",{class:"form-label"},"Contact no.",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"09768734123","onUpdate:modelValue":t[10]||(t[10]=d=>a(g).contact_number=d),pattern:"[0-9]*",inputmode:"numeric"},null,512),[[x,a(g).contact_number]]),a(g).errors.contact_number?(u(),i("div",Ue,f(a(g).errors.contact_number),1)):S("",!0)]),e("div",De,[t[34]||(t[34]=e("label",{class:"form-label"},"Address",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Bonga, Bulan, Sorsogon","onUpdate:modelValue":t[11]||(t[11]=d=>a(g).address=d),required:"",disabled:""},null,512),[[x,a(g).address]])])]),e("div",Ie,[t[36]||(t[36]=e("h5",{class:"text-dark fw-light"},"Beneficiary",-1)),v.value.length===0?(u(),i("div",Te," No beneficiary added ")):(u(),i("div",Le,[e("table",Fe,[t[35]||(t[35]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Relation"),e("th",null,"Age"),e("th",null,"Birthdate"),e("th",null,"Action")])],-1)),e("tbody",null,[(u(!0),i(W,null,Y(v.value,(d,D)=>(u(),i("tr",{key:D},[e("td",null,f(d.name),1),e("td",null,f(d.relation),1),e("td",null,f(d.age),1),e("td",null,f(o(d.birth_date)),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:z=>l(D)}," Delete ",8,qe)])]))),128))])])]))]),e("div",Re,[w.value?S("",!0):(u(),i("button",{key:0,class:"btn btn-primary w-100 w-md-auto",type:"button",onClick:t[12]||(t[12]=d=>w.value=!0)}," Add Beneficiary ")),t[37]||(t[37]=e("button",{class:"btn btn-success w-100 w-md-auto",type:"submit"},"Submit",-1))])],32),w.value?(u(),i("div",Oe,[t[43]||(t[43]=e("h5",{class:"mb-3"},"Add Beneficiary",-1)),e("form",{onSubmit:R(h,["prevent"]),class:"row g-2"},[e("div",Pe,[t[38]||(t[38]=e("label",null,"Name",-1)),$(e("input",{type:"text",placeholder:"Name",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=d=>s.value.name=d),required:""},null,512),[[x,s.value.name]])]),e("div",je,[t[40]||(t[40]=e("label",null,"Relation",-1)),$(e("select",{name:"selectRelation",id:"selectRelation",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=d=>s.value.relation=d),required:""},t[39]||(t[39]=[ae('<option value="" disabled data-v-b46d650b>Select relation</option><option value="mother" data-v-b46d650b>Mother</option><option value="father" data-v-b46d650b>Father</option><option value="son" data-v-b46d650b>Son</option><option value="daughter" data-v-b46d650b>Daughter</option><option value="adopted" data-v-b46d650b>Adopted</option>',6)]),512),[[H,s.value.relation]])]),e("div",He,[t[41]||(t[41]=e("label",null,"Age",-1)),$(e("input",{type:"number",placeholder:"Age",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=d=>s.value.age=d),disabled:"",required:""},null,512),[[x,s.value.age]])]),e("div",We,[t[42]||(t[42]=e("label",{class:"form-label small"},"Birthdate",-1)),$(e("input",{type:"date",class:P(["form-control",{"is-invalid":y.value}]),"onUpdate:modelValue":t[16]||(t[16]=d=>s.value.birth_date=d),required:""},null,2),[[x,s.value.birth_date]]),y.value?(u(),i("div",ze,f(y.value),1)):S("",!0)]),e("div",Ge,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[17]||(t[17]=d=>w.value=!1)}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:!!y.value||!s.value.birth_date}," Save Beneficiary ",8,Ye)])],32)])):S("",!0)]),A.value?(u(),i("div",{key:0,class:"modal-overlay",onClick:t[20]||(t[20]=(...d)=>U.value&&U.value(...d))},[e("div",{class:"modal-box",onClick:t[19]||(t[19]=R(()=>{},["stop"]))},[t[44]||(t[44]=e("p",null,"Member created",-1)),e("button",{class:"close-btn",onClick:t[18]||(t[18]=(...d)=>U.value&&U.value(...d))},"OK")])])):S("",!0)]))}},Je=j(Ke,[["__scopeId","data-v-b46d650b"]]),Xe={class:"container mt-4"},Qe={key:0,class:"text-center my-5"},Ze={key:1,class:"alert alert-danger"},et={key:2,class:"table-responsive"},tt={class:"table table-striped table-bordered shadow-sm"},st={key:3,class:"alert alert-info"},lt={__name:"NewlyCreated",setup(B){const c=m([]),s=m(!0),v=m(null),w=async()=>{var y,n;try{const k=await te.get("/member/new");c.value=k.data.data}catch(k){v.value=((n=(y=k.response)==null?void 0:y.data)==null?void 0:n.message)||"Failed to fetch latest members."}finally{s.value=!1}},M=y=>new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return ee(w),(y,n)=>(u(),i("div",Xe,[s.value?(u(),i("div",Qe,n[0]||(n[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):v.value?(u(),i("div",Ze,f(v.value),1)):c.value.length?(u(),i("div",et,[e("table",tt,[n[1]||(n[1]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Address"),e("th",null,"Contact"),e("th",null,"Age"),e("th",null,"Gender"),e("th",null,"Registration Date")])],-1)),e("tbody",null,[(u(!0),i(W,null,Y(c.value,k=>(u(),i("tr",{key:k.id},[e("td",null,f(k.first_name)+" "+f(k.middle_name)+" "+f(k.last_name),1),e("td",null,f(k.address),1),e("td",null,f(k.contact_number),1),e("td",null,f(k.age),1),e("td",null,f(k.gender),1),e("td",null,f(M(k.created_at)),1)]))),128))])])])):(u(),i("div",st," No newly registered members found. "))]))}},ot=j(lt,[["__scopeId","data-v-cb085a94"]]),at={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},nt={id:"addNewMemberModal",class:"custom-modal"},dt={class:"modal-content",style:{"min-width":"60%",height:"auto"}},rt={class:"modal-header"},it={class:"modal-body"},ut={id:"newCreatedMemberModal",class:"custom-modal",style:{"padding-top":"0"}},ct={class:"modal-content",style:{"min-width":"60%",height:"auto"}},mt={class:"modal-header alig-items-center"},vt={class:"modal-body"},bt={key:0,class:"modal-overlay"},pt={class:"modal-box"},ft={style:{"font-size":"0.9rem",color:"#555"}},gt={__name:"Header",setup(B){const c=ne(),s=m(!1),v=m(3),w=y=>{document.getElementById(y).classList.add("show")},M=y=>{document.getElementById(y).classList.remove("show")};return I(()=>c.closeAddMemberModal,y=>{y&&(M("addNewMemberModal"),c.resetModal())}),window.addEventListener("click",y=>{document.querySelectorAll(".custom-modal").forEach(n=>{y.target===n&&n.classList.remove("show")})}),I(s,y=>{if(y){v.value=3;const n=setInterval(()=>{v.value--,v.value<=0&&(s.value=!1,clearInterval(n))},1e3)}}),(y,n)=>(u(),i("div",null,[e("div",at,[n[8]||(n[8]=e("div",null,[e("h5",{class:"ms-3 fw-light"},[e("span",{class:"d-none d-sm-none d-lg-inline-block me-2"},"Registered"),e("span",null,"Members")])],-1)),e("div",null,[e("button",{class:"modern-btn me-3",onClick:n[0]||(n[0]=R(k=>w("addNewMemberModal"),["prevent"]))},n[6]||(n[6]=[e("i",{class:"bi bi-person-plus"},null,-1),e("span",null,"Add Member",-1)])),e("button",{class:"modern-btn secondary",onClick:n[1]||(n[1]=k=>w("newCreatedMemberModal"))},n[7]||(n[7]=[e("i",{class:"bi bi-person-lines-fill"},null,-1),e("span",null,"Newly Created",-1)]))])]),e("div",nt,[e("div",dt,[e("div",rt,[n[9]||(n[9]=e("h3",null,"Add New Member",-1)),e("button",{class:"close-btn",onClick:n[2]||(n[2]=k=>M("addNewMemberModal"))},"Ã—")]),e("div",it,[E(Je,{show:s.value,"onUpdate:show":n[3]||(n[3]=k=>s.value=k)},null,8,["show"])])])]),e("div",ut,[e("div",ct,[e("div",mt,[n[10]||(n[10]=e("div",{class:""},[e("h4",{class:"mb-3 text-dark fw-bold d-flex align-items-center"}," Newly Registered Member ")],-1)),e("button",{class:"close-btn2 fs-2",onClick:n[4]||(n[4]=k=>M("newCreatedMemberModal"))},"Ã—")]),e("div",vt,[E(ot)])])]),s.value?(u(),i("div",bt,[e("div",pt,[n[11]||(n[11]=e("p",null,"Member created successfully!",-1)),e("p",ft," Closing in "+f(v.value)+"s... ",1),e("button",{class:"close-btn",onClick:n[5]||(n[5]=k=>s.value=!1)}," OK ("+f(v.value)+") ",1)])])):S("",!0)]))}},yt=j(gt,[["__scopeId","data-v-4e8a56c0"]]),_t={__name:"Alert",props:{status:{type:Boolean,default:!1},name:{type:String,default:""}},setup(B){const c=B,s=m(!1),v=m(null),w=m("");return I(()=>c.status,M=>{v.value=M,w.value="bounce-in",s.value=!0,setTimeout(()=>{w.value="slide-out",setTimeout(()=>{s.value=!1},500)},3e3)}),(M,y)=>(u(),i("div",null,[s.value?(u(),i("div",{key:0,class:P(["alert alert-info",w.value]),role:"alert"},[F(f(B.name)+"'s status has been changed to ",1),e("strong",null,f(v.value?"Active":"Inactive"),1)],2)):S("",!0)]))}},ht=j(_t,[["__scopeId","data-v-f19df27b"]]),$t={class:"reminder-wrapper"},kt={class:"card shadow-sm p-4 rounded-4 bg-white border-0"},wt={key:0,class:"mb-4 text-center"},Mt={class:"fw-bold text-primary mb-1"},xt={class:"text-muted mb-0"},Ct={class:"row g-3"},St={class:"col-md-6"},At={key:0,class:"invalid-feedback d-block"},Nt={class:"col-md-6"},Bt={key:0,class:"mt-4"},Vt={key:0,class:"mt-4 d-flex flex-wrap gap-3 justify-content-center"},Et={__name:"IsDeceased",props:{deceasedMember:{type:Object,default:()=>({})}},setup(B){const c=Z({message:"",type:"deathReport",memberId:null,lastNight:"",startOfContribution:""}),s=B,v=m({}),w=m(""),M=m(""),y=m(!1),n=m(""),k=G(()=>!!n.value),T=G(()=>c.lastNight&&c.startOfContribution&&!k.value);ee(()=>{const o=new Date;c.startOfContribution=o.toISOString().split("T")[0]}),I(()=>s.deceasedMember,o=>{v.value=o},{immediate:!0});const g=o=>{if(!o){n.value="";return}const _=new Date(o),A=new Date;_.setHours(0,0,0,0),A.setHours(0,0,0,0),_<=A?n.value="The last night date cannot be set today or a past date.":n.value=""};I(()=>c.lastNight,o=>{g(o)}),I([()=>c.lastNight,()=>c.startOfContribution],([o,_])=>{var A;if(o&&_&&((A=v.value)!=null&&A.first_name)&&!k.value){const U=v.value;c.message=`We regret to inform you that ${U.first_name} ${U.last_name} has passed away. Last night is on ${l(o)}, and the collection for burial assistance starts on ${l(_)}.`,c.memberId=U.id}else c.message=""},{immediate:!0});function L(){if(!c.memberId){h("Missing member ID. Please select a member first.","danger");return}if(k.value){h("Please fix the validation errors before sending.","danger");return}J.post(route("smsNotification.sendReminders"),{message:c.message,type:c.type,memberId:c.memberId,lastNight:c.lastNight,startOfContribution:c.startOfContribution},{onSuccess:()=>h("SMS sent successfully."),onError:()=>h("An error occurred while sending SMS.")})}function h(o,_){w.value=o,M.value=_,y.value=!0,setTimeout(()=>y.value=!1,4e3)}const l=o=>{const _={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString(void 0,_)};return(o,_)=>(u(),i("div",$t,[e("div",kt,[E(X,{name:"fade"},{default:O(()=>[y.value?(u(),i("div",{key:0,class:P([["alert",M.value==="success"?"alert-success":"alert-danger"],"alert-dismissible fade show mb-3"]),role:"alert"},[F(f(w.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:_[0]||(_[0]=A=>y.value=!1),"aria-label":"Close"})],2)):S("",!0)]),_:1}),v.value.first_name?(u(),i("div",wt,[e("h4",Mt,f(v.value.first_name)+" "+f(v.value.middle_name)+" "+f(v.value.last_name),1),e("p",xt,f(v.value.address),1)])):S("",!0),e("div",Ct,[e("div",St,[_[4]||(_[4]=e("label",{class:"form-label fw-semibold text-secondary"},"Enter last night:",-1)),$(e("input",{type:"date",class:P(["form-control",{"is-invalid":k.value}]),"onUpdate:modelValue":_[1]||(_[1]=A=>a(c).lastNight=A)},null,2),[[x,a(c).lastNight]]),k.value?(u(),i("div",At,f(n.value),1)):S("",!0)]),e("div",Nt,[_[5]||(_[5]=e("label",{class:"form-label fw-semibold text-secondary"},"Start of contribution:",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":_[2]||(_[2]=A=>a(c).startOfContribution=A)},null,512),[[x,a(c).startOfContribution]])])]),E(X,{name:"fade"},{default:O(()=>[a(c).message&&!k.value?(u(),i("div",Bt,[_[6]||(_[6]=e("label",{class:"form-label fw-semibold text-secondary"},"Message:",-1)),$(e("textarea",{class:"form-control","onUpdate:modelValue":_[3]||(_[3]=A=>a(c).message=A),rows:"4",style:{resize:"vertical","min-height":"100px"}},null,512),[[x,a(c).message]])])):S("",!0)]),_:1}),E(X,{name:"fade"},{default:O(()=>{var A;return[T.value?(u(),i("div",Vt,[E(a(Q),{href:o.route("smsNotification.sendToAllSelectedV2",{type:"deathReport",message:a(c).message,deceased:(A=v.value)==null?void 0:A.id,last:a(c).lastNight}),class:"btn-modern text-decoration-none"},{default:O(()=>_[7]||(_[7]=[e("i",{class:"bi bi-people-fill me-2"},null,-1),F("Send to all selected ")])),_:1},8,["href"]),e("button",{class:"btn-modern",onClick:L},_[8]||(_[8]=[e("i",{class:"bi bi-send-fill me-2"},null,-1),F("Send ")]))])):S("",!0)]}),_:1})])]))}},Ut=j(Et,[["__scopeId","data-v-757f73ae"]]),Dt={class:"container-fluid d-flex flex-row justify-content-center main-container"},It={class:"container mt-5"},Tt={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},Lt={class:"row g-3"},Ft={class:"col-12 d-md-none"},qt={class:"row g-2"},Rt={class:"col-12"},Ot={class:"col-12"},Pt={class:"col-12"},jt={class:"col-md-4 d-none d-md-block"},Ht={class:"col-md-4 d-none d-md-block"},Wt={class:"col-md-4 d-none d-md-block"},zt={class:"col-12 col-md-6"},Gt={class:"col-12 col-md-6"},Yt={class:"col-12 col-md-6"},Kt={class:"col-12 col-md-6"},Jt={class:"col-12 col-md-6"},Xt={class:"col-12 col-md-6"},Qt={class:"col-12 col-md-6"},Zt={key:0,class:"text-danger small mt-1"},es={class:"col-12"},ts={class:"mt-4"},ss={key:0,class:"text-center mt-3 text-muted"},ls={key:1,class:"table-responsive mt-2"},os={class:"table table-bordered table-striped align-middle"},as=["onClick"],ns={class:"d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 gap-3"},ds={key:1,class:"card mt-4 p-3 shadow-sm"},rs={class:"col-md-6"},is={class:"col-md-6"},us={class:"col-md-6"},cs={class:"col-md-6"},ms={class:"col-12 d-flex justify-content-end gap-2 mt-3"},vs={__name:"EditMember",props:{member:{type:Object,default:()=>({})}},setup(B){const c=B,s=Z({first_name:"",last_name:"",address:"",contact_number:"",date_of_birth:"",purok:"",age:"",middle_name:"",status:"",occupation:"",gender:"",beneficiaries:[]}),v=m([]),w=m({name:"",relation:"",age:"",birth_date:""}),M=m(!1),y=m(""),n=async h=>{if(!h){console.log("No member ID provided");return}try{const l=await te.get(route("beneficiaries.fetch",{member:h}));l.data.success?(v.value=l.data.data,console.log("Beneficiaries fetched successfully:",l.data.data)):console.error("Failed to fetch beneficiaries:",l.data.message)}catch(l){console.error("Error fetching beneficiaries:",l)}};I(()=>c.member,h=>{h&&(s.first_name=h.first_name||"",s.last_name=h.last_name||"",s.address=h.address||"",s.contact_number=h.contact_number||"",s.date_of_birth=h.date_of_birth||"",s.purok=h.purok||"",s.age=h.age||"",s.middle_name=h.middle_name||"",s.status=h.status||"",s.occupation=h.occupation||"",s.gender=h.gender||"",s.beneficiaries=h.beneficiaries||[],h.id&&n(h.id))},{immediate:!0,deep:!0});const k=()=>{if(s.clearErrors(),!/^0\d{10}$/.test(s.contact_number)){s.setError("contact_number","Contact number must start with 0 and be exactly 11 digits.");return}s.beneficiaries=v.value,s.put(route("members.update",c.member.id),{onSuccess:()=>{y.value="Member updated successfully!",setTimeout(()=>y.value="",4e3),n(c.member.id)},onError:l=>console.error("An error occurred => ",l)})},T=()=>{const h={...w.value,member_id:c.member.id};v.value.push(h),w.value={name:"",relation:"",age:"",birth_date:""},M.value=!1},g=h=>{v.value.splice(h,1)},L=h=>{if(!h)return"";const l={year:"numeric",month:"long",day:"numeric"};return new Date(h).toLocaleDateString(void 0,l)};return(h,l)=>(u(),i("div",Dt,[e("div",It,[y.value?(u(),i("div",Tt,[F(f(y.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=o=>y.value="")})])):S("",!0),e("form",{onSubmit:R(k,["prevent"]),class:"form"},[e("div",Lt,[e("div",Ft,[e("div",qt,[e("div",Rt,[$(e("input",{type:"text",class:"form-control",placeholder:"First name","onUpdate:modelValue":l[1]||(l[1]=o=>a(s).first_name=o),required:""},null,512),[[x,a(s).first_name]])]),e("div",Ot,[$(e("input",{type:"text",class:"form-control",placeholder:"Middle name","onUpdate:modelValue":l[2]||(l[2]=o=>a(s).middle_name=o)},null,512),[[x,a(s).middle_name]])]),e("div",Pt,[$(e("input",{type:"text",class:"form-control",placeholder:"Last name","onUpdate:modelValue":l[3]||(l[3]=o=>a(s).last_name=o)},null,512),[[x,a(s).last_name]])])])]),e("div",jt,[$(e("input",{type:"text",class:"form-control",placeholder:"First name","onUpdate:modelValue":l[4]||(l[4]=o=>a(s).first_name=o),required:""},null,512),[[x,a(s).first_name]])]),e("div",Ht,[$(e("input",{type:"text",class:"form-control",placeholder:"Middle name","onUpdate:modelValue":l[5]||(l[5]=o=>a(s).middle_name=o)},null,512),[[x,a(s).middle_name]])]),e("div",Wt,[$(e("input",{type:"text",class:"form-control",placeholder:"Last name","onUpdate:modelValue":l[6]||(l[6]=o=>a(s).last_name=o)},null,512),[[x,a(s).last_name]])]),e("div",zt,[l[21]||(l[21]=e("label",{class:"form-label"},"Birth date",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":l[7]||(l[7]=o=>a(s).date_of_birth=o)},null,512),[[x,a(s).date_of_birth]])]),e("div",Gt,[$(e("input",{type:"number",class:"form-control",placeholder:"Age","onUpdate:modelValue":l[8]||(l[8]=o=>a(s).age=o),required:""},null,512),[[x,a(s).age]])]),e("div",Yt,[$(e("select",{class:"form-select","onUpdate:modelValue":l[9]||(l[9]=o=>a(s).gender=o),required:""},l[22]||(l[22]=[e("option",{value:"",disabled:""},"Gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[H,a(s).gender]])]),e("div",Kt,[$(e("select",{class:"form-select","onUpdate:modelValue":l[10]||(l[10]=o=>a(s).status=o),required:""},l[23]||(l[23]=[e("option",{value:"",disabled:""},"Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[H,a(s).status]])]),e("div",Jt,[$(e("input",{type:"text",class:"form-control",placeholder:"Purok","onUpdate:modelValue":l[11]||(l[11]=o=>a(s).purok=o),required:""},null,512),[[x,a(s).purok]])]),e("div",Xt,[$(e("input",{type:"text",class:"form-control",placeholder:"Occupation","onUpdate:modelValue":l[12]||(l[12]=o=>a(s).occupation=o),required:""},null,512),[[x,a(s).occupation]])]),e("div",Qt,[$(e("input",{type:"text",class:"form-control",placeholder:"Contact no.","onUpdate:modelValue":l[13]||(l[13]=o=>a(s).contact_number=o),pattern:"[0-9]*",inputmode:"numeric"},null,512),[[x,a(s).contact_number]]),a(s).errors.contact_number?(u(),i("div",Zt,f(a(s).errors.contact_number),1)):S("",!0)]),e("div",es,[$(e("input",{type:"text",class:"form-control",placeholder:"Address","onUpdate:modelValue":l[14]||(l[14]=o=>a(s).address=o),required:""},null,512),[[x,a(s).address]])])]),e("div",ts,[l[25]||(l[25]=e("h5",{class:"text-dark fw-light"},"Beneficiary",-1)),v.value.length===0?(u(),i("div",ss," No beneficiary added ")):(u(),i("div",ls,[e("table",os,[l[24]||(l[24]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Relation"),e("th",null,"Age"),e("th",null,"Birthdate"),e("th",null,"Action")])],-1)),e("tbody",null,[(u(!0),i(W,null,Y(v.value,(o,_)=>(u(),i("tr",{key:_},[e("td",null,f(o.name),1),e("td",null,f(o.relation),1),e("td",null,f(o.age),1),e("td",null,f(L(o.birth_date)),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:A=>g(_)}," Delete ",8,as)])]))),128))])])]))]),e("div",ns,[M.value?S("",!0):(u(),i("button",{key:0,class:"btn btn-primary w-100 w-md-auto",type:"button",onClick:l[15]||(l[15]=o=>M.value=!0)}," Add Beneficiary ")),l[26]||(l[26]=e("button",{class:"btn btn-success w-100 w-md-auto",type:"submit"},"Save",-1))])],32),M.value?(u(),i("div",ds,[l[29]||(l[29]=e("h5",{class:"mb-3"},"Add Beneficiary",-1)),e("form",{onSubmit:R(T,["prevent"]),class:"row g-2"},[e("div",rs,[$(e("input",{type:"text",placeholder:"Name",class:"form-control","onUpdate:modelValue":l[16]||(l[16]=o=>w.value.name=o),required:""},null,512),[[x,w.value.name]])]),e("div",is,[$(e("input",{type:"text",placeholder:"Relation",class:"form-control","onUpdate:modelValue":l[17]||(l[17]=o=>w.value.relation=o),required:""},null,512),[[x,w.value.relation]])]),e("div",us,[$(e("input",{type:"number",placeholder:"Age",class:"form-control","onUpdate:modelValue":l[18]||(l[18]=o=>w.value.age=o),required:""},null,512),[[x,w.value.age]])]),e("div",cs,[l[27]||(l[27]=e("label",{class:"form-label small"},"Birthdate",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":l[19]||(l[19]=o=>w.value.birth_date=o),required:""},null,512),[[x,w.value.birth_date]])]),e("div",ms,[e("button",{type:"button",class:"btn btn-secondary",onClick:l[20]||(l[20]=o=>M.value=!1)}," Cancel "),l[28]||(l[28]=e("button",{type:"submit",class:"btn btn-primary"},"Save Beneficiary",-1))])],32)])):S("",!0)])]))}},bs=j(vs,[["__scopeId","data-v-881cc22e"]]),ps={class:"main-section bg-light"},fs={class:"container table-container"},gs={class:"search-box mb-3 position-relative"},ys={key:0,class:"spinner-border text-primary spinner-sm position-absolute end-0 top-50 translate-middle-y me-3",role:"status"},_s={class:"table-responsive"},hs={class:"table table-bordered align-middle text-center"},$s={key:0},ks={key:1},ws={colspan:"9",class:"text-danger text-center"},Ms={class:"text-start"},xs={class:"status-cell"},Cs={class:"status-toggle"},Ss={class:"toggle-switch"},As=["checked","onChange"],Ns={class:"status-cell"},Bs={class:"status-toggle"},Vs={class:"toggle-switch"},Es=["data-member-id","checked","onClick"],Us={class:"actions-column"},Ds={class:"action-buttons-large"},Is=["onClick"],Ts=["onClick"],Ls={class:"action-buttons-small"},Fs=["onClick"],qs={key:2},Rs={class:"pagination-wrapper mt-3 mb-5"},Os={class:"pagination-controls"},Ps=["onClick","innerHTML"],js={class:"list-unstyled m-0"},Hs={class:"modal fade",id:"editMember",tabindex:"-1"},Ws={class:"modal-dialog modal-lg"},zs={class:"modal-content"},Gs={class:"modal-body"},Ys={class:"custom-modal"},Ks={class:"custom-modal-body"},Js={key:2,class:"custom-loading-modal"},Xs={class:"loading-content"},Qs={class:"mt-2"},Zs=400,el={__name:"RegisteredMember",props:{members:{type:Object,default:()=>({data:[],links:[],prev_page_url:null,next_page_url:null})},deceasedMember:{type:Array,default:()=>[]}},setup(B){const c=B,s=m([]),v=m(!1),w=m({top:"0px",left:"0px"}),M=m(null),y=m(!1),n=m(""),k=m(""),T=m([]),g=m({}),L=m(!1),h=m({}),l=m(!1),o=m(""),_=m(null);m(!1),m([]);const A=m(!1),U=m("");m([]),I(()=>c.members,p=>{s.value=p.data||[]},{immediate:!0}),I(()=>c.deceasedMember,p=>{T.value=p.data||[]},{immediate:!0});let C=null;I(k,p=>{C&&clearTimeout(C),C=setTimeout(()=>t(String(p||"").trim()),Zs)});async function t(p){if(!p){s.value=c.members.data,console.log("Search cleared â€” showing default members:",s.value),l.value=!1;return}l.value=!0,o.value="",console.log(`ðŸ” Searching for: "${p}"`);try{const r=await te.get(route("members.search"),{params:{query:p}});console.log(" Raw Axios response:",r),console.log(" Response data:",r.data);let b=[];const N=(r==null?void 0:r.data)||{};if(Array.isArray(N.members))b=N.members;else if(N.members&&Array.isArray(N.members.data))b=N.members.data;else if(N.member&&typeof N.member=="object")b=[N.member];else if(Array.isArray(N.data))b=N.data;else{const V=Object.values(N).find(K=>{var q;return Array.isArray(K)&&((q=K[0])==null?void 0:q.id)});V&&(b=V)}console.log("ðŸ§¾ Normalized members array to display:",b),s.value=b}catch{}finally{l.value=!1}}const d=p=>{confirm("Are you sure you want to trash this member?")&&J.delete(route("deleteMember",{id:p}),{onSuccess:()=>{alert("Member trashed"),v.value=!1}})},D=async p=>{const r=p.status==="active"?"inactive":"active";U.value=`${p.first_name} ${p.middle_name} ${p.last_name}`,A.value=!0;try{J.put(route("toggleMemberStatus",{id:p.id}),{status:r},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{const b=s.value.map(N=>N.id===p.id?{...N,status:r}:N);s.value=b,y.value=r==="active",n.value=U.value},onError:b=>{console.error("Failed to toggle status:",b)},onFinish:()=>{setTimeout(()=>{A.value=!1},1500)}})}catch(b){console.error("Failed to toggle status:",b),setTimeout(()=>{A.value=!1},1500)}},z=(p,r)=>{if(v.value&&M.value===r){v.value=!1,M.value=null;return}M.value=r,v.value=!0,pe(()=>{const b=p.currentTarget.getBoundingClientRect(),N=document.querySelector(".actions-popup");if(!N)return;const V=N.offsetWidth,K=window.innerWidth;let q=b.right+window.scrollX+10;q+V>K&&(q=b.left+window.scrollX-V-10,q<0&&(q=10)),w.value={top:`${b.top+window.scrollY}px`,left:`${q}px`}})},se=p=>{v.value&&p.target&&!p.target.closest(".actions-popup")&&!p.target.closest(".three-dots-button")&&(v.value=!1,M.value=null)};ee(()=>document.addEventListener("click",se)),me(()=>document.removeEventListener("click",se));const de=p=>{p&&J.visit(p,{preserveState:!0})},re=p=>{g.value=p||null,L.value=!0,_.value=(p==null?void 0:p.id)||null},le=()=>{if(L.value=!1,_.value){const p=document.querySelector(`input[type="checkbox"][data-member-id="${_.value}"]`);p&&(p.checked=!1),_.value=null}},oe=p=>{v.value=!1,h.value={...p}};document.getElementById("memberModalOverlay"),document.getElementById("memberModal"),document.getElementById("createBtn"),document.getElementById("closeBtn");const ie=G(()=>{var p;return s.value.length<=5?[{label:"1",url:((p=c.members.links[0])==null?void 0:p.url)||null,active:!0}]:c.members.links});return(p,r)=>(u(),i(W,null,[E(a(ve),{title:"Registered members"}),E(fe,null,{default:O(()=>[e("div",ps,[E(yt),E(ht,{status:y.value,name:n.value},null,8,["status","name"]),e("div",fs,[e("div",gs,[$(e("input",{type:"text",class:"form-control search-input",placeholder:"Search members by name, contact, or purok...","onUpdate:modelValue":r[0]||(r[0]=b=>k.value=b)},null,512),[[x,k.value]]),l.value?(u(),i("div",ys,r[3]||(r[3]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):S("",!0)]),e("div",_s,[e("table",hs,[r[12]||(r[12]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"NAME"),e("th",null,"GENDER"),e("th",null,"AGE"),e("th",null,"CONTACT NO."),e("th",null,"STREET"),e("th",null,"STATUS"),e("th",null,"DECEASED"),e("th",null,"ACTION")])],-1)),e("tbody",null,[l.value?(u(),i("tr",$s,r[4]||(r[4]=[e("td",{colspan:"9",class:"text-center"},[e("div",{class:"spinner-border text-info",role:"status"}),e("p",{class:"mt-2 text-muted"},"Searching...")],-1)]))):S("",!0),o.value&&!l.value?(u(),i("tr",ks,[e("td",ws,f(o.value),1)])):S("",!0),(u(!0),i(W,null,Y(s.value,(b,N)=>(u(),i("tr",{key:N},[e("td",Ms,f(b.first_name)+" "+f(b.middle_name)+" "+f(b.last_name),1),e("td",null,f(b.gender||"N/A"),1),e("td",null,f(b.age),1),e("td",null,f(b.contact_number),1),e("td",null,f(b.purok),1),e("td",xs,[e("div",Cs,[e("label",Ss,[e("input",{type:"checkbox",checked:b.status==="active",onChange:V=>D(b)},null,40,As),r[5]||(r[5]=e("span",{class:"toggle-slider"},null,-1))]),e("span",{class:P(["status-label",b.status==="active"?"active":"inactive"])},f(b.status==="active"?"Active":"Inactive"),3)])]),e("td",Ns,[e("div",Bs,[e("label",Vs,[e("input",{type:"checkbox","data-member-id":b.id,checked:T.value.some(V=>V.member_id===b.id),onClick:V=>re(b)},null,8,Es),r[6]||(r[6]=e("span",{class:"toggle-slider"},null,-1))])])]),e("td",Us,[e("div",Ds,[E(a(Q),{href:p.route("viewMemberInfo",{id:b.id}),class:"me-1"},{default:O(()=>r[7]||(r[7]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["href"]),e("button",{"data-bs-toggle":"modal","data-bs-target":"#editMember",onClick:V=>oe(b),class:"me-1"},r[8]||(r[8]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,Is),e("button",{onClick:V=>d(b.id)},r[9]||(r[9]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Ts)]),e("div",Ls,[e("button",{class:"btn btn-sm btn-outline-dark three-dots-button",onClick:R(V=>z(V,b.id),["stop"])},r[10]||(r[10]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)]),8,Fs)])])]))),128)),!l.value&&s.value.length===0?(u(),i("tr",qs,r[11]||(r[11]=[e("td",{colspan:"9",class:"text-center text-muted"},"No members found",-1)]))):S("",!0)])])]),e("div",Rs,[e("div",Os,[(u(!0),i(W,null,Y(ie.value,(b,N)=>(u(),i("button",{key:N,class:P(["btn pagination-btn",b.active?"btn-primary":"btn-outline-primary"]),onClick:V=>de(b.url),innerHTML:b.label},null,10,Ps))),128))])])])]),v.value?(u(),i("div",{key:0,class:"actions-popup bg-white border rounded shadow-sm p-2",style:be({top:w.value.top,left:w.value.left})},[e("ul",js,[e("li",null,[E(a(Q),{href:p.route("viewMemberInfo",{id:M.value}),class:"dropdown-item"},{default:O(()=>r[13]||(r[13]=[e("i",{class:"bi bi-eye me-2"},null,-1),F(" View")])),_:1},8,["href"])]),e("li",null,[e("button",{class:"dropdown-item w-100 text-start","data-bs-toggle":"modal","data-bs-target":"#editMember",onClick:r[1]||(r[1]=b=>oe(s.value.find(N=>N.id===M.value)))},r[14]||(r[14]=[e("i",{class:"bi bi-pencil me-2"},null,-1),F(" Edit")]))]),e("li",null,[e("button",{class:"dropdown-item w-100 text-start text-danger",onClick:r[2]||(r[2]=b=>d(M.value))},r[15]||(r[15]=[e("i",{class:"bi bi-trash me-2"},null,-1),F(" Delete")]))])])],4)):S("",!0),e("div",Hs,[e("div",Ws,[e("div",zs,[r[16]||(r[16]=e("div",{class:"modal-header"},[e("h5",null,"Edit Member Info"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Gs,[E(bs,{member:h.value},null,8,["member"])])])])]),L.value?(u(),i("div",{key:1,class:"custom-modal-overlay",onClick:R(le,["self"])},[e("div",Ys,[e("div",{class:"custom-modal-header"},[r[17]||(r[17]=e("h3",null,"Add Deceased Info",-1)),e("span",{class:"close-icon",onClick:le},"Ã—")]),e("div",Ks,[E(Ut,{deceasedMember:g.value},null,8,["deceasedMember"])])])])):S("",!0),A.value?(u(),i("div",Js,[e("div",Xs,[r[18]||(r[18]=e("div",{class:"spinner-border text-primary",role:"status"},null,-1)),e("p",Qs,"Updating status for "+f(U.value)+"...",1)])])):S("",!0)]),_:1})],64))}},al=j(el,[["__scopeId","data-v-619e25ff"]]);export{al as default};
