import{r as p,s as S,f as n,o as a,b as t,n as I,u as i,F as w,G as L,t as u,W as E,x as B,l as H,h as M,d as R,i as P,I as U,D as V,E as O,e as j,J as W,a as C,j as Y,g as z,w as G}from"./app-B2PZaDBq.js";import{_ as J}from"./not_found-DvAnRRcV.js";import{A as K}from"./AdminLayout-DJAeWfnW.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./ToggleContribution-DiFYHC6o.js";import"./logo1-BZ0h4foK.js";const q={class:"d-flex align-items-center gap-2 text-muted small"},X=["onClick"],Z={__name:"Purok",props:{activePurok:{type:String,default:()=>""},currentDeceasedId:{type:[String,Number],default:null}},setup(N){const d=N;let c=p("");S(()=>d.activePurok,b=>{c.value=b},{immediate:!0});const v=["Purok 1","Purok 2","Purok 3","Purok 4"],g=b=>{const m=b.toLowerCase().replace(/\s+/g,"");E.get(route("contributions.togglePurok",{purok:m,deceasedId:d.currentDeceasedId||0}),{onSuccess:()=>console.log("changing purok"),onError:y=>console.log("An error occured: ",y)})},x=b=>b.toLowerCase().replace(/\s+/g,"");return(b,m)=>(a(),n("div",null,[t("div",q,[t("span",{class:I(["purok all-members-text",{"fw-bold active":i(c)=="all"}]),onClick:m[0]||(m[0]=y=>g("all"))},"ALL MEMBERS",2),t("div",null,[(a(),n(w,null,L(v,y=>t("span",{key:y,class:I(["mx-2 purok",{"fw-bold active":x(y)===i(c)}]),onClick:l=>g(y)},u(y),11,X)),64))])])]))}},ee=T(Z,[["__scopeId","data-v-9a43fba9"]]),te={class:"contri-container py-1"},se={class:"row justify-content-center"},oe={class:"col-md-8"},le={class:"card rounded-4 shadow-none border-0"},ne={class:"card-body p-4"},ae={key:0,class:"alert alert-success text-center fw-semibold",role:"alert"},re={class:"mb-3"},ie=["value"],de={class:"mb-3"},ue=["value"],ce={key:0,class:"invalid-feedback"},pe={class:"mb-3"},be={key:0,class:"invalid-feedback"},_e={class:"mb-3"},ve={key:0,class:"mb-3"},fe={key:1,class:"text-danger"},ke={class:"d-flex justify-content-end"},ge=["disabled"],ye={key:0,class:"spinner-border spinner-border-sm"},me={__name:"AddContribution",setup(N){const d=p([]),c=p([]),v=p([]),g=p([]),x=p([]),b=p(!1),m=p(""),l=B({member_id:"",amount:100,payment_date:(()=>{const s=new Date,o=s.getFullYear(),e=String(s.getMonth()+1).padStart(2,"0"),f=String(s.getDate()).padStart(2,"0"),k=String(s.getHours()).padStart(2,"0"),h=String(s.getMinutes()).padStart(2,"0");return`${o}-${e}-${f}T${k}:${h}`})(),collector:"",status:"paid",purok:"",deceased_id:""});H(async()=>{try{const s=await W.get(route("contributions.members.data")),{members:o,users:e,deceasedMembers:f}=s.data;d.value=o||[],g.value=e||[],x.value=f||[];const k=(o||[]).map(_=>({id:_.id,fullName:`${_.first_name} ${_.middle_name??""} ${_.last_name}`.replace(/\s+/g," ").trim()})),h=(e||[]).map(_=>({id:_.id,fullName:_.name}));c.value=[...k,...h],v.value=(e||[]).filter(_=>_.role==="collector"),console.log("Collectorss:",v.value)}catch(s){console.error(s)}}),S(()=>l.purok,s=>{if(!s)return;const o=parseInt(s.replace("purok",""),10),e=v.value.find(f=>Number(f.purok)===o);l.collector=e?e.name:""});const $=()=>{l.post(route("contributions.store"),{preserveScroll:!0,onSuccess:()=>{m.value="Contribution successfully created!",b.value=!0,setTimeout(()=>b.value=!1,3e3),l.reset()}})},r=p(!1);return S(()=>l.purok,s=>{if(!s)return;r.value=!0;const o=parseInt(s.replace("purok",""),10),e=v.value.find(f=>Number(f.purok)===o);l.collector=e?e.name:""}),(s,o)=>(a(),n("div",null,[t("div",te,[t("div",se,[t("div",oe,[t("div",le,[o[13]||(o[13]=t("div",{class:"card-header text-center"},[t("h4",{class:"mb-0"},"Create Contribution")],-1)),t("div",ne,[b.value?(a(),n("div",ae,u(m.value),1)):M("",!0),t("form",{onSubmit:R($,["prevent"])},[t("div",re,[o[6]||(o[6]=t("label",{class:"form-label"},"Select Deceased Member",-1)),P(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>i(l).deceased_id=e),class:"form-control"},[o[5]||(o[5]=t("option",{disabled:"",value:""},"-- Select Deceased Member --",-1)),(a(!0),n(w,null,L(x.value,e=>(a(),n("option",{key:e.id,value:e.member_id},u(e.deceased_name),9,ie))),128))],512),[[U,i(l).deceased_id]])]),t("div",de,[o[8]||(o[8]=t("label",{class:"form-label"},"Member Name",-1)),P(t("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>i(l).member_id=e),class:I(["form-select",{"is-invalid":i(l).errors.member_id}])},[o[7]||(o[7]=t("option",{disabled:"",value:""},"-- Select Member --",-1)),(a(!0),n(w,null,L(c.value,e=>(a(),n("option",{key:e.id,value:e.id},u(e.fullName),9,ue))),128))],2),[[U,i(l).member_id]]),i(l).errors.member_id?(a(),n("div",ce,u(i(l).errors.member_id),1)):M("",!0)]),t("div",pe,[o[9]||(o[9]=t("label",{class:"form-label"},"Payment Date",-1)),P(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>i(l).payment_date=e),type:"datetime-local",class:I(["form-control",{"is-invalid":i(l).errors.payment_date}])},null,2),[[V,i(l).payment_date]]),i(l).errors.payment_date?(a(),n("div",be,u(i(l).errors.payment_date),1)):M("",!0)]),t("div",_e,[o[11]||(o[11]=t("label",{class:"form-label"},"Purok",-1)),P(t("select",{"onUpdate:modelValue":o[3]||(o[3]=e=>i(l).purok=e),class:"form-control"},o[10]||(o[10]=[O('<option disabled value="">-- Select Purok --</option><option value="purok1">Purok 1</option><option value="purok2">Purok 2</option><option value="purok3">Purok 3</option><option value="purok4">Purok 4</option>',5)]),512),[[U,i(l).purok]])]),i(l).collector?(a(),n("div",ve,[o[12]||(o[12]=t("label",{class:"form-label"},"Collector",-1)),P(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=e=>i(l).collector=e),readonly:""},null,512),[[V,i(l).collector]])])):M("",!0),r.value&&!i(l).collector?(a(),n("div",fe," No Collector for that purok. ")):M("",!0),t("div",ke,[t("button",{type:"submit",class:"btn btn-success px-4 rounded-pill d-flex align-items-center gap-2",disabled:i(l).processing||!i(l).collector},[i(l).processing?(a(),n("span",ye)):M("",!0),j(" "+u(i(l).processing?"Submitting...":"Submit"),1)],8,ge)])],32)])])])])])]))}},he={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},xe={class:"modal-dialog",style:{"min-width":"60%"}},$e={class:"modal-content"},Ce={class:"modal-body"},Me={__name:"Header",setup(N){return(d,c)=>(a(),n("div",null,[c[1]||(c[1]=O('<div class="container-fluid d-flex flex-row justify-content-between align-items-center px-0 mb-2" data-v-31f09250><div data-v-31f09250><h6 class="mt-4 payment-contribution-text fs-5" style="transform:translateY(-20%);" data-v-31f09250><span class="d-none d-sm-none d-lg-inline" data-v-31f09250>Payment</span> Contribution</h6></div><div data-v-31f09250><button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" data-v-31f09250><span class="d-none d-sm-none d-lg-inline" data-v-31f09250>Add contribution</span><i class="bi bi-plus d-inline d-sm-inline d-lg-none" data-v-31f09250></i></button></div></div>',1)),t("div",he,[t("div",xe,[t("div",$e,[c[0]||(c[0]=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Add contribution"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Ce,[C(me)])])])])]))}},Se=T(Me,[["__scopeId","data-v-31f09250"]]),F={__name:"Collector",props:{collectors:{type:Array,default:()=>[]},purok:{type:String,default:""}},setup(N){var v;const d=N,c=p("");return d.collectors.length!=0&&d.purok!=""?c.value=((v=d.collectors.find(g=>g.purok===d.purok.slice(-1)))==null?void 0:v.name)||"N/A":c.value="N/A",(g,x)=>(a(),n("div",null,[t("p",null,u(c.value),1)]))}},Ne={class:"main-container"},Pe={class:"container-fluid d-flex justify-content-end"},we={class:"search-container w-50"},Ae={class:"bg-light p-2"},De={class:""},Le={key:0,class:"mt-3"},Ie={key:1,class:"table-responsive mt-3 desktop-view"},Ue={class:"table table-bordered table-hover align-middle text-center"},Ve={class:"scrollable-tbody"},je={class:"text-start"},Te={key:0},Fe={key:1,class:"text-muted"},Ee={key:0,class:"badge bg-success"},Oe={key:1,class:"text-muted"},Be={class:"pagination-controls d-flex align-items-center justify-content-end gap-2 mt-3"},He=["disabled"],Re=["disabled"],We={key:2,class:"mobile-view"},Ye={class:"mobile-cards-container"},ze={class:"mobile-card-header"},Ge={class:"mobile-member-id"},Je={class:"mobile-status"},Ke={key:0,class:"badge bg-success"},Qe={key:1,class:"text-muted"},qe={class:"mobile-card-body"},Xe={class:"mobile-field"},Ze={class:"mobile-value"},et={class:"mobile-field-group"},tt={class:"mobile-field"},st={class:"mobile-value"},ot={class:"mobile-field"},lt={class:"mobile-value"},nt={class:"mobile-field"},at={key:0,class:"mobile-value"},rt={key:1,class:"text-muted"},it={class:"mobile-field"},dt={class:"mobile-value"},ut={class:"mobile-pagination d-flex align-items-center justify-content-between mt-3"},ct=["disabled"],pt=["disabled"],bt={key:3,class:"container mt-4 text-center"},_t={class:"fw-light"},vt={class:"text-success"},ft={__name:"MemberContribution",props:{member:{type:Object,default:()=>({data:[],links:{},meta:{}})},selectedPurok:{type:String,default:()=>""},collectors:{type:Array,default:()=>[]},currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(N){const d=N;let c=p([]),v=p(""),g=p([]);const x=p([]),b=p({});S(()=>d.member,r=>{c.value=(r==null?void 0:r.data)||[]},{immediate:!0}),S(()=>d.selectedPurok,r=>{v.value=r},{immediate:!0}),S(()=>d.collectors,r=>{g.value=r},{immediate:!0}),S(()=>d.currentDeceasedMembers,r=>{x.value=r?Object.values(r):[]},{immediate:!0}),S(()=>d.currentDeceasedMember,r=>{b.value=r},{immediate:!0});const m=r=>{const s={year:"numeric",month:"long",day:"numeric"};return new Date(r).toLocaleDateString(void 0,s)};function y(r){return r==null?"N/A":parseFloat(r)}function l(r){r&&E.get(r,{},{preserveScroll:!0,preserveState:!0})}const A=p(""),$=Y(()=>{if(!A.value.trim())return c.value;const r=A.value.toLowerCase();return c.value.filter(s=>{var o,e,f,k;return s.first_name&&s.first_name.toLowerCase().includes(r)||s.last_name&&s.last_name.toLowerCase().includes(r)||s.middle_name&&s.middle_name.toLowerCase().includes(r)||s.purok&&s.purok.toLowerCase().includes(r)||((e=(o=s.contributions)==null?void 0:o[0])==null?void 0:e.collector)&&s.contributions[0].collector.toLowerCase().includes(r)||((k=(f=s.contributions)==null?void 0:f[0])==null?void 0:k.status)&&s.contributions[0].status.toLowerCase().includes(r)})});return(r,s)=>(a(),n(w,null,[C(i(z),{title:"Member contribution"}),t("div",null,[C(K,null,{default:G(()=>{var o;return[t("div",Ne,[t("div",Pe,[t("div",we,[P(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>A.value=e),type:"text",class:"form-control",placeholder:"Search by name, purok, collector, or status..."},null,512),[[V,A.value]])])]),t("div",Ae,[t("div",De,[C(Se)]),C(ee,{activePurok:i(v),currentDeceasedId:(o=b.value)==null?void 0:o.member_id},null,8,["activePurok","currentDeceasedId"]),b.value?(a(),n("div",Le,[C(Q,{allDeceased:x.value,data:b.value,purok:i(v)},null,8,["allDeceased","data","purok"])])):M("",!0),Array.isArray($.value)&&$.value.length>0?(a(),n("div",Ie,[t("table",Ue,[s[5]||(s[5]=t("thead",{class:""},[t("tr",null,[t("th",null,"NAME"),t("th",null,"AMOUNT"),t("th",null,"DATE"),t("th",null,"COLLECTOR"),t("th",null,"PUROK"),t("th",null,"STATUS")])],-1)),t("tbody",Ve,[(a(!0),n(w,null,L($.value,(e,f)=>{var k,h,_,D;return a(),n("tr",{key:f},[t("td",je,u(e==null?void 0:e.first_name)+" "+u(e==null?void 0:e.middle_name)+" "+u(e==null?void 0:e.last_name),1),t("td",null,u(y((k=e==null?void 0:e.contributions[0])==null?void 0:k.amount)),1),t("td",null,[(h=e==null?void 0:e.contributions[0])!=null&&h.payment_date?(a(),n("span",Te,u(m((_=e==null?void 0:e.contributions[0])==null?void 0:_.payment_date)),1)):(a(),n("span",Fe,"..."))]),t("td",null,[C(F,{collectors:i(g),purok:e.purok},null,8,["collectors","purok"])]),t("td",null,u((e==null?void 0:e.purok)||"N/A"),1),t("td",null,[((D=e==null?void 0:e.contributions[0])==null?void 0:D.status)==="paid"?(a(),n("span",Ee,"Paid")):(a(),n("span",Oe,"Unpaid"))])])}),128))])]),t("div",Be,[t("button",{class:"btn btn-outline-primary",disabled:!d.member.prev_page_url,onClick:s[1]||(s[1]=e=>l(d.member.prev_page_url))}," Previous ",8,He),t("button",{class:"btn btn-outline-primary",disabled:!d.member.next_page_url,onClick:s[2]||(s[2]=e=>l(d.member.next_page_url))}," Next ",8,Re)])])):M("",!0),Array.isArray($.value)&&$.value.length>0?(a(),n("div",We,[t("div",Ye,[(a(!0),n(w,null,L($.value,(e,f)=>{var k,h,_,D;return a(),n("div",{class:"mobile-card",key:f},[t("div",ze,[t("div",Ge,"ID: "+u(e==null?void 0:e.id),1),t("div",Je,[((k=e==null?void 0:e.contributions[0])==null?void 0:k.status)==="paid"?(a(),n("span",Ke,"Paid")):(a(),n("span",Qe,"Unpaid"))])]),t("div",qe,[t("div",Xe,[s[6]||(s[6]=t("label",null,"Name:",-1)),t("span",Ze,u(e==null?void 0:e.first_name)+" "+u(e==null?void 0:e.middle_name)+" "+u(e==null?void 0:e.last_name),1)]),t("div",et,[t("div",tt,[s[7]||(s[7]=t("label",null,"Amount:",-1)),t("span",st,u(y((h=e==null?void 0:e.contributions[0])==null?void 0:h.amount)),1)]),t("div",ot,[s[8]||(s[8]=t("label",null,"Purok:",-1)),t("span",lt,u((e==null?void 0:e.purok)||"N/A"),1)])]),t("div",nt,[s[9]||(s[9]=t("label",null,"Date:",-1)),(_=e==null?void 0:e.contributions[0])!=null&&_.payment_date?(a(),n("span",at,u(m((D=e==null?void 0:e.contributions[0])==null?void 0:D.payment_date)),1)):(a(),n("span",rt,"..."))]),t("div",it,[s[10]||(s[10]=t("label",null,"Collector:",-1)),t("span",dt,[C(F,{collectors:i(g),purok:e.purok},null,8,["collectors","purok"])])])])])}),128))]),t("div",ut,[t("button",{class:"btn btn-outline-primary btn-sm",disabled:!d.member.prev_page_url,onClick:s[3]||(s[3]=e=>l(d.member.prev_page_url))}," ← Previous ",8,ct),t("button",{class:"btn btn-outline-primary btn-sm",disabled:!d.member.next_page_url,onClick:s[4]||(s[4]=e=>l(d.member.next_page_url))}," Next → ",8,pt)])])):(a(),n("div",bt,[s[13]||(s[13]=t("img",{src:J,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),t("h5",_t,[s[11]||(s[11]=j(" No contribution found in ")),t("span",vt,u(i(v)||"N/A"),1),s[12]||(s[12]=j(". "))])])),s[14]||(s[14]=t("div",{class:"container space-at-bottom"},null,-1))])])]}),_:1})])],64))}},$t=T(ft,[["__scopeId","data-v-eb874c33"]]);export{$t as default};
