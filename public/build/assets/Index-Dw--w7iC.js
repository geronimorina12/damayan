import{r as i,s as m,f as b,o as g,b as e,t as y,u as v,j as I,i as T,h as D,D as U,F as A,G as N,n as w,W as $,K as F,C as O,U as j,a as C,g as L,w as V,d as E}from"./app-FxwxEWAe.js";import{C as B}from"./CollectorLayout-Cc29WSHA.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as q}from"./ViewAsCollector-XgVVGh39.js";import"./logo1-BZ0h4foK.js";import"./html2pdf-BP8nMiEf.js";const K={class:"table-wrapper mt-3"},G={class:"container-fluid header-container"},H={class:"table"},Q={class:"tbody"},W={style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},z={class:"bg-light"},J={class:"bg-light"},X={class:"bg-light"},Y={class:"bg-light"},Z={class:"bg-light"},ee={__name:"SubHeaderForCollectorReport",props:{membersCount:{type:Number,default:0},amount:{type:Number,default:0},activePurok:{type:String,default:""},paidMembers:{type:Number,default:0},unpaidMembers:{type:Number,default:0}},setup(k){const t=k;let u=i(0),c=i(0),p=i(""),_=i(""),h=i("");return m(()=>t.amount,o=>{c.value=o},{immediate:!0}),m(()=>t.membersCount,o=>{u.value=o},{immediate:!0}),m(()=>t.activePurok,o=>{p.value=o},{immediate:!0}),m(()=>t.paidMembers,o=>{_.value=c.value/100},{immediate:!0}),m(()=>t.unpaidMembers,o=>{h.value=o.toString()+(o===1?" Member":" Members")},{immediate:!0}),(o,d)=>(g(),b("div",K,[e("div",G,[e("table",H,[d[0]||(d[0]=e("thead",{class:"thead"},[e("tr",{style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},[e("td",{class:"bg-light"},"MEMBERS"),e("td",{class:"bg-light"},"AMOUNT"),e("td",{class:"bg-light"},"PUROK"),e("td",{class:"bg-light"},"PAID"),e("td",{class:"bg-light"},"UNPAID")])],-1)),e("tbody",Q,[e("tr",W,[e("td",z,y(v(u))+" Members",1),e("td",J,y(v(c)),1),e("td",X,y(v(p)[5]||"All"),1),e("td",Y,y(v(_)),1),e("td",Z,y(v(u)-v(_)),1)])])])])]))}},te=P(ee,[["__scopeId","data-v-565aad73"]]),se={class:"container-fluid d-flex gap-3 align-items-center mb-3 justify-content-between"},oe={class:"d-flex justify-content-end container-fluid"},le={class:"search-box position-relative"},ae={key:0,class:"spinner-border text-primary spinner-sm position-absolute end-0 top-50 translate-middle-y me-3",role:"status"},re={key:0,class:"table"},ne={class:"bg-light pb-3"},ie={class:"bg-light pb-3"},de={class:"bg-light pb-3"},ce={class:"bg-light text-center pb-3"},ue={key:0,class:"bg-success rounded px-2 py-1 text-light"},me={key:1,class:"bg-danger rounded px-2 py-1 text-light"},pe={key:1,class:"text-center p-3"},be={key:0,class:"text-muted small"},ge={__name:"ReportTable",props:{activeStatus:{type:String,default:"paid"},activePurok:{type:String,default:"all"},members:{type:Array,default:()=>[]},contributionsIds:{type:Array,default:()=>[]}},setup(k){const t=k,u=i([]);I(()=>t.activePurok);const c=i(t.activeStatus),p=i(""),_=i(!1),h=()=>{c.value==="paid"?u.value=t.members.filter(s=>t.contributionsIds.includes(s.id)):c.value==="not_paid"?u.value=t.members.filter(s=>!t.contributionsIds.includes(s.id)):u.value=t.members,console.log("Filtered members in table:",u.value)},o=I(()=>{const s=p.value.trim().toLowerCase();if(!s)return console.log("No search query, showing all filtered members:",u.value.length),u.value;const l=u.value.filter(n=>{var a,S;const f=`${n.first_name} ${n.middle_name||""} ${n.last_name}`.toLowerCase(),M=((a=n.contact_number)==null?void 0:a.toLowerCase())||"",x=((S=n.purok)==null?void 0:S.toLowerCase())||"";return f.includes(s)||M.includes(s)||x.includes(s)});return console.log("Search results:",l.length),l});let d;return m(p,()=>{_.value=!0,clearTimeout(d),d=setTimeout(()=>{_.value=!1},400)}),m(()=>[t.members,c.value,t.contributionsIds],()=>{console.log("Props changed - filtering members"),h()},{immediate:!0,deep:!0}),m(c,()=>{console.log("=== DEBUG INFO ==="),console.log("localStatus:",c.value),console.log("getMembers length:",u.value.length),console.log("filteredMembers length:",o.value.length),console.log("searchQuery:",p.value),console.log("props.members length:",t.members.length),console.log("props.contributionsIds length:",t.contributionsIds.length),console.log("===================")}),m(o,()=>{console.log("filteredMembers updated:",o.value.length)}),(s,l)=>(g(),b("div",null,[e("div",se,[e("div",oe,[e("div",le,[T(e("input",{type:"text",class:"form-control search-input",placeholder:"Search by name, contact, or purok...","onUpdate:modelValue":l[0]||(l[0]=n=>p.value=n)},null,512),[[U,p.value]]),_.value?(g(),b("div",ae,l[1]||(l[1]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):D("",!0)])])]),e("div",{class:w(["table-responsive table-container",{"has-scroll":o.value.length>5}])},[o.value.length>0?(g(),b("table",re,[l[2]||(l[2]=e("thead",null,[e("tr",null,[e("th",{class:"bg-light"},"NAME"),e("th",{class:"bg-light"},"CONTACT"),e("th",{class:"bg-light"},"PUROK"),e("th",{class:"bg-light"},"STATUS")])],-1)),e("tbody",null,[(g(!0),b(A,null,N(o.value,n=>(g(),b("tr",{key:n.id},[e("td",ne,y(n.first_name)+" "+y(n.middle_name||"")+" "+y(n.last_name),1),e("td",ie,y(n.contact_number),1),e("td",de,y(n.purok),1),e("td",ce,[t.contributionsIds.includes(n.id)?(g(),b("span",ue," paid ")):(g(),b("span",me," unpaid "))])]))),128))])])):(g(),b("div",pe,[l[3]||(l[3]=e("p",{class:"text-muted"},"No members found.",-1)),p.value?(g(),b("p",be,"Try clearing your search query")):D("",!0)]))],2)]))}},ve=P(ge,[["__scopeId","data-v-6073027a"]]),_e={class:"d-flex flex-row justify-content-between align-items-center px-0"},fe=["onClick"],he={__name:"PurokComponentForCollectorReport",props:{activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},deceasedId:{type:Number,default:()=>0}},setup(k){const t=k;let u=i(""),c=i("all"),p=i(0);m(()=>t.activePurok,d=>{c.value=d},{immediate:!0}),m(()=>t.activeStatus,d=>{u.value=d},{immediate:!0}),m(()=>t.deceasedId,d=>{p.value=d},{immediate:!0});const _=["purok1","purok2","purok3","purok4"],h=d=>{$.get(route("collector.togglePurok",{status:u.value,purok:d,deceasedId:p.value}),{onSuccess:()=>console.log("changing purok"),onError:r=>console.log("An error occured: ",r)})},o=d=>`Purok ${d.replace("purok","")}`;return(d,r)=>(g(),b("div",_e,[e("div",null,[(g(),b(A,null,N(_,s=>e("span",{key:s,class:w(["mx-2 purok",{"fw-bold active":s===v(c)}]),onClick:l=>h(s)},y(o(s)),11,fe)),64))])]))}},ye=P(he,[["__scopeId","data-v-7d1eccef"]]),ke={class:"d-flex flex-column align-items-center",style:{height:"120px"}},xe={class:"d-flex align-items-center gap-4"},Me={class:"fw-bold text-dark mb-0"},Se={__name:"Toggle",props:F({data:{type:Object,default:()=>({})},allDeceased:{type:Array,default:()=>[]},purok:{type:String,default:()=>""}},{deceased:{},deceasedModifiers:{}}),emits:["update:deceased"],setup(k){const t=k,u=i(t.data.report_id??null);i(t.data.member_id??null);const c=O(k,"deceased"),p=I(()=>t.allDeceased.findIndex(r=>Number(r.report_id)===Number(u.value)));function _(r){var n;if(!t.allDeceased.length)return-1;const s=t.allDeceased.length,l=(n=t.allDeceased[r])==null?void 0:n.member_id;for(let f=1;f<=s;f++){const M=(r+f)%s,x=t.allDeceased[M];if(x&&String(x.member_id)!==String(l))return M}return-1}function h(r){var n;if(!t.allDeceased.length)return-1;const s=t.allDeceased.length,l=(n=t.allDeceased[r])==null?void 0:n.member_id;for(let f=1;f<=s;f++){const M=(r-f+s)%s,x=t.allDeceased[M];if(x&&String(x.member_id)!==String(l))return M}return-1}const o=()=>{const r=p.value;if(r===-1)return;const s=h(r);if(s===-1)return;const l=t.allDeceased[s];l&&$.get(route("collector.toggleDeceased",{id:l.member_id,purok:t.purok}),{},{preserveScroll:!0})},d=()=>{const r=p.value;if(r===-1)return;const s=_(r);if(s===-1)return;const l=t.allDeceased[s];l&&(c.value=l,console.log("deceased_id: ",l.member_id),console.log("deceased_id: ",t.purok),$.get(route("collector.toggleDeceased",{id:l.member_id,purok:t.purok}),{},{preserveScroll:!0}))};return(r,s)=>(g(),b("div",ke,[s[2]||(s[2]=e("h5",{class:"mb-3"},"This contribution belongs to:",-1)),e("div",xe,[e("button",{onClick:o,class:"btn btn-light rounded-circle shadow-sm"},s[0]||(s[0]=[e("i",{class:"bi bi-arrow-left fs-4"},null,-1)])),e("h5",Me,y(t.data.deceased_name||"No name available"),1),e("button",{onClick:d,class:"btn btn-light rounded-circle shadow-sm"},s[1]||(s[1]=[e("i",{class:"bi bi-arrow-right fs-4"},null,-1)]))])]))}},Ce={key:0,class:"mt-3"},Ie={class:"purok-container container-fluid d-flex justify-content-end align-items-center"},De={class:"custom-modal"},Pe={__name:"Index",props:{contributions:{type:Array,default:()=>[]},activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},contributionsIds:{type:Array,default:()=>[]},members:{type:Array,default:()=>[]},currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(k){const t=k;let u=i([]),c=i("all"),p=i(0),_=i("paid"),h=i([]);const o=i([]),d=i([]),r=i({});m(()=>t.contributions,a=>{u.value=a,console.log("Updated contributions:",j(a)),p.value=parseInt(a.reduce((S,R)=>S+parseFloat(R.amount),0))},{immediate:!0}),m(()=>t.activePurok,a=>{c.value=a},{immediate:!0}),m(()=>t.activeStatus,a=>{_.value=a},{immediate:!0}),m(()=>t.contributionsIds,a=>{h.value=Array.isArray(a)?[...a]:[]},{immediate:!0}),m(()=>t.members,a=>{o.value=a},{immediate:!0}),m(()=>t.currentDeceasedMembers,a=>{d.value=a?Object.values(a):[]},{immediate:!0}),m(()=>t.currentDeceasedMember,a=>{r.value=a},{immediate:!0});const s=I(()=>o.value.filter(a=>h.value.includes(a.id)).length),l=I(()=>o.value.filter(a=>!h.value.includes(a.id)).length),n=I(()=>o.value.length),f=i(!1),M=()=>{f.value=!0,console.log("Report Modal Opened")},x=()=>f.value=!1;return(a,S)=>(g(),b("div",null,[C(v(L),{title:"Report"}),C(B,null,{default:V(()=>[S[0]||(S[0]=e("div",{class:"head container"},[e("h5",{class:"mb-0"},"Report"),e("p",{class:"d-none d-lg-block"},"Contribution Report")],-1)),r.value?(g(),b("div",Ce,[C(Se,{allDeceased:d.value,data:r.value,purok:v(c)},null,8,["allDeceased","data","purok"])])):D("",!0),e("div",{class:"action-buttons"},[e("button",{class:"btn btn-dark view-report",onClick:M},"View Reports")]),e("div",Ie,[C(ye,{activePurok:v(c),activeStatus:v(_),deceasedId:r.value.member_id},null,8,["activePurok","activeStatus","deceasedId"])]),C(te,{membersCount:n.value,amount:Number(v(p)),activePurok:v(c),paidMembers:s.value,unpaidMembers:l.value},null,8,["membersCount","amount","activePurok","paidMembers","unpaidMembers"]),C(ve,{activeStatus:v(_),contributionsIds:v(h),members:o.value},null,8,["activeStatus","contributionsIds","members"]),f.value?(g(),b("div",{key:1,class:"custom-modal-overlay",onClick:E(x,["self"])},[e("div",De,[e("button",{class:"close-btn",onClick:x},"Ã—"),C(q,{deceased:r.value,purok:v(c)},null,8,["deceased","purok"])])])):D("",!0)]),_:1})]))}},Ue=P(Pe,[["__scopeId","data-v-c5f6a2b7"]]);export{Ue as default};
