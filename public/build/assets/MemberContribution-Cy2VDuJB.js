import{r as v,s as C,f as i,o as r,b as e,F as x,G as E,n as j,u as p,t as n,W as B,l as H,j as q,e as S,J,x as K,a as L,g as Q,w as X,h as V,i as W,D as Z,N as ee,I as te,d as oe,z as se}from"./app-CusA85jy.js";import{_ as le}from"./not_found-DvAnRRcV.js";import{C as ne}from"./CollectorLayout-C-rBvNBU.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ae}from"./ToggleContribution-CN-ODQeY.js";import{h as ie}from"./html2pdf-CW1CwqGc.js";import"./logo1-BZ0h4foK.js";const re={class:"d-flex flex-row justify-content-between align-items-center px-0"},de=["onClick"],ue={__name:"PurokComponentForCollector",props:{activePurok:{type:String,default:()=>""},deceasedId:{type:Number,default:()=>0}},setup(D){const d=D;let a=v("");C(()=>d.activePurok,b=>{a.value=b},{immediate:!0});const k=["Purok 1","Purok 2","Purok 3","Purok 4"],y=b=>b.toLowerCase().replace(/\s+/g,""),_=b=>{console.log("deceasedId:",d.deceasedId);const h=y(b);B.get(route("collectorContribution.togglePurok",{purok:h,deceasedId:d.deceasedId}),{onSuccess:()=>console.log("Changing purok"),onError:u=>console.log("An error occurred:",u)})};return(b,h)=>(r(),i("div",re,[e("div",null,[(r(),i(x,null,E(k,u=>e("span",{key:u,class:j(["mx-2 purok",{"fw-bold active":y(u)===p(a)}]),onClick:M=>_(u)},n(u),11,de)),64))]),e("div",{class:j(["mx-2 purok",{"fw-bold active":p(a)==="all"}]),onClick:h[0]||(h[0]=u=>_("all"))}," All members ",2)]))}},ce=U(ue,[["__scopeId","data-v-2bdb649d"]]),ve={class:"header"},be={class:"deceased-name"},pe={class:"fw-light"},_e={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},fe={class:"fw-bold"},ke={class:"fw-bold"},ge={class:"table-container"},Ce={class:"members-table"},ye={class:"total-amount"},he={__name:"ViewAsCollector",props:{deceased:{type:Object,default:()=>({})},purok:String},setup(D){const d=D,a=v([]),k=v(null),y=v({}),_=v(""),b=v(!1),h=async(c,l)=>{if(!(!c||!l))try{console.log("id: ",c),console.log("purok: ",l),b.value=!0;const f=await J.get(`/collector/contributions/${c}/${l}`);a.value=f.data.contributions||[],console.log(" Contributions fetched:",a.value)}catch(f){console.error(" Error fetching contributions:",f)}finally{b.value=!1}};C([()=>d.purok],([c])=>{_.value=c},{immediate:!1}),C(()=>d.deceased,c=>{y.value=c,console.log("deceased: ",y.value)},{immediate:!0}),H(()=>{var c;(c=d.deceased)!=null&&c.member_id&&d.purok&&h(d.deceased.member_id,d.purok)});const u=q(()=>a.value.reduce((c,l)=>c+parseFloat(l.amount||0),0)),M=()=>{const c=k.value,l={filename:"Contributions_Report.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};ie().from(c).set(l).save()};return(c,l)=>{var f,P,m,O,I;return r(),i(x,null,[e("button",{onClick:M,class:"download-btn btn btn-dark px-3 ms-2",title:"Download PDF"},l[0]||(l[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:`M12 3a1 1 0 011 1v9.586l3.293-3.293a1 1 0 011.414 1.414l-5 
        5a1 1 0 01-1.414 0l-5-5a1 1 0 
        011.414-1.414L11 13.586V4a1 1 0 011-1zm-7 
        14a1 1 0 100 2h14a1 1 0 100-2H5z`})],-1)])),e("div",{ref_key:"pdfContent",ref:k,class:"document-container"},[e("div",ve,[l[3]||(l[3]=e("div",{class:"organization-name"},"BULAN P.R.O.T.E.C DAMAYAN FEDERATION",-1)),l[4]||(l[4]=e("div",{class:"organization-subtitle"},"(People's Responsible Organization Transforming Community)",-1)),l[5]||(l[5]=e("div",{class:"chapter-info fst-italic"},"Affiliated Bulan, Sorsogon Chapter Brgy. ______ C.Y 2021",-1)),l[6]||(l[6]=e("div",{class:"established fst-italic"},"Since 2016",-1)),e("div",be,[l[1]||(l[1]=S(" Deceased Name: ")),l[2]||(l[2]=e("br",null,null,-1)),e("p",pe,n(((f=y.value)==null?void 0:f.deceased_name)||""),1)])]),e("div",_e,[e("div",null,[l[7]||(l[7]=S(" Collector Name: ")),e("span",fe,n(((P=a.value[0])==null?void 0:P.collector)||""),1)]),e("div",null,[l[8]||(l[8]=S(" Purok: ")),e("span",ke,n(((I=a.value[0])==null?void 0:I.purok.charAt(((O=(m=a.value[0])==null?void 0:m.purok)==null?void 0:O.length)-1))||""),1)])]),e("div",ge,[l[10]||(l[10]=e("div",{class:"mb-3"},[e("strong",null,"MEMBERS")],-1)),e("table",Ce,[l[9]||(l[9]=e("thead",null,[e("tr",null,[e("th",null,"No."),e("th",null,"NAME"),e("th",null,"STATUS"),e("th",null,"AMOUNT")])],-1)),e("tbody",null,[(r(!0),i(x,null,E(a.value,(g,$)=>{var A,F;return r(),i("tr",{key:$},[e("td",null,n($+1),1),e("td",null,n(((A=g==null?void 0:g.member_contribution)==null?void 0:A.first_name)||"Member")+" "+n(((F=g==null?void 0:g.member_contribution)==null?void 0:F.last_name)||""),1),e("td",null,n(g.status),1),e("td",null,"₱"+n(Math.floor(g.amount).toLocaleString()),1)])}),128))])]),e("div",ye," TOTAL AMOUNT: ₱"+n(u.value.toLocaleString()),1)]),l[11]||(l[11]=e("div",{class:"signature"},[e("div",null,"Noted By:"),e("div",{class:"president-name"},"Melva Canale Delariarte"),e("div",null,"DAMAYAN PRESIDENT")],-1))],512)],64)}}},we=U(he,[["__scopeId","data-v-7322785c"]]),Me={class:"container main-container"},Pe={class:"bg-light p-2 pt-0"},me={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},xe={class:"mt-3 mb-3 search-container"},Ae={key:0,class:"mt-5"},Ne={key:1,class:"table-wrapper mt-3 desktop-view"},Se={class:"table-responsive"},De={class:"table table-bordered table-hover align-middle text-center mb-0"},Ie={class:"text-start"},$e=["onClick"],Te={key:0},Le={key:1},Ee={key:2,class:"mobile-view"},Oe={class:"mobile-cards-container"},Fe={class:"mobile-card-header"},Re={class:"mobile-member-id"},je={class:"mobile-purok"},Ve={class:"mobile-card-body"},Be={class:"mobile-field"},Ue={class:"mobile-value"},ze={class:"mobile-field"},Ye={class:"mobile-value"},We={class:"mobile-actions"},qe=["onClick"],Ge=["onClick"],He={key:3,class:"container mt-4 text-center"},Je={class:"fw-light"},Ke={class:"text-success"},Qe={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Xe={class:"modal-dialog"},Ze={class:"modal-content"},et={class:"modal-body"},tt=["value"],ot={class:"modal-footer"},st=["disabled"],lt={class:"custom-modal"},nt={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(D){const d=D;let a=v([]),k=v(""),y=v([]),_=v([]),b=v(null),h=v(""),u=v(""),M=v({});const c=v([]),l=v({});C(()=>d.member,s=>a.value=s,{immediate:!0}),C(()=>d.selectedPurok,s=>k.value=s,{immediate:!0}),C(()=>d.collectors,s=>y.value=s,{immediate:!0}),C(()=>d.paidMembersId,s=>{_.value=s,console.log("Paid Members ID updated:",s)},{immediate:!0}),C(()=>d.currentCollector,s=>M.value=s,{immediate:!0}),C(()=>d.currentDeceasedMembers,s=>c.value=s?Object.values(s):[],{immediate:!0}),C(()=>d.currentDeceasedMember,s=>l.value=s,{immediate:!0});const f=v(""),P=q(()=>{if(!f.value.trim())return a.value;const s=f.value.toLowerCase();return a.value.filter(o=>o.first_name&&o.first_name.toLowerCase().includes(s)||o.last_name&&o.last_name.toLowerCase().includes(s)||o.middle_name&&o.middle_name.toLowerCase().includes(s)||o.contact_number&&o.contact_number.toLowerCase().includes(s)||o.purok&&o.purok.toLowerCase().includes(s))}),m=K({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),O=s=>(s==null?void 0:s.toLowerCase().replace(/\s+/g,""))||"",I=(s,o,w)=>{var t,N;if(!s||!o){console.warn("Missing member data for preparePayment()");return}b.value=s,h.value=o,u.value="",B.post(route("smsNotification.sendScheduleContribution"),{id:s,message:"Successfully paid.",contact_number:w,collector:((t=M.value)==null?void 0:t.name)||"",purok:o,deceasedId:((N=l.value)==null?void 0:N.member_id)??null},{onSuccess:()=>{alert("Schedule Contribution sent successfully!")},onError:()=>{alert("Error sending Schedule Contribution")}})},g=()=>{m.member_id=b.value,m.purok=O(h.value),m.collector=u.value,m.post(route("contributions.store"),{onSuccess:()=>{const s=a.value.findIndex(o=>o.id===b.value);s!==-1&&(a.value[s]={...a.value[s],paid:!0}),se(()=>{_.value.includes(b.value)||_.value.push(b.value)}),b.value=null,u.value=""}})},$=s=>{if(!s){console.warn("No memberId passed in unPaidFunc()");return}B.delete(route("collectorContribution.deleteContribution",s),{onSuccess:()=>{const o=a.value.findIndex(w=>w.id===s);o!==-1&&(a.value[o]={...a.value[o],paid:!1}),_.value=_.value.filter(w=>w!==s)},onError:()=>{alert("Failed to unmark payment. Try again.")}})},A=v(!1),F=()=>A.value=!0,z=()=>A.value=!1,R=s=>_.value.includes(s),G=s=>{R(s.id)?$(s.id):I(s.id,s.purok,s.contact_number)};return(s,o)=>(r(),i(x,null,[L(p(Q),{title:"Member contribution"}),L(ne,null,{default:X(()=>{var w;return[e("div",Me,[e("div",Pe,[e("div",me,[o[3]||(o[3]=e("div",{class:"page-title"},[e("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),e("div",xe,[W(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[Z,f.value]])])]),L(ce,{activePurok:p(k),deceasedId:(w=l.value)==null?void 0:w.member_id},null,8,["activePurok","deceasedId"]),l.value?(r(),i("div",Ae,[L(ae,{allDeceased:c.value,purok:p(k),data:l.value,deceased:l.value,"onUpdate:deceased":o[1]||(o[1]=t=>l.value=t)},null,8,["allDeceased","purok","data","deceased"])])):V("",!0),e("div",{class:"action-buttons"},[e("button",{class:"btn btn-dark view-report",onClick:F},"View Reports")]),P.value.length>0?(r(),i("div",Ne,[e("div",Se,[e("table",De,[o[4]||(o[4]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"NAME"),e("th",null,"CONTACT NO."),e("th",null,"PUROK"),e("th",null,"STATUS")])],-1)),e("tbody",null,[(r(!0),i(x,null,E(P.value,(t,N)=>{var T;return r(),i("tr",{key:N},[e("td",Ie,n(t==null?void 0:t.first_name)+" "+n(t==null?void 0:t.middle_name)+" "+n(t==null?void 0:t.last_name),1),e("td",null,n((t==null?void 0:t.contact_number)||"undefined"),1),e("td",null,n((t==null?void 0:t.purok)||"N/A"),1),e("td",null,[e("button",{class:j(["status-btn",{"status-paid":R(t.id),"status-unpaid":!R(t.id),disabled:t.purok.slice(-1)!==((T=p(M))==null?void 0:T.purok)}]),onClick:Y=>G(t)},[R(t.id)?(r(),i("span",Te,"✔ Paid")):(r(),i("span",Le,"Mark as Paid"))],10,$e)])])}),128))])])])])):V("",!0),P.value.length>0?(r(),i("div",Ee,[e("div",Oe,[(r(!0),i(x,null,E(P.value,(t,N)=>{var T;return r(),i("div",{class:"mobile-card",key:N},[e("div",Fe,[e("div",Re,"ID: "+n(t==null?void 0:t.id),1),e("div",je,n((t==null?void 0:t.purok)||"N/A"),1)]),e("div",Ve,[e("div",Be,[o[5]||(o[5]=e("label",null,"Name:",-1)),e("span",Ue,n(t==null?void 0:t.first_name)+" "+n(t==null?void 0:t.middle_name)+" "+n(t==null?void 0:t.last_name),1)]),e("div",ze,[o[6]||(o[6]=e("label",null,"Contact:",-1)),e("span",Ye,n((t==null?void 0:t.contact_number)||"undefined"),1)]),e("div",We,[(p(_)||[]).includes(t==null?void 0:t.id)?(r(),i("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:Y=>$(t.id),title:"Mark member as unpaid"},o[7]||(o[7]=[e("i",{class:"bi bi-check-lg"},null,-1),S(" Paid ")]),8,Ge)):(r(),i("button",{key:0,class:j(["btn btn-danger btn-sm mobile-pay-btn",{disabled:t.purok.slice(-1)!==((T=p(M))==null?void 0:T.purok)}]),onClick:Y=>I(t.id,t.purok,t.contact_number),title:"Mark member as paid"}," Mark as Paid ",10,qe))])])])}),128))])])):(r(),i("div",He,[o[10]||(o[10]=e("img",{src:le,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),e("h5",Je,[o[8]||(o[8]=S(" No contribution found for ")),e("span",Ke,n(p(k)||"N/A"),1),o[9]||(o[9]=S(". "))])]))])]),o[14]||(o[14]=e("div",{class:"container extra-space bg-dark"},null,-1)),e("div",Qe,[e("div",Xe,[e("div",Ze,[o[13]||(o[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Select Collector"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",et,[W(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>ee(u)?u.value=t:u=t),class:"form-select"},[o[11]||(o[11]=e("option",{value:"",disabled:""},"Select collector",-1)),(r(!0),i(x,null,E(p(y),t=>(r(),i("option",{key:t.id,value:t.name},n(t.name),9,tt))),128))],512),[[te,p(u)]])]),e("div",ot,[o[12]||(o[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:g,disabled:!p(u),"data-bs-dismiss":"modal"}," Done ",8,st)])])])]),A.value?(r(),i("div",{key:0,class:"custom-modal-overlay",onClick:oe(z,["self"])},[e("div",lt,[e("button",{class:"close-btn",onClick:z},"×"),L(we,{deceased:l.value,purok:p(k)},null,8,["deceased","purok"])])])):V("",!0)]}),_:1})],64))}},bt=U(nt,[["__scopeId","data-v-bc81d9bf"]]);export{bt as default};
