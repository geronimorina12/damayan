import{r,s as p,j as G,x as K,f as o,o as a,a as M,u as d,g as Q,w as q,b as s,h as N,i as E,D as H,F as w,G as S,t as i,n as R,e as m,M as J,I as X,d as Y,W as U,z as Z}from"./app-B2PZaDBq.js";import{_ as ee}from"./not_found-DvAnRRcV.js";import{C as te}from"./CollectorLayout-Bi7VCnpL.js";import{P as se}from"./PurokComponentForCollector-D3Z1JS32.js";import{_ as le}from"./ToggleContribution-DiFYHC6o.js";import{V as oe}from"./ViewAsCollector-DxnRbqa7.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";import"./html2pdf-DTn4ufS3.js";const ne={class:"container main-container"},ie={class:"bg-light p-2 pt-0"},re={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},de={class:"mt-3 mb-3 search-container"},ue={key:0,class:"mt-5"},ce={key:1,class:"table-wrapper mt-3 desktop-view"},be={class:"table-responsive"},ve={class:"table table-bordered table-hover align-middle text-center mb-0"},pe={class:"text-start"},_e=["onClick"],fe={key:0},ye={key:1},ke={key:2,class:"mobile-view"},Ce={class:"mobile-cards-container"},he={class:"mobile-card-header"},ge={class:"mobile-member-id"},Me={class:"mobile-purok"},xe={class:"mobile-card-body"},Pe={class:"mobile-field"},Ae={class:"mobile-value"},we={class:"mobile-field"},Ne={class:"mobile-value"},Se={class:"mobile-actions"},me=["onClick"],Ie=["onClick"],Te={key:3,class:"container mt-4 text-center"},De={class:"fw-light"},Le={class:"text-success"},Ve={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Oe={class:"modal-dialog"},Fe={class:"modal-content"},je={class:"modal-body"},Ee=["value"],Re={class:"modal-footer"},Ue=["disabled"],ze={class:"custom-modal"},Be={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(z){const b=z;let n=r([]),y=r(""),I=r([]),v=r([]),k=r(null),T=r(""),u=r(""),C=r({});const D=r([]),c=r({});p(()=>b.member,l=>{l?Array.isArray(l.data)?n.value=l.data:Array.isArray(l)?n.value=l:n.value=[]:n.value=[],console.log("Normalized Member data:",n.value)},{immediate:!0}),p(()=>b.selectedPurok,l=>y.value=l,{immediate:!0}),p(()=>b.collectors,l=>I.value=l,{immediate:!0}),p(()=>b.paidMembersId,l=>{v.value=Array.isArray(l)?l:[]},{immediate:!0}),p(()=>b.currentCollector,l=>{C.value=l||{},console.log("Current Collector:",C.value)},{immediate:!0}),p(()=>b.currentDeceasedMembers,l=>D.value=l?Object.values(l):[],{immediate:!0}),p(()=>b.currentDeceasedMember,l=>c.value=l,{immediate:!0});const x=r(""),P=G(()=>{if(!x.value.trim())return n.value;const l=x.value.toLowerCase();return n.value.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(l)||t.last_name&&t.last_name.toLowerCase().includes(l)||t.middle_name&&t.middle_name.toLowerCase().includes(l)||t.contact_number&&t.contact_number.toLowerCase().includes(l)||t.purok&&t.purok.toLowerCase().includes(l))}),A=K({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),B=l=>(l==null?void 0:l.toLowerCase().replace(/\s+/g,""))||"",L=(l,t,_)=>{var e,f;if(!l||!t){console.warn("Missing member data for preparePayment()");return}k.value=l,T.value=t,u.value="",U.post(route("smsNotification.sendScheduleContribution"),{id:l,message:"Successfully paid.",contact_number:_,collector:((e=C.value)==null?void 0:e.name)||"",purok:t,deceasedId:((f=c.value)==null?void 0:f.member_id)??null},{onSuccess:()=>{alert("Schedule Contribution sent successfully!")},onError:()=>{alert("Error sending Schedule Contribution")}})},$=()=>{A.member_id=k.value,A.purok=B(T.value),A.collector=u.value,A.post(route("contributions.store"),{onSuccess:()=>{const l=n.value.findIndex(t=>t.id===k.value);l!==-1&&(n.value[l]={...n.value[l],paid:!0}),Z(()=>{const t=Number(k.value);v.value.includes(t)||v.value.push(t)}),k.value=null,u.value=""}})},V=l=>{if(!l){console.warn("No memberId passed in unPaidFunc()");return}U.delete(route("collectorContribution.deleteContribution",l),{onSuccess:()=>{const t=n.value.findIndex(e=>e.id===l);t!==-1&&(n.value[t]={...n.value[t],paid:!1});const _=Number(l);v.value=v.value.filter(e=>e!==_)},onError:()=>{alert("Failed to unmark payment. Try again.")}})},O=r(!1),F=()=>O.value=!1,h=l=>Array.isArray(v.value)?v.value.some(t=>t==l):!1,W=l=>{h(l.id)?V(l.id):L(l.id,l.purok,l.contact_number)};return(l,t)=>(a(),o(w,null,[M(d(Q),{title:"Member contribution"}),M(te,null,{default:q(()=>{var _;return[s("div",ne,[s("div",ie,[s("div",re,[t[3]||(t[3]=s("div",{class:"page-title"},[s("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),s("div",de,[E(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[H,x.value]])])]),M(se,{activePurok:d(y),deceasedId:(_=c.value)==null?void 0:_.member_id},null,8,["activePurok","deceasedId"]),c.value?(a(),o("div",ue,[M(le,{allDeceased:D.value,purok:d(y),data:c.value,deceased:c.value,"onUpdate:deceased":t[1]||(t[1]=e=>c.value=e)},null,8,["allDeceased","purok","data","deceased"])])):N("",!0),P.value.length>0?(a(),o("div",ce,[s("div",be,[s("table",ve,[t[4]||(t[4]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"NAME"),s("th",null,"CONTACT NO."),s("th",null,"PUROK"),s("th",null,"STATUS")])],-1)),s("tbody",null,[(a(!0),o(w,null,S(P.value,(e,f)=>{var g;return a(),o("tr",{key:f},[s("td",pe,i(e==null?void 0:e.first_name)+" "+i(e==null?void 0:e.middle_name)+" "+i(e==null?void 0:e.last_name),1),s("td",null,i((e==null?void 0:e.contact_number)||"undefined"),1),s("td",null,i((e==null?void 0:e.purok)||"N/A"),1),s("td",null,[s("button",{class:R(["status-btn",{"status-paid":h(e.id),"status-unpaid":!h(e.id),disabled:e.purok.slice(-1)!==((g=d(C))==null?void 0:g.purok)}]),onClick:j=>W(e)},[h(e.id)?(a(),o("span",fe,"✔ Paid")):(a(),o("span",ye,"Paid"))],10,_e)])])}),128))])])])])):N("",!0),P.value.length>0?(a(),o("div",ke,[s("div",Ce,[(a(!0),o(w,null,S(P.value,(e,f)=>{var g;return a(),o("div",{class:"mobile-card",key:f},[s("div",he,[s("div",ge,"ID: "+i(e==null?void 0:e.id),1),s("div",Me,i((e==null?void 0:e.purok)||"N/A"),1)]),s("div",xe,[s("div",Pe,[t[5]||(t[5]=s("label",null,"Name:",-1)),s("span",Ae,i(e==null?void 0:e.first_name)+" "+i(e==null?void 0:e.middle_name)+" "+i(e==null?void 0:e.last_name),1)]),s("div",we,[t[6]||(t[6]=s("label",null,"Contact:",-1)),s("span",Ne,i((e==null?void 0:e.contact_number)||"undefined"),1)]),s("div",Se,[h(e.id)?(a(),o("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:j=>V(e.id),title:"Mark member as unpaid"},t[7]||(t[7]=[s("i",{class:"bi bi-check-lg"},null,-1),m(" Paid ")]),8,Ie)):(a(),o("button",{key:0,class:R(["btn btn-danger btn-sm mobile-pay-btn",{disabled:e.purok.slice(-1)!==((g=d(C))==null?void 0:g.purok)}]),onClick:j=>L(e.id,e.purok,e.contact_number),title:"Mark member as paid"}," Paid ",10,me))])])])}),128))])])):(a(),o("div",Te,[t[10]||(t[10]=s("img",{src:ee,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),s("h5",De,[t[8]||(t[8]=m(" No contribution found for ")),s("span",Le,i(d(y)||"N/A"),1),t[9]||(t[9]=m(". "))])]))])]),t[14]||(t[14]=s("div",{class:"container extra-space bg-dark"},null,-1)),s("div",Ve,[s("div",Oe,[s("div",Fe,[t[13]||(t[13]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Select Collector"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s("div",je,[E(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>J(u)?u.value=e:u=e),class:"form-select"},[t[11]||(t[11]=s("option",{value:"",disabled:""},"Select collector",-1)),(a(!0),o(w,null,S(d(I),e=>(a(),o("option",{key:e.id,value:e.name},i(e.name),9,Ee))),128))],512),[[X,d(u)]])]),s("div",Re,[t[12]||(t[12]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:!d(u),"data-bs-dismiss":"modal"}," Done ",8,Ue)])])])]),O.value?(a(),o("div",{key:0,class:"custom-modal-overlay",onClick:Y(F,["self"])},[s("div",ze,[s("button",{class:"close-btn",onClick:F},"×"),M(oe,{deceased:c.value,purok:d(y)},null,8,["deceased","purok"])])])):N("",!0)]}),_:1})],64))}},Ye=ae(Be,[["__scopeId","data-v-3c90006a"]]);export{Ye as default};
