import{r as d,s as y,f as a,o as i,b as t,F as P,G as L,n as R,u as v,t as n,W as B,l as q,j as W,e as N,J as G,x as H,a as I,g as J,w as K,h as V,i as Y,D as Q,N as X,I as Z,d as tt}from"./app-ukGeU6Fu.js";import{_ as et}from"./not_found-DvAnRRcV.js";import{C as ot}from"./CollectorLayout-DHFUZfri.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as st}from"./ToggleContribution-zKza1Ztf.js";import{h as lt}from"./html2pdf-CKyQWNy7.js";import"./logo1-BZ0h4foK.js";const nt={class:"d-flex flex-row justify-content-between align-items-center px-0"},at=["onClick"],it={__name:"PurokComponentForCollector",props:{activePurok:{type:String,default:()=>""},deceasedId:{type:Number,default:()=>0}},setup(m){const u=m;let c=d("");y(()=>u.activePurok,b=>{c.value=b},{immediate:!0});const f=["purok1","purok2","purok3","purok4"],h=b=>{B.get(route("collectorContribution.togglePurok",{purok:b,deceasedId:u.deceasedId}),{onSuccess:()=>console.log("changing purok"),onError:p=>console.log("An error occured: ",p)})};return(b,p)=>(i(),a("div",nt,[t("div",null,[(i(),a(P,null,L(f,k=>t("span",{key:k,class:R(["mx-2 purok",{"fw-bold active":k===v(c)}]),onClick:g=>h(k)},n(k),11,at)),64))]),t("div",{class:R(["mx-2 purok",{"fw-bold active":v(c)=="all"}]),onClick:p[0]||(p[0]=k=>h("all"))}," All members ",2)]))}},rt=U(it,[["__scopeId","data-v-2017e254"]]),dt={class:"header"},ut={class:"deceased-name"},ct={class:"fw-light"},bt={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},vt={class:"fw-bold"},pt={class:"fw-bold"},_t={class:"table-container"},ft={class:"members-table"},kt={class:"total-amount"},gt={__name:"ViewAsCollector",props:{deceased:{type:Object,default:()=>({})},purok:String},setup(m){const u=m,c=d([]),f=d(null),h=d({}),b=d(""),p=d(!1),k=async(r,s)=>{if(!(!r||!s))try{console.log("id: ",r),console.log("purok: ",s),p.value=!0;const _=await G.get(`/collector/contributions/${r}/${s}`);c.value=_.data.contributions||[],console.log(" Contributions fetched:",c.value)}catch(_){console.error(" Error fetching contributions:",_)}finally{p.value=!1}};y([()=>u.purok],([r])=>{b.value=r},{immediate:!1}),y(()=>u.deceased,r=>{h.value=r,console.log("deceased: ",h.value)},{immediate:!0}),q(()=>{var r;(r=u.deceased)!=null&&r.member_id&&u.purok&&k(u.deceased.member_id,u.purok)});const g=W(()=>c.value.reduce((r,s)=>r+parseFloat(s.amount||0),0)),S=()=>{const r=f.value,s={filename:"Contributions_Report.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};lt().from(r).set(s).save()};return(r,s)=>{var _,M,A,E,D;return i(),a(P,null,[t("button",{onClick:S,class:"download-btn btn btn-dark px-3 ms-2",title:"Download PDF"},s[0]||(s[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:`M12 3a1 1 0 011 1v9.586l3.293-3.293a1 1 0 011.414 1.414l-5 
        5a1 1 0 01-1.414 0l-5-5a1 1 0 
        011.414-1.414L11 13.586V4a1 1 0 011-1zm-7 
        14a1 1 0 100 2h14a1 1 0 100-2H5z`})],-1)])),t("div",{ref_key:"pdfContent",ref:f,class:"document-container"},[t("div",dt,[s[3]||(s[3]=t("div",{class:"organization-name"},"BULAN P.R.O.T.E.C DAMAYAN FEDERATION",-1)),s[4]||(s[4]=t("div",{class:"organization-subtitle"},"(People's Responsible Organization Transforming Community)",-1)),s[5]||(s[5]=t("div",{class:"chapter-info fst-italic"},"Affiliated Bulan, Sorsogon Chapter Brgy. ______ C.Y 2021",-1)),s[6]||(s[6]=t("div",{class:"established fst-italic"},"Since 2016",-1)),t("div",ut,[s[1]||(s[1]=N(" Deceased Name: ")),s[2]||(s[2]=t("br",null,null,-1)),t("p",ct,n(((_=h.value)==null?void 0:_.deceased_name)||""),1)])]),t("div",bt,[t("div",null,[s[7]||(s[7]=N(" Collector Name: ")),t("span",vt,n(((M=c.value[0])==null?void 0:M.collector)||""),1)]),t("div",null,[s[8]||(s[8]=N(" Purok: ")),t("span",pt,n(((D=c.value[0])==null?void 0:D.purok.charAt(((E=(A=c.value[0])==null?void 0:A.purok)==null?void 0:E.length)-1))||""),1)])]),t("div",_t,[s[10]||(s[10]=t("div",{class:"mb-3"},[t("strong",null,"MEMBERS")],-1)),t("table",ft,[s[9]||(s[9]=t("thead",null,[t("tr",null,[t("th",null,"No."),t("th",null,"NAME"),t("th",null,"STATUS"),t("th",null,"AMOUNT")])],-1)),t("tbody",null,[(i(!0),a(P,null,L(c.value,(C,$)=>{var x,O;return i(),a("tr",{key:$},[t("td",null,n($+1),1),t("td",null,n(((x=C==null?void 0:C.member_contribution)==null?void 0:x.first_name)||"Member")+" "+n(((O=C==null?void 0:C.member_contribution)==null?void 0:O.last_name)||""),1),t("td",null,n(C.status),1),t("td",null,"₱"+n(Math.floor(C.amount).toLocaleString()),1)])}),128))])]),t("div",kt," TOTAL AMOUNT: ₱"+n(g.value.toLocaleString()),1)]),s[11]||(s[11]=t("div",{class:"signature"},[t("div",null,"Noted By:"),t("div",{class:"president-name"},"Melva Canale Delariarte"),t("div",null,"DAMAYAN PRESIDENT")],-1))],512)],64)}}},Ct=U(gt,[["__scopeId","data-v-7322785c"]]),yt={class:"container main-container"},ht={class:"bg-light p-2 pt-0"},wt={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},Mt={class:"mt-3 mb-3 search-container"},At={key:0,class:"mt-5"},Pt={key:1,class:"table-wrapper mt-3 desktop-view"},St={class:"table-responsive"},xt={class:"table table-bordered table-hover align-middle text-center mb-0"},Nt={class:"text-start"},mt=["onClick"],Dt=["onClick"],$t={key:2,class:"mobile-view"},Tt={class:"mobile-cards-container"},It={class:"mobile-card-header"},Lt={class:"mobile-member-id"},Et={class:"mobile-purok"},Ot={class:"mobile-card-body"},Rt={class:"mobile-field"},jt={class:"mobile-value"},Ft={class:"mobile-field"},Vt={class:"mobile-value"},Bt={class:"mobile-actions"},Ut=["onClick"],zt=["onClick"],Yt={key:3,class:"container mt-4 text-center"},Wt={class:"fw-light"},qt={class:"text-success"},Gt={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Ht={class:"modal-dialog"},Jt={class:"modal-content"},Kt={class:"modal-body"},Qt=["value"],Xt={class:"modal-footer"},Zt=["disabled"],te={class:"custom-modal"},ee={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(m){const u=m;let c=d([]),f=d(""),h=d([]),b=d([]),p=d(null),k=d(""),g=d(""),S=d({});const r=d([]),s=d({});y(()=>u.member,l=>c.value=l,{immediate:!0}),y(()=>u.selectedPurok,l=>f.value=l,{immediate:!0}),y(()=>u.collectors,l=>h.value=l,{immediate:!0}),y(()=>u.paidMembersId,l=>b.value=l,{immediate:!0}),y(()=>u.currentCollector,l=>{S.value=l},{immediate:!0}),y(()=>u.currentDeceasedMembers,l=>{r.value=l?Object.values(l):[]},{immediate:!0}),y(()=>u.currentDeceasedMember,l=>{s.value=l,console.log("current deceased: ",s.value)},{immediate:!0});const _=d(""),M=W(()=>{if(!_.value.trim())return c.value;const l=_.value.toLowerCase();return c.value.filter(o=>o.first_name&&o.first_name.toLowerCase().includes(l)||o.last_name&&o.last_name.toLowerCase().includes(l)||o.middle_name&&o.middle_name.toLowerCase().includes(l)||o.contact_number&&o.contact_number.toLowerCase().includes(l)||o.purok&&o.purok.toLowerCase().includes(l))}),A=H({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),E=l=>l?l.toLowerCase().replace(/\s+/g,""):"",D=(l,o,w)=>{p.value=l,k.value=o,g.value="",B.post(route("smsNotification.sendScheduleContribution"),{id:l,message:"Successfully paid.",contact_number:w,collector:S.value.name,purok:o,deceasedId:s.value.member_id||null},{onSuccess:()=>alert("Schedule Contribution sent successfully!"),onError:()=>alert("Error sending Schedule Contribution")})},C=()=>{A.member_id=p.value,A.purok=E(k.value),A.collector=g.value,A.post(route("contributions.store"),{onSuccess:()=>{const l=c.value.find(o=>o.id===p.value);l&&(l.paid=!0),b.value.includes(p.value)||b.value.push(p.value)}})},$=l=>{const o=c.value.find(w=>w.id===l);o&&(o.paid=!1),B.delete(route("collectorContribution.deleteContribution",l),{onSuccess:()=>{b.value=b.value.filter(w=>w!==l)}})},x=d(!1),O=()=>{x.value=!0},z=()=>{x.value=!1};return(l,o)=>(i(),a(P,null,[I(v(J),{title:"Member contribution"}),I(ot,null,{default:K(()=>{var w;return[t("div",yt,[t("div",ht,[t("div",wt,[o[3]||(o[3]=t("div",{class:"page-title"},[t("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),t("div",Mt,[Y(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>_.value=e),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[Q,_.value]])])]),I(rt,{activePurok:v(f),deceasedId:(w=s.value)==null?void 0:w.member_id},null,8,["activePurok","deceasedId"]),s.value?(i(),a("div",At,[I(st,{allDeceased:r.value,purok:v(f),data:s.value,deceased:s.value,"onUpdate:deceased":o[1]||(o[1]=e=>s.value=e)},null,8,["allDeceased","purok","data","deceased"])])):V("",!0),t("div",{class:"action-buttons"},[t("button",{class:"btn btn-dark view-report",onClick:O},"View Reports")]),M.value.length>0?(i(),a("div",Pt,[t("div",St,[t("table",xt,[o[5]||(o[5]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"ID"),t("th",null,"NAME"),t("th",null,"CONTACT NO."),t("th",null,"PUROK"),t("th",null,"STATUS")])],-1)),t("tbody",null,[(i(!0),a(P,null,L(M.value,(e,j)=>{var T;return i(),a("tr",{key:j},[t("td",null,n(e==null?void 0:e.id),1),t("td",Nt,n(e==null?void 0:e.first_name)+" "+n(e==null?void 0:e.middle_name)+" "+n(e==null?void 0:e.last_name),1),t("td",null,n((e==null?void 0:e.contact_number)||"undefined"),1),t("td",null,n((e==null?void 0:e.purok)||"N/A"),1),t("td",null,[(v(b)||[]).includes(e==null?void 0:e.id)?(i(),a("button",{key:1,class:"btn btn-success",onClick:F=>$(e.id),title:"Mark member as unpaid"},o[4]||(o[4]=[t("i",{class:"bi bi-check-lg"},null,-1)]),8,Dt)):(i(),a("button",{key:0,class:R(["btn btn-danger",{disabled:e.purok.slice(-1)!==((T=v(S))==null?void 0:T.purok)}]),onClick:F=>D(e.id,e.purok,e.contact_number),title:"Mark member as paid"}," Paid ",10,mt))])])}),128))])])])])):V("",!0),M.value.length>0?(i(),a("div",$t,[t("div",Tt,[(i(!0),a(P,null,L(M.value,(e,j)=>{var T;return i(),a("div",{class:"mobile-card",key:j},[t("div",It,[t("div",Lt,"ID: "+n(e==null?void 0:e.id),1),t("div",Et,n((e==null?void 0:e.purok)||"N/A"),1)]),t("div",Ot,[t("div",Rt,[o[6]||(o[6]=t("label",null,"Name:",-1)),t("span",jt,n(e==null?void 0:e.first_name)+" "+n(e==null?void 0:e.middle_name)+" "+n(e==null?void 0:e.last_name),1)]),t("div",Ft,[o[7]||(o[7]=t("label",null,"Contact:",-1)),t("span",Vt,n((e==null?void 0:e.contact_number)||"undefined"),1)]),t("div",Bt,[(v(b)||[]).includes(e==null?void 0:e.id)?(i(),a("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:F=>$(e.id),title:"Mark member as unpaid"},o[8]||(o[8]=[t("i",{class:"bi bi-check-lg"},null,-1),N(" Paid ")]),8,zt)):(i(),a("button",{key:0,class:R(["btn btn-danger btn-sm mobile-pay-btn",{disabled:e.purok.slice(-1)!==((T=v(S))==null?void 0:T.purok)}]),onClick:F=>D(e.id,e.purok,e.contact_number),title:"Mark member as paid"}," Mark as Paid ",10,Ut))])])])}),128))])])):(i(),a("div",Yt,[o[11]||(o[11]=t("img",{src:et,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),t("h5",Wt,[o[9]||(o[9]=N(" No contribution found for ")),t("span",qt,n(v(f)||"N/A"),1),o[10]||(o[10]=N(". "))])]))])]),o[15]||(o[15]=t("div",{class:"container extra-space bg-dark"},null,-1)),t("div",Gt,[t("div",Ht,[t("div",Jt,[o[14]||(o[14]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Select Collector"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Kt,[Y(t("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>X(g)?g.value=e:g=e),class:"form-select"},[o[12]||(o[12]=t("option",{value:"",disabled:""},"Select collector",-1)),(i(!0),a(P,null,L(v(h),e=>(i(),a("option",{key:e.id,value:e.name},n(e.name),9,Qt))),128))],512),[[Z,v(g)]])]),t("div",Xt,[o[13]||(o[13]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:C,disabled:!v(g),"data-bs-dismiss":"modal"}," Done ",8,Zt)])])])]),x.value?(i(),a("div",{key:0,class:"custom-modal-overlay",onClick:tt(z,["self"])},[t("div",te,[t("button",{class:"close-btn",onClick:z},"×"),I(Ct,{deceased:s.value,purok:v(f)},null,8,["deceased","purok"])])])):V("",!0)]}),_:1})],64))}},de=U(ee,[["__scopeId","data-v-b4d76819"]]);export{de as default};
