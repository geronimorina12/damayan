import{l as a,q as k,f as u,o as c,b as e,F as M,E as I,n as L,u as p,t as r,W as O,j as Y,i as B,e as N,I as q,x as H,a as P,g as W,w as K,h as Q,m as V,C as G,M as J,H as X,d as Z}from"./app-lJPr0_lx.js";import{_ as ee}from"./not_found-DvAnRRcV.js";import{C as te}from"./CollectorLayout-LRuKipK6.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as oe}from"./ToggleContribution-Bn2xHOHk.js";import{h as le}from"./html2pdf-DZ1RazyZ.js";import"./logo1-BZ0h4foK.js";const se={class:"d-flex flex-row justify-content-between align-items-center px-0"},ne=["onClick"],ae={__name:"PurokComponentForCollector",props:{activePurok:{type:String,default:()=>""},deceasedId:{type:Number,default:()=>0}},setup(A){const i=A;let d=a("");k(()=>i.activePurok,y=>{d.value=y},{immediate:!0});const f=["purok1","purok2","purok3","purok4"],C=y=>{O.get(route("collectorContribution.togglePurok",{purok:y,deceasedId:i.deceasedId}),{onSuccess:()=>console.log("changing purok"),onError:b=>console.log("An error occured: ",b)})};return(y,b)=>(c(),u("div",se,[e("div",null,[(c(),u(M,null,I(f,m=>e("span",{key:m,class:L(["mx-2 purok",{"fw-bold active":m===p(d)}]),onClick:_=>C(m)},r(m),11,ne)),64))]),e("div",{class:L(["mx-2 purok",{"fw-bold active":p(d)=="all"}]),onClick:b[0]||(b[0]=m=>C("all"))}," All members ",2)]))}},re=R(ae,[["__scopeId","data-v-2017e254"]]),ie={class:"header"},de={class:"deceased-name"},ue={class:"fw-light"},ce={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},pe={class:"fw-bold"},be={class:"fw-bold"},ve={class:"table-container"},fe={class:"members-table"},me={class:"total-amount"},_e={__name:"ViewAsCollector",props:{deceased:{type:Object,default:()=>({})},purok:String},setup(A){const i=A,d=a([]),f=a(null),C=a({}),y=a(""),b=a(!1),m=async(n,o)=>{if(!(!n||!o))try{console.log("id: ",n),console.log("purok: ",o),b.value=!0;const v=await q.get(`/collector/contributions/${n}/${o}`);d.value=v.data.contributions||[],console.log(" Contributions fetched:",d.value)}catch(v){console.error(" Error fetching contributions:",v)}finally{b.value=!1}};k([()=>i.purok],([n])=>{y.value=n},{immediate:!1}),k(()=>i.deceased,n=>{C.value=n,console.log("deceased: ",C.value)},{immediate:!0}),Y(()=>{var n;(n=i.deceased)!=null&&n.member_id&&i.purok&&m(i.deceased.member_id,i.purok)});const _=B(()=>d.value.reduce((n,o)=>n+parseFloat(o.amount||0),0)),x=()=>{const n=f.value,o={filename:"Contributions_Report.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};le().from(n).set(o).save()};return(n,o)=>{var v,S,h,D,$;return c(),u(M,null,[e("button",{onClick:x,class:"download-btn btn btn-dark px-3 ms-2",title:"Download PDF"},o[0]||(o[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:`M12 3a1 1 0 011 1v9.586l3.293-3.293a1 1 0 011.414 1.414l-5 
        5a1 1 0 01-1.414 0l-5-5a1 1 0 
        011.414-1.414L11 13.586V4a1 1 0 011-1zm-7 
        14a1 1 0 100 2h14a1 1 0 100-2H5z`})],-1)])),e("div",{ref_key:"pdfContent",ref:f,class:"document-container"},[e("div",ie,[o[3]||(o[3]=e("div",{class:"organization-name"},"BULAN P.R.O.T.E.C DAMAYAN FEDERATION",-1)),o[4]||(o[4]=e("div",{class:"organization-subtitle"},"(People's Responsible Organization Transforming Community)",-1)),o[5]||(o[5]=e("div",{class:"chapter-info fst-italic"},"Affiliated Bulan, Sorsogon Chapter Brgy. ______ C.Y 2021",-1)),o[6]||(o[6]=e("div",{class:"established fst-italic"},"Since 2016",-1)),e("div",de,[o[1]||(o[1]=N(" Deceased Name: ")),o[2]||(o[2]=e("br",null,null,-1)),e("p",ue,r(((v=C.value)==null?void 0:v.deceased_name)||""),1)])]),e("div",ce,[e("div",null,[o[7]||(o[7]=N(" Collector Name: ")),e("span",pe,r(((S=d.value[0])==null?void 0:S.collector)||""),1)]),e("div",null,[o[8]||(o[8]=N(" Purok: ")),e("span",be,r((($=d.value[0])==null?void 0:$.purok.charAt(((D=(h=d.value[0])==null?void 0:h.purok)==null?void 0:D.length)-1))||""),1)])]),e("div",ve,[o[10]||(o[10]=e("div",{class:"mb-3"},[e("strong",null,"MEMBERS")],-1)),e("table",fe,[o[9]||(o[9]=e("thead",null,[e("tr",null,[e("th",null,"No."),e("th",null,"NAME"),e("th",null,"STATUS"),e("th",null,"AMOUNT")])],-1)),e("tbody",null,[(c(!0),u(M,null,I(d.value,(g,T)=>{var w,E;return c(),u("tr",{key:T},[e("td",null,r(T+1),1),e("td",null,r(((w=g==null?void 0:g.member_contribution)==null?void 0:w.first_name)||"Member")+" "+r(((E=g==null?void 0:g.member_contribution)==null?void 0:E.last_name)||""),1),e("td",null,r(g.status),1),e("td",null,"₱"+r(Math.floor(g.amount).toLocaleString()),1)])}),128))])]),e("div",me," TOTAL AMOUNT: ₱"+r(_.value.toLocaleString()),1)]),o[11]||(o[11]=e("div",{class:"signature"},[e("div",null,"Noted By:"),e("div",{class:"president-name"},"Melva Canale Delariarte"),e("div",null,"DAMAYAN PRESIDENT")],-1))],512)],64)}}},ge=R(_e,[["__scopeId","data-v-7322785c"]]),ke={class:"container main-container"},Ce={class:"bg-light p-2 pt-0"},ye={class:"container-fluid d-flex justify-content-between align-items-center px-0"},he={class:"mt-3 mb-3 search-container"},we={key:0,class:"table-wrapper mt-3"},Me={class:"table-responsive",style:{"max-height":"600px","min-height":"800px","overflow-y":"auto"}},Ae={class:"table table-bordered table-hover align-middle text-center mb-0"},xe={class:"text-start"},Se=["onClick"],Pe=["onClick"],Ne={key:1,class:"container mt-4 text-center"},De={class:"fw-light"},$e={class:"text-success"},Te={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Ee={class:"modal-dialog"},Ie={class:"modal-content"},Le={class:"modal-body"},Oe=["value"],Re={class:"modal-footer"},je=["disabled"],Fe={class:"custom-modal"},Ve={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(A){const i=A;let d=a([]),f=a(""),C=a([]),y=a([]),b=a(null),m=a(""),_=a(""),x=a({});const n=a([]),o=a({});k(()=>i.member,s=>d.value=s,{immediate:!0}),k(()=>i.selectedPurok,s=>f.value=s,{immediate:!0}),k(()=>i.collectors,s=>C.value=s,{immediate:!0}),k(()=>i.paidMembersId,s=>y.value=s,{immediate:!0}),k(()=>i.currentCollector,s=>{x.value=s},{immediate:!0}),k(()=>i.currentDeceasedMembers,s=>{n.value=s?Object.values(s):[]},{immediate:!0}),k(()=>i.currentDeceasedMember,s=>{o.value=s,console.log("current deceased: ",o.value)},{immediate:!0});const v=a(""),S=B(()=>{if(!v.value.trim())return d.value;const s=v.value.toLowerCase();return d.value.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(s)||t.last_name&&t.last_name.toLowerCase().includes(s)||t.middle_name&&t.middle_name.toLowerCase().includes(s)||t.contact_number&&t.contact_number.toLowerCase().includes(s)||t.purok&&t.purok.toLowerCase().includes(s))}),h=H({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),D=s=>s?s.toLowerCase().replace(/\s+/g,""):"",$=(s,t,l)=>{b.value=s,m.value=t,_.value="",O.post(route("smsNotification.sendScheduleContribution"),{id:s,message:"Successfully paid.",contact_number:l,collector:x.value.name,purok:t,deceasedId:o.value.member_id||null},{onSuccess:()=>alert("Schedule Contribution sent successfully!"),onError:()=>alert("Error sending Schedule Contribution")})},g=()=>{h.member_id=b.value,h.purok=D(m.value),h.collector=_.value,h.post(route("contributions.store"),{onSuccess:()=>{const s=d.value.find(t=>t.id===b.value);s&&(s.paid=!0)}})},T=s=>{const t=d.value.find(l=>l.id===s);t&&(t.paid=!1,O.delete(route("collectorContribution.deleteContribution",s),{onSuccess:()=>{alert("Member marked as unpaid successfully.")},onError:()=>{alert("An error occurred, please try again.")}}))},w=a(!1),E=()=>{w.value=!0},j=()=>{w.value=!1};return(s,t)=>(c(),u(M,null,[P(p(W),{title:"Member contribution"}),P(te,null,{default:K(()=>[e("div",ke,[e("div",Ce,[e("div",ye,[t[3]||(t[3]=e("div",null,[e("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),e("div",he,[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>v.value=l),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[G,v.value]])])]),P(re,{activePurok:p(f),deceasedId:o.value.member_id},null,8,["activePurok","deceasedId"]),P(oe,{allDeceased:n.value,purok:p(f),data:o.value,deceased:o.value,"onUpdate:deceased":t[1]||(t[1]=l=>o.value=l)},null,8,["allDeceased","purok","data","deceased"]),e("button",{class:"btn btn-dark view-report",onClick:E},"View Reports"),S.value.length>0?(c(),u("div",we,[e("div",Me,[e("table",Ae,[t[5]||(t[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ID"),e("th",null,"NAME"),e("th",null,"CONTACT NO."),e("th",null,"PUROK"),e("th",null,"STATUS")])],-1)),e("tbody",null,[(c(!0),u(M,null,I(S.value,(l,U)=>{var F;return c(),u("tr",{key:U},[e("td",null,r(l==null?void 0:l.id),1),e("td",xe,r(l==null?void 0:l.first_name)+" "+r(l==null?void 0:l.middle_name)+" "+r(l==null?void 0:l.last_name),1),e("td",null,r((l==null?void 0:l.contact_number)||"undefined"),1),e("td",null,r((l==null?void 0:l.purok)||"N/A"),1),e("td",null,[(p(y)||[]).includes(l==null?void 0:l.id)?(c(),u("button",{key:1,class:"btn btn-success",onClick:z=>T(l.id),title:"Mark member as unpaid"},t[4]||(t[4]=[e("i",{class:"bi bi-check-lg"},null,-1)]),8,Pe)):(c(),u("button",{key:0,class:L(["btn btn-danger",{disabled:l.purok.slice(-1)!==((F=p(x))==null?void 0:F.purok)}]),onClick:z=>$(l.id,l.purok,l.contact_number),title:"Mark member as paid"}," Paid ",10,Se))])])}),128))])])])])):(c(),u("div",Ne,[t[8]||(t[8]=e("img",{src:ee,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),e("h5",De,[t[6]||(t[6]=N(" No contribution found for ")),e("span",$e,r(p(f)||"N/A"),1),t[7]||(t[7]=N(". "))])]))])]),t[12]||(t[12]=e("div",{class:"container extra-space bg-dark"},null,-1)),e("div",Te,[e("div",Ee,[e("div",Ie,[t[11]||(t[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Select Collector"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Le,[V(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>J(_)?_.value=l:_=l),class:"form-select"},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Select collector",-1)),(c(!0),u(M,null,I(p(C),l=>(c(),u("option",{key:l.id,value:l.name},r(l.name),9,Oe))),128))],512),[[X,p(_)]])]),e("div",Re,[t[10]||(t[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:g,disabled:!p(_),"data-bs-dismiss":"modal"}," Done ",8,je)])])])]),w.value?(c(),u("div",{key:0,class:"custom-modal-overlay",onClick:Z(j,["self"])},[e("div",Fe,[e("button",{class:"close-btn",onClick:j},"×"),P(ge,{deceased:o.value,purok:p(f)},null,8,["deceased","purok"])])])):Q("",!0)]),_:1})],64))}},Ke=R(Ve,[["__scopeId","data-v-b36895ac"]]);export{Ke as default};
