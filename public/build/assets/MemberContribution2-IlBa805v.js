import{r as i,s as p,j as G,x as K,f as l,o as a,a as g,u as r,g as Q,w as q,b as s,h as N,i as j,D as H,F as S,G as A,t as n,n as E,e as R,M as J,I as X,d as Y,W as U,z as Z}from"./app-D992eeml.js";import{_ as ee}from"./not_found-DvAnRRcV.js";import{C as te}from"./CollectorLayout-C3DZWkpr.js";import{P as se}from"./PurokComponentForCollector-CvcNCWSr.js";import{_ as oe}from"./ToggleContribution-BZynhjvT.js";import{V as le}from"./ViewAsCollector-CPR3wMxX.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";import"./html2pdf-ttcMTuui.js";const ne={class:"container main-container"},ie={class:"bg-light p-2 pt-0"},re={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},de={class:"mt-3 mb-3 search-container"},ue={key:0,class:"mt-5"},ce={key:1,class:"table-wrapper mt-3 desktop-view"},be={class:"table-responsive"},ve={class:"table table-bordered table-hover align-middle text-center mb-0"},pe={class:"text-start"},_e=["onClick"],fe={key:0},ke={key:1},ye={key:2,class:"mobile-view"},Ce={class:"mobile-cards-container"},he={class:"mobile-card-header"},ge={class:"mobile-member-id"},Me={class:"mobile-purok"},we={class:"mobile-card-body"},xe={class:"mobile-field"},Pe={class:"mobile-value"},Se={class:"mobile-field"},Ne={class:"mobile-value"},Ae={class:"mobile-actions"},me=["onClick"],De=["onClick"],Ie={key:3,class:"container mt-4 text-center"},Te={class:"fw-light"},Le={class:"text-success"},Ve={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Oe={class:"modal-dialog"},Fe={class:"modal-content"},je={class:"modal-body"},Ee=["value"],Re={class:"modal-footer"},Ue=["disabled"],ze={class:"custom-modal"},Be={__name:"MemberContribution2",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(z){const b=z;let d=i([]),k=i(""),m=i([]),v=i([]),y=i(null),D=i(""),u=i(""),M=i({});const I=i([]),c=i({});p(()=>b.member,o=>d.value=o,{immediate:!0}),p(()=>b.selectedPurok,o=>k.value=o,{immediate:!0}),p(()=>b.collectors,o=>m.value=o,{immediate:!0}),p(()=>b.paidMembersId,o=>{v.value=Array.isArray(o)?o:[]},{immediate:!0}),p(()=>b.currentCollector,o=>M.value=o,{immediate:!0}),p(()=>b.currentDeceasedMembers,o=>I.value=o?Object.values(o):[],{immediate:!0}),p(()=>b.currentDeceasedMember,o=>c.value=o,{immediate:!0});const w=i(""),x=G(()=>{if(!w.value.trim())return d.value;const o=w.value.toLowerCase();return d.value.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(o)||t.last_name&&t.last_name.toLowerCase().includes(o)||t.middle_name&&t.middle_name.toLowerCase().includes(o)||t.contact_number&&t.contact_number.toLowerCase().includes(o)||t.purok&&t.purok.toLowerCase().includes(o))}),P=K({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),B=o=>(o==null?void 0:o.toLowerCase().replace(/\s+/g,""))||"",T=(o,t,_)=>{var e,f;if(!o||!t){console.warn("Missing member data for preparePayment()");return}y.value=o,D.value=t,u.value="",U.post(route("smsNotification.sendScheduleContribution"),{id:o,message:"Successfully paid.",contact_number:_,collector:((e=M.value)==null?void 0:e.name)||"",purok:t,deceasedId:((f=c.value)==null?void 0:f.member_id)??null},{onSuccess:()=>{alert("Schedule Contribution sent successfully!")},onError:()=>{alert("Error sending Schedule Contribution")}})},$=()=>{P.member_id=y.value,P.purok=B(D.value),P.collector=u.value,P.post(route("contributions.store"),{onSuccess:()=>{const o=d.value.findIndex(t=>t.id===y.value);o!==-1&&(d.value[o]={...d.value[o],paid:!0}),Z(()=>{const t=Number(y.value);v.value.includes(t)||v.value.push(t)}),y.value=null,u.value=""}})},L=o=>{if(!o){console.warn("No memberId passed in unPaidFunc()");return}U.delete(route("collectorContribution.deleteContribution",o),{onSuccess:()=>{const t=d.value.findIndex(e=>e.id===o);t!==-1&&(d.value[t]={...d.value[t],paid:!1});const _=Number(o);v.value=v.value.filter(e=>e!==_)},onError:()=>{alert("Failed to unmark payment. Try again.")}})},V=i(!1),O=()=>V.value=!1,C=o=>Array.isArray(v.value)?v.value.some(t=>t==o):!1,W=o=>{C(o.id)?L(o.id):T(o.id,o.purok,o.contact_number)};return(o,t)=>(a(),l(S,null,[g(r(Q),{title:"Member contribution"}),g(te,null,{default:q(()=>{var _;return[s("div",ne,[s("div",ie,[s("div",re,[t[3]||(t[3]=s("div",{class:"page-title"},[s("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),s("div",de,[j(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[H,w.value]])])]),g(se,{activePurok:r(k),deceasedId:(_=c.value)==null?void 0:_.member_id},null,8,["activePurok","deceasedId"]),c.value?(a(),l("div",ue,[g(oe,{allDeceased:I.value,purok:r(k),data:c.value,deceased:c.value,"onUpdate:deceased":t[1]||(t[1]=e=>c.value=e)},null,8,["allDeceased","purok","data","deceased"])])):N("",!0),x.value.length>0?(a(),l("div",ce,[s("div",be,[s("table",ve,[t[4]||(t[4]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"NAME"),s("th",null,"CONTACT NO."),s("th",null,"PUROK"),s("th",null,"STATUS")])],-1)),s("tbody",null,[(a(!0),l(S,null,A(x.value,(e,f)=>{var h;return a(),l("tr",{key:f},[s("td",pe,n(e==null?void 0:e.first_name)+" "+n(e==null?void 0:e.middle_name)+" "+n(e==null?void 0:e.last_name),1),s("td",null,n((e==null?void 0:e.contact_number)||"undefined"),1),s("td",null,n((e==null?void 0:e.purok)||"N/A"),1),s("td",null,[s("button",{class:E(["status-btn",{"status-paid":C(e.id),"status-unpaid":!C(e.id),disabled:e.purok.slice(-1)!==((h=r(M))==null?void 0:h.purok)}]),onClick:F=>W(e)},[C(e.id)?(a(),l("span",fe,"✔")):(a(),l("span",ke,"Paid"))],10,_e)])])}),128))])])])])):N("",!0),x.value.length>0?(a(),l("div",ye,[s("div",Ce,[(a(!0),l(S,null,A(x.value,(e,f)=>{var h;return a(),l("div",{class:"mobile-card",key:f},[s("div",he,[s("div",ge,"ID: "+n(e==null?void 0:e.id),1),s("div",Me,n((e==null?void 0:e.purok)||"N/A"),1)]),s("div",we,[s("div",xe,[t[5]||(t[5]=s("label",null,"Name:",-1)),s("span",Pe,n(e==null?void 0:e.first_name)+" "+n(e==null?void 0:e.middle_name)+" "+n(e==null?void 0:e.last_name),1)]),s("div",Se,[t[6]||(t[6]=s("label",null,"Contact:",-1)),s("span",Ne,n((e==null?void 0:e.contact_number)||"undefined"),1)]),s("div",Ae,[C(e.id)?(a(),l("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:F=>L(e.id),title:"Mark member as unpaid"},t[7]||(t[7]=[s("i",{class:"bi bi-check-lg"},null,-1)]),8,De)):(a(),l("button",{key:0,class:E(["btn btn-danger btn-sm mobile-pay-btn",{disabled:e.purok.slice(-1)!==((h=r(M))==null?void 0:h.purok)}]),onClick:F=>T(e.id,e.purok,e.contact_number),title:"Mark member as paid"}," Paid ",10,me))])])])}),128))])])):(a(),l("div",Ie,[t[10]||(t[10]=s("img",{src:ee,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),s("h5",Te,[t[8]||(t[8]=R(" No contribution found for ")),s("span",Le,n(r(k)||"N/A"),1),t[9]||(t[9]=R(". "))])]))])]),t[14]||(t[14]=s("div",{class:"container extra-space bg-dark"},null,-1)),s("div",Ve,[s("div",Oe,[s("div",Fe,[t[13]||(t[13]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Select Collector"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s("div",je,[j(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>J(u)?u.value=e:u=e),class:"form-select"},[t[11]||(t[11]=s("option",{value:"",disabled:""},"Select collector",-1)),(a(!0),l(S,null,A(r(m),e=>(a(),l("option",{key:e.id,value:e.name},n(e.name),9,Ee))),128))],512),[[X,r(u)]])]),s("div",Re,[t[12]||(t[12]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:!r(u),"data-bs-dismiss":"modal"}," Done ",8,Ue)])])])]),V.value?(a(),l("div",{key:0,class:"custom-modal-overlay",onClick:Y(O,["self"])},[s("div",ze,[s("button",{class:"close-btn",onClick:O},"×"),g(le,{deceased:c.value,purok:r(k)},null,8,["deceased","purok"])])])):N("",!0)]}),_:1})],64))}},Ye=ae(Be,[["__scopeId","data-v-eb6c7937"]]);export{Ye as default};
