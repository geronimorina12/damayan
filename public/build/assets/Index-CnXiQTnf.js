import{C as U}from"./CollectorLayout-C4Audhxk.js";import{r as i,s as p,f as v,o as _,b as e,t as y,u as f,j as S,n as D,i as F,h as P,D as O,F as N,G as w,W as I,K as j,C as L,U as E,a as M,g as B,w as V}from"./app-x1sQ-9y5.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";const q={class:"table-wrapper mt-3"},K={class:"container-fluid header-container"},G={class:"table"},H={class:"tbody"},Q={style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},W={class:"bg-light"},z={class:"bg-light"},J={class:"bg-light"},X={class:"bg-light"},Y={class:"bg-light"},Z={__name:"SubHeaderForCollectorReport",props:{membersCount:{type:Number,default:0},amount:{type:Number,default:0},activePurok:{type:String,default:""},paidMembers:{type:Number,default:0},unpaidMembers:{type:Number,default:0}},setup(k){const t=k;let d=i(0),g=i(0),c=i(""),m=i(""),h=i("");return p(()=>t.amount,n=>{g.value=n},{immediate:!0}),p(()=>t.membersCount,n=>{d.value=n},{immediate:!0}),p(()=>t.activePurok,n=>{c.value=n},{immediate:!0}),p(()=>t.paidMembers,n=>{m.value=g.value/100},{immediate:!0}),p(()=>t.unpaidMembers,n=>{h.value=n.toString()+(n===1?" Member":" Members")},{immediate:!0}),(n,a)=>(_(),v("div",q,[e("div",K,[e("table",G,[a[0]||(a[0]=e("thead",{class:"thead"},[e("tr",{style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},[e("td",{class:"bg-light"},"MEMBERS"),e("td",{class:"bg-light"},"AMOUNT"),e("td",{class:"bg-light"},"PUROK"),e("td",{class:"bg-light"},"PAID"),e("td",{class:"bg-light"},"UNPAID")])],-1)),e("tbody",H,[e("tr",Q,[e("td",W,y(f(d))+" Members",1),e("td",z,y(f(g)),1),e("td",J,y(f(c)[5]||"All"),1),e("td",X,y(f(m)),1),e("td",Y,y(f(d)-f(m)),1)])])])])]))}},ee=C(Z,[["__scopeId","data-v-565aad73"]]),te={class:"container-fluid d-flex gap-3 align-items-center mb-3 justify-content-between"},se={class:"d-flex gap-3"},le={class:"search-box position-relative"},oe={key:0,class:"spinner-border text-primary spinner-sm position-absolute end-0 top-50 translate-middle-y me-3",role:"status"},ae={key:0,class:"table"},re={class:"bg-light pb-3"},ne={class:"bg-light pb-3"},ie={class:"bg-light pb-3"},ue={class:"bg-light text-center pb-3"},ce={key:0,class:"bg-success rounded px-2 py-1 text-light"},de={key:1,class:"bg-danger rounded px-2 py-1 text-light"},me={key:1,class:"text-center p-3"},pe={key:0,class:"text-muted small"},ge={__name:"ReportTable",props:{activeStatus:{type:String,default:"paid"},activePurok:{type:String,default:"all"},members:{type:Array,default:()=>[]},contributionsIds:{type:Array,default:()=>[]}},setup(k){const t=k,d=i([]),g=S(()=>t.activePurok),c=i(t.activeStatus),m=i(""),h=i(!1),n=()=>{c.value==="paid"?d.value=t.members.filter(u=>t.contributionsIds.includes(u.id)):c.value==="not_paid"?d.value=t.members.filter(u=>!t.contributionsIds.includes(u.id)):d.value=t.members,console.log("Filtered members in table:",d.value)},a=S(()=>{const u=m.value.trim().toLowerCase();if(!u)return console.log("No search query, showing all filtered members:",d.value.length),d.value;const s=d.value.filter(o=>{var $,A;const x=`${o.first_name} ${o.middle_name||""} ${o.last_name}`.toLowerCase(),R=(($=o.contact_number)==null?void 0:$.toLowerCase())||"",T=((A=o.purok)==null?void 0:A.toLowerCase())||"";return x.includes(u)||R.includes(u)||T.includes(u)});return console.log("Search results:",s.length),s});let r;p(m,()=>{h.value=!0,clearTimeout(r),r=setTimeout(()=>{h.value=!1},400)}),p(()=>[t.members,c.value,t.contributionsIds],()=>{console.log("Props changed - filtering members"),n()},{immediate:!0,deep:!0});const l=u=>{if(console.log("Status:",u),console.log("Purok:",g.value),c.value=u,m.value="",g.value==="all"){n();return}I.get(route("collector.toggleStatus",{status:u,purok:g.value}),{},{preserveState:!0,replace:!0})};return p(c,()=>{console.log("=== DEBUG INFO ==="),console.log("localStatus:",c.value),console.log("getMembers length:",d.value.length),console.log("filteredMembers length:",a.value.length),console.log("searchQuery:",m.value),console.log("props.members length:",t.members.length),console.log("props.contributionsIds length:",t.contributionsIds.length),console.log("===================")}),p(a,()=>{console.log("filteredMembers updated:",a.value.length)}),(u,s)=>(_(),v("div",null,[e("div",te,[e("div",se,[e("h5",{class:D(["choice",{"text-success":c.value==="paid"}]),onClick:s[0]||(s[0]=o=>l("paid"))}," PAID ",2),e("h5",{class:D(["choice",{"text-success":c.value==="not_paid"}]),onClick:s[1]||(s[1]=o=>l("not_paid"))}," UNPAID ",2)]),e("div",le,[F(e("input",{type:"text",class:"form-control",placeholder:"Search by name, contact, or purok...","onUpdate:modelValue":s[2]||(s[2]=o=>m.value=o)},null,512),[[O,m.value]]),h.value?(_(),v("div",oe,s[3]||(s[3]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):P("",!0)])]),e("div",{class:D(["table-responsive table-container",{"has-scroll":a.value.length>5}])},[a.value.length>0?(_(),v("table",ae,[s[4]||(s[4]=e("thead",null,[e("tr",null,[e("th",{class:"bg-light"},"NAME"),e("th",{class:"bg-light"},"CONTACT"),e("th",{class:"bg-light"},"PUROK"),e("th",{class:"bg-light"},"STATUS")])],-1)),e("tbody",null,[(_(!0),v(N,null,w(a.value,o=>(_(),v("tr",{key:o.id},[e("td",re,y(o.first_name)+" "+y(o.middle_name||"")+" "+y(o.last_name),1),e("td",ne,y(o.contact_number),1),e("td",ie,y(o.purok),1),e("td",ue,[t.contributionsIds.includes(o.id)?(_(),v("span",ce," paid ")):(_(),v("span",de," unpaid "))])]))),128))])])):(_(),v("div",me,[s[5]||(s[5]=e("p",{class:"text-muted"},"No members found.",-1)),m.value?(_(),v("p",pe,"Try clearing your search query")):P("",!0)]))],2)]))}},be=C(ge,[["__scopeId","data-v-9dd570a9"]]),ve={class:"d-flex flex-row justify-content-between align-items-center px-0"},_e=["onClick"],fe={__name:"PurokComponentForCollectorReport",props:{activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},deceasedId:{type:Number,default:()=>0}},setup(k){const t=k;let d=i(""),g=i("all"),c=i(0);p(()=>t.activePurok,a=>{g.value=a},{immediate:!0}),p(()=>t.activeStatus,a=>{d.value=a},{immediate:!0}),p(()=>t.deceasedId,a=>{c.value=a},{immediate:!0});const m=["purok1","purok2","purok3","purok4"],h=a=>{I.get(route("collector.togglePurok",{status:d.value,purok:a,deceasedId:c.value}),{onSuccess:()=>console.log("changing purok"),onError:r=>console.log("An error occured: ",r)})},n=a=>`Purok ${a.replace("purok","")}`;return(a,r)=>(_(),v("div",ve,[e("div",null,[(_(),v(N,null,w(m,l=>e("span",{key:l,class:D(["mx-2 purok",{"fw-bold active":l===f(g)}]),onClick:b=>h(l)},y(n(l)),11,_e)),64))])]))}},he=C(fe,[["__scopeId","data-v-7d1eccef"]]),ye={class:"d-flex flex-column align-items-center",style:{height:"120px"}},ke={class:"d-flex align-items-center gap-4"},xe={class:"fw-bold text-dark mb-0"},Me={__name:"Toggle",props:j({data:{type:Object,default:()=>({})},allDeceased:{type:Array,default:()=>[]},purok:{type:String,default:()=>""}},{deceased:{},deceasedModifiers:{}}),emits:["update:deceased"],setup(k){const t=k,d=i(t.data.report_id??null);i(t.data.member_id??null);const g=L(k,"deceased"),c=S(()=>t.allDeceased.findIndex(r=>Number(r.report_id)===Number(d.value)));function m(r){var u;if(!t.allDeceased.length)return-1;const l=t.allDeceased.length,b=(u=t.allDeceased[r])==null?void 0:u.member_id;for(let s=1;s<=l;s++){const o=(r+s)%l,x=t.allDeceased[o];if(x&&String(x.member_id)!==String(b))return o}return-1}function h(r){var u;if(!t.allDeceased.length)return-1;const l=t.allDeceased.length,b=(u=t.allDeceased[r])==null?void 0:u.member_id;for(let s=1;s<=l;s++){const o=(r-s+l)%l,x=t.allDeceased[o];if(x&&String(x.member_id)!==String(b))return o}return-1}const n=()=>{const r=c.value;if(r===-1)return;const l=h(r);if(l===-1)return;const b=t.allDeceased[l];b&&I.get(route("collector.toggleDeceased",{id:b.member_id,purok:t.purok}),{},{preserveScroll:!0})},a=()=>{const r=c.value;if(r===-1)return;const l=m(r);if(l===-1)return;const b=t.allDeceased[l];b&&(g.value=b,console.log("deceased_id: ",b.member_id),console.log("deceased_id: ",t.purok),I.get(route("collector.toggleDeceased",{id:b.member_id,purok:t.purok}),{},{preserveScroll:!0}))};return(r,l)=>(_(),v("div",ye,[l[2]||(l[2]=e("h5",{class:"mb-3"},"This contribution belongs to:",-1)),e("div",ke,[e("button",{onClick:n,class:"btn btn-light rounded-circle shadow-sm"},l[0]||(l[0]=[e("i",{class:"bi bi-arrow-left fs-4"},null,-1)])),e("h5",xe,y(t.data.deceased_name||"No name available"),1),e("button",{onClick:a,class:"btn btn-light rounded-circle shadow-sm"},l[1]||(l[1]=[e("i",{class:"bi bi-arrow-right fs-4"},null,-1)]))])]))}},Se={key:0,class:"mt-3"},De={class:"purok-container container-fluid d-flex justify-content-end align-items-center"},Ae={__name:"Index",props:{contributions:{type:Array,default:()=>[]},activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},contributionsIds:{type:Array,default:()=>[]},members:{type:Array,default:()=>[]},currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(k){const t=k;let d=i([]),g=i("all"),c=i(0),m=i("paid"),h=i([]);const n=i([]),a=i([]),r=i({});p(()=>t.contributions,s=>{d.value=s,console.log("Updated contributions:",E(s)),c.value=parseInt(s.reduce((o,x)=>o+parseFloat(x.amount),0))},{immediate:!0}),p(()=>t.activePurok,s=>{g.value=s},{immediate:!0}),p(()=>t.activeStatus,s=>{m.value=s},{immediate:!0}),p(()=>t.contributionsIds,s=>{h.value=Array.isArray(s)?[...s]:[]},{immediate:!0}),p(()=>t.members,s=>{n.value=s},{immediate:!0}),p(()=>t.currentDeceasedMembers,s=>{a.value=s?Object.values(s):[]},{immediate:!0}),p(()=>t.currentDeceasedMember,s=>{r.value=s},{immediate:!0});const l=S(()=>n.value.filter(s=>h.value.includes(s.id)).length),b=S(()=>n.value.filter(s=>!h.value.includes(s.id)).length),u=S(()=>n.value.length);return(s,o)=>(_(),v("div",null,[M(f(B),{title:"Report"}),M(U,null,{default:V(()=>[o[0]||(o[0]=e("div",{class:"head container"},[e("h5",{class:"mb-0"},"Report"),e("p",{class:"d-none d-lg-block"},"Contribution Report")],-1)),r.value?(_(),v("div",Se,[M(Me,{allDeceased:a.value,data:r.value,purok:f(g)},null,8,["allDeceased","data","purok"])])):P("",!0),e("div",De,[M(he,{activePurok:f(g),activeStatus:f(m),deceasedId:r.value.member_id},null,8,["activePurok","activeStatus","deceasedId"])]),M(ee,{membersCount:u.value,amount:Number(f(c)),activePurok:f(g),paidMembers:l.value,unpaidMembers:b.value},null,8,["membersCount","amount","activePurok","paidMembers","unpaidMembers"]),M(be,{activeStatus:f(m),contributionsIds:f(h),members:n.value},null,8,["activeStatus","contributionsIds","members"])]),_:1})]))}};export{Ae as default};
