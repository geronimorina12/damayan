import{q as ie,r as f,j as z,x as Z,s as T,C as re,f as u,o as c,b as e,h as S,e as q,t as p,d as F,i as $,D as w,u as o,n as P,I as H,E as oe,F as W,G as Y,l as ee,J as te,a as U,w as O,T as X,S as Q,W as J,m as ue,g as ce,K as me,z as be}from"./app-BduWwRy9.js";import{A as ve}from"./AdminLayout-D32tZ7BG.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";const ae=ie("modalStore",()=>{const B=f(!1);return{closeAddMemberModal:B,triggerCloseMemberModal:()=>{B.value=!0},resetModal:()=>{B.value=!1}}}),pe={class:"container-fluid d-flex flex-row justify-content-center main-container"},fe={class:"container mt-5"},ge={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},ye={class:"row g-3"},_e={class:"col-md-6"},he={class:"col-md-6"},$e=["max"],ke={key:0,class:"invalid-feedback d-block"},we={class:"col-md-6"},Me={class:"col-md-6"},xe={class:"col-md-6"},Ce={class:"col-md-6"},Se={class:"col-md-6"},Ae={class:"col-md-6"},Ne={class:"col-md-6"},Be={class:"col-md-6"},Ve={key:0,class:"text-danger small mt-1"},Ee={class:"col-12"},Ue={class:"mt-4"},De={key:0,class:"text-center mt-3 text-muted"},Ie={key:1,class:"table-responsive mt-2"},Te={class:"table table-bordered table-striped align-middle"},Le=["onClick"],qe={class:"d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 gap-3"},Re={key:1,class:"card mt-4 p-3 shadow-sm"},Fe={class:"col-md-6"},Oe={class:"col-md-6"},Pe={class:"col-md-6"},je={class:"col-md-6"},He={key:0,class:"invalid-feedback d-block"},We={class:"col-12 d-flex justify-content-end gap-2 mt-3"},Ge=["disabled"],ze={__name:"AddNewMember",props:{show:{},showModifiers:{}},emits:["update:show"],setup(B){const i=ae(),s=f({name:"",relation:"",age:"",birth_date:""}),b=f([]),g=f(!1),n=f(""),k=f(""),x=f("");f(!1),z(()=>new Date().getFullYear());const M=C=>{if(!C)return"";const t=new Date,d=new Date(C);let V=t.getFullYear()-d.getFullYear();const G=t.getMonth()-d.getMonth();return(G<0||G===0&&t.getDate()<d.getDate())&&V--,console.log("Calculated age: ",V.toString()),V.toString()},D=(C,t)=>{if(!C)return t.value="",!0;const d=new Date(C),V=new Date;return d.setHours(0,0,0,0),V.setHours(0,0,0,0),d>V?(t.value="Birth date cannot be in the future.",!1):(t.value="",!0)},v=Z({first_name:"",last_name:"",address:"Bonga, Bulan, Sorsogon",contact_number:"",date_of_birth:"",purok:"",age:"",middle_name:"",status:"active",occupation:"",gender:"",beneficiaries:[]});T(()=>v.date_of_birth,C=>{const t=D(C,x);C&&t?v.age=M(C):v.age=""}),T(()=>s.value.birth_date,C=>{const t=D(C,k);C&&t?s.value.age=M(C):s.value.age=""});const L=()=>{if(v.clearErrors(),!/^0\d{10}$/.test(v.contact_number)){v.setError("contact_number","Contact number must start with 0 and be exactly 11 digits.");return}i.triggerCloseMemberModal(),D(v.date_of_birth,x)&&(i.triggerCloseMemberModal(),v.beneficiaries=b.value,v.post(route("addMemberPost"),{onSuccess:()=>{n.value="Member added successfully!",I.value=!0,setTimeout(()=>n.value="",4e3)},onError:t=>console.log("An error occurred => ",t)}))},h=()=>{D(s.value.birth_date,k)&&(b.value.push({...s.value}),s.value={name:"",relation:"",age:"",birth_date:""},k.value="",g.value=!1)},l=C=>{b.value.splice(C,1)},a=C=>{const t={year:"numeric",month:"long",day:"numeric"};return new Date(C).toLocaleDateString(void 0,t)},y=z(()=>{const C=new Date,t=C.getFullYear()-16,d=String(C.getMonth()+1).padStart(2,"0"),V=String(C.getDate()).padStart(2,"0");return`${t}-${d}-${V}`}),A=re(B,"show"),I=f(!1);return i.triggerCloseMemberModal(),(C,t)=>(c(),u("div",pe,[e("div",fe,[n.value?(c(),u("div",ge,[q(p(n.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=d=>n.value="")})])):S("",!0),e("form",{onSubmit:F(L,["prevent"]),class:"form"},[e("div",ye,[e("div",_e,[t[21]||(t[21]=e("label",{class:"form-label"},"Last name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Marinda","onUpdate:modelValue":t[1]||(t[1]=d=>o(v).last_name=d)},null,512),[[w,o(v).last_name]])]),e("div",he,[t[22]||(t[22]=e("label",{class:"form-label"},"Birth date",-1)),$(e("input",{type:"date",id:"birthDate",class:P(["form-control",{"is-invalid":x.value}]),"onUpdate:modelValue":t[2]||(t[2]=d=>o(v).date_of_birth=d),max:y.value},null,10,$e),[[w,o(v).date_of_birth]]),x.value?(c(),u("div",ke,p(x.value),1)):S("",!0)]),e("div",we,[t[23]||(t[23]=e("label",{class:"form-label"},"First name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Jovan","onUpdate:modelValue":t[3]||(t[3]=d=>o(v).first_name=d),required:""},null,512),[[w,o(v).first_name]])]),e("div",Me,[t[24]||(t[24]=e("label",{class:"form-label"},"Age",-1)),$(e("input",{type:"number",class:"form-control",placeholder:"0","onUpdate:modelValue":t[4]||(t[4]=d=>o(v).age=d),required:"",disabled:""},null,512),[[w,o(v).age]])]),e("div",xe,[t[25]||(t[25]=e("label",{class:"form-label"},"Middle name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Munticalbo","onUpdate:modelValue":t[5]||(t[5]=d=>o(v).middle_name=d)},null,512),[[w,o(v).middle_name]])]),e("div",Ce,[t[27]||(t[27]=e("label",{class:"form-label"},"Gender",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=d=>o(v).gender=d),required:""},t[26]||(t[26]=[e("option",{value:"",disabled:""},"Select gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[H,o(v).gender]])]),e("div",Se,[t[29]||(t[29]=e("label",{class:"form-label"},"status",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=d=>o(v).status=d),disabled:""},t[28]||(t[28]=[e("option",{value:"active",selected:""},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[H,o(v).status]])]),e("div",Ae,[t[31]||(t[31]=e("label",{class:"form-label"},"Purok",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[8]||(t[8]=d=>o(v).purok=d),required:""},t[30]||(t[30]=[oe('<option value="" disabled selected data-v-2b186b1c>Select Purok</option><option value="Purok 1" data-v-2b186b1c>Purok 1</option><option value="Purok 2" data-v-2b186b1c>Purok 2</option><option value="Purok 3" data-v-2b186b1c>Purok 3</option><option value="Purok 4" data-v-2b186b1c>Purok 4</option>',5)]),512),[[H,o(v).purok]])]),e("div",Ne,[t[32]||(t[32]=e("label",{class:"form-label"},"Occupation",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Farmer","onUpdate:modelValue":t[9]||(t[9]=d=>o(v).occupation=d),required:""},null,512),[[w,o(v).occupation]])]),e("div",Be,[t[33]||(t[33]=e("label",{class:"form-label"},"Contact no.",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"09768734123","onUpdate:modelValue":t[10]||(t[10]=d=>o(v).contact_number=d),pattern:"[0-9]*",inputmode:"numeric"},null,512),[[w,o(v).contact_number]]),o(v).errors.contact_number?(c(),u("div",Ve,p(o(v).errors.contact_number),1)):S("",!0)]),e("div",Ee,[t[34]||(t[34]=e("label",{class:"form-label"},"Address",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Bonga, Bulan, Sorsogon","onUpdate:modelValue":t[11]||(t[11]=d=>o(v).address=d),required:"",disabled:""},null,512),[[w,o(v).address]])])]),e("div",Ue,[t[36]||(t[36]=e("h5",{class:"text-dark fw-light"},"Beneficiary",-1)),b.value.length===0?(c(),u("div",De," No beneficiary added ")):(c(),u("div",Ie,[e("table",Te,[t[35]||(t[35]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Relation"),e("th",null,"Age"),e("th",null,"Birthdate"),e("th",null,"Action")])],-1)),e("tbody",null,[(c(!0),u(W,null,Y(b.value,(d,V)=>(c(),u("tr",{key:V},[e("td",null,p(d.name),1),e("td",null,p(d.relation),1),e("td",null,p(d.age),1),e("td",null,p(a(d.birth_date)),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:G=>l(V)}," Delete ",8,Le)])]))),128))])])]))]),e("div",qe,[g.value?S("",!0):(c(),u("button",{key:0,class:"btn btn-primary w-100 w-md-auto",type:"button",onClick:t[12]||(t[12]=d=>g.value=!0)}," Add Beneficiary ")),t[37]||(t[37]=e("button",{class:"btn btn-success w-100 w-md-auto",type:"submit"},"Submit",-1))])],32),g.value?(c(),u("div",Re,[t[43]||(t[43]=e("h5",{class:"mb-3"},"Add Beneficiary",-1)),e("form",{onSubmit:F(h,["prevent"]),class:"row g-2"},[e("div",Fe,[t[38]||(t[38]=e("label",null,"Name",-1)),$(e("input",{type:"text",placeholder:"Name",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=d=>s.value.name=d),required:""},null,512),[[w,s.value.name]])]),e("div",Oe,[t[40]||(t[40]=e("label",null,"Relation",-1)),$(e("select",{name:"selectRelation",id:"selectRelation",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=d=>s.value.relation=d),required:""},t[39]||(t[39]=[oe('<option value="" disabled data-v-2b186b1c>Select relation</option><option value="mother" data-v-2b186b1c>Mother</option><option value="father" data-v-2b186b1c>Father</option><option value="son" data-v-2b186b1c>Son</option><option value="daughter" data-v-2b186b1c>Daughter</option><option value="adopted" data-v-2b186b1c>Adopted</option>',6)]),512),[[H,s.value.relation]])]),e("div",Pe,[t[41]||(t[41]=e("label",null,"Age",-1)),$(e("input",{type:"number",placeholder:"Age",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=d=>s.value.age=d),disabled:"",required:""},null,512),[[w,s.value.age]])]),e("div",je,[t[42]||(t[42]=e("label",{class:"form-label small"},"Birthdate",-1)),$(e("input",{type:"date",class:P(["form-control",{"is-invalid":k.value}]),"onUpdate:modelValue":t[16]||(t[16]=d=>s.value.birth_date=d),required:""},null,2),[[w,s.value.birth_date]]),k.value?(c(),u("div",He,p(k.value),1)):S("",!0)]),e("div",We,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[17]||(t[17]=d=>g.value=!1)}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:!!k.value||!s.value.birth_date}," Save Beneficiary ",8,Ge)])],32)])):S("",!0)]),A.value?(c(),u("div",{key:0,class:"modal-overlay",onClick:t[20]||(t[20]=(...d)=>I.value&&I.value(...d))},[e("div",{class:"modal-box",onClick:t[19]||(t[19]=F(()=>{},["stop"]))},[t[44]||(t[44]=e("p",null,"Member created",-1)),e("button",{class:"close-btn",onClick:t[18]||(t[18]=(...d)=>I.value&&I.value(...d))},"OK")])])):S("",!0)]))}},Ye=j(ze,[["__scopeId","data-v-2b186b1c"]]),Ke={class:"container mt-4"},Je={key:0,class:"text-center my-5"},Xe={key:1,class:"alert alert-danger"},Qe={key:2,class:"table-responsive"},Ze={class:"table table-striped table-bordered shadow-sm"},et={key:3,class:"alert alert-info"},tt={__name:"NewlyCreated",setup(B){const i=f([]),s=f(!0),b=f(null),g=async()=>{var k,x;try{const M=await te.get("/member/new");i.value=M.data.data}catch(M){b.value=((x=(k=M.response)==null?void 0:k.data)==null?void 0:x.message)||"Failed to fetch latest members."}finally{s.value=!1}},n=k=>new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return ee(g),(k,x)=>(c(),u("div",Ke,[s.value?(c(),u("div",Je,x[0]||(x[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):b.value?(c(),u("div",Xe,p(b.value),1)):i.value.length?(c(),u("div",Qe,[e("table",Ze,[x[1]||(x[1]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Address"),e("th",null,"Contact"),e("th",null,"Age"),e("th",null,"Gender"),e("th",null,"Registration Date")])],-1)),e("tbody",null,[(c(!0),u(W,null,Y(i.value,M=>(c(),u("tr",{key:M.id},[e("td",null,p(M.first_name)+" "+p(M.middle_name)+" "+p(M.last_name),1),e("td",null,p(M.address),1),e("td",null,p(M.contact_number),1),e("td",null,p(M.age),1),e("td",null,p(M.gender),1),e("td",null,p(n(M.created_at)),1)]))),128))])])])):(c(),u("div",et," No newly registered members found. "))]))}},st=j(tt,[["__scopeId","data-v-cb085a94"]]),lt={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},ot={id:"addNewMemberModal",class:"custom-modal"},at={class:"modal-content",style:{"min-width":"60%",height:"auto"}},nt={class:"modal-header"},dt={class:"modal-body"},it={id:"newCreatedMemberModal",class:"custom-modal",style:{"padding-top":"0"}},rt={class:"modal-content",style:{"min-width":"60%",height:"auto"}},ut={class:"modal-header alig-items-center"},ct={class:"modal-body"},mt={key:0,class:"modal-overlay"},bt={class:"modal-box"},vt={__name:"Header",setup(B){const i=ae(),s=g=>{document.getElementById(g).classList.add("show")},b=g=>{document.getElementById(g).classList.remove("show")};return T(()=>i.closeAddMemberModal,g=>{g&&(b("addNewMemberModal"),i.resetModal())}),window.addEventListener("click",g=>{document.querySelectorAll(".custom-modal").forEach(n=>{g.target===n&&n.classList.remove("show")})}),(g,n)=>(c(),u("div",null,[e("div",lt,[n[7]||(n[7]=e("div",null,[e("h5",{class:"ms-3 fw-light"},[e("span",{class:"d-none d-sm-none d-lg-inline-block me-2"},"Registered"),e("span",null,"Members")])],-1)),e("div",null,[e("button",{class:"modern-btn me-3",onClick:n[0]||(n[0]=F(k=>s("addNewMemberModal"),["prevent"]))},n[5]||(n[5]=[e("i",{class:"bi bi-person-plus"},null,-1),e("span",null,"Add Member",-1)])),e("button",{class:"modern-btn secondary",onClick:n[1]||(n[1]=k=>s("newCreatedMemberModal"))},n[6]||(n[6]=[e("i",{class:"bi bi-person-lines-fill"},null,-1),e("span",null,"Newly Created",-1)]))])]),e("div",ot,[e("div",at,[e("div",nt,[n[8]||(n[8]=e("h3",null,"Add New Member",-1)),e("button",{class:"close-btn",onClick:n[2]||(n[2]=k=>b("addNewMemberModal"))},"Ã—")]),e("div",dt,[U(Ye)])])]),e("div",it,[e("div",rt,[e("div",ut,[n[9]||(n[9]=e("div",{class:""},[e("h4",{class:"mb-3 text-dark fw-bold d-flex align-items-center"}," Newly Registered Member ")],-1)),e("button",{class:"close-btn2 fs-2",onClick:n[3]||(n[3]=k=>b("newCreatedMemberModal"))},"Ã—")]),e("div",ct,[U(st)])])]),o(i).closeAddMemberModal?(c(),u("div",mt,[e("div",bt,[n[10]||(n[10]=e("p",null,"Successfully created",-1)),e("button",{class:"close-btn",onClick:n[4]||(n[4]=k=>o(i).resetModal())},"OK")])])):S("",!0)]))}},pt=j(vt,[["__scopeId","data-v-d52fd133"]]),ft={__name:"Alert",props:{status:{type:Boolean,default:!1},name:{type:String,default:""}},setup(B){const i=B,s=f(!1),b=f(null),g=f("");return T(()=>i.status,n=>{b.value=n,g.value="bounce-in",s.value=!0,setTimeout(()=>{g.value="slide-out",setTimeout(()=>{s.value=!1},500)},3e3)}),(n,k)=>(c(),u("div",null,[s.value?(c(),u("div",{key:0,class:P(["alert alert-info",g.value]),role:"alert"},[q(p(B.name)+"'s status has been changed to ",1),e("strong",null,p(b.value?"Active":"Inactive"),1)],2)):S("",!0)]))}},gt=j(ft,[["__scopeId","data-v-f19df27b"]]),yt={class:"reminder-wrapper"},_t={class:"card shadow-sm p-4 rounded-4 bg-white border-0"},ht={key:0,class:"mb-4 text-center"},$t={class:"fw-bold text-primary mb-1"},kt={class:"text-muted mb-0"},wt={class:"row g-3"},Mt={class:"col-md-6"},xt={key:0,class:"invalid-feedback d-block"},Ct={class:"col-md-6"},St={key:0,class:"mt-4"},At={key:0,class:"mt-4 d-flex flex-wrap gap-3 justify-content-center"},Nt={__name:"IsDeceased",props:{deceasedMember:{type:Object,default:()=>({})}},setup(B){const i=Z({message:"",type:"deathReport",memberId:null,lastNight:"",startOfContribution:""}),s=B,b=f({}),g=f(""),n=f(""),k=f(!1),x=f(""),M=z(()=>!!x.value),D=z(()=>i.lastNight&&i.startOfContribution&&!M.value);ee(()=>{const a=new Date;i.startOfContribution=a.toISOString().split("T")[0]}),T(()=>s.deceasedMember,a=>{b.value=a},{immediate:!0});const v=a=>{if(!a){x.value="";return}const y=new Date(a),A=new Date;y.setHours(0,0,0,0),A.setHours(0,0,0,0),y<=A?x.value="The last night date cannot be set today or a past date.":x.value=""};T(()=>i.lastNight,a=>{v(a)}),T([()=>i.lastNight,()=>i.startOfContribution],([a,y])=>{var A;if(a&&y&&((A=b.value)!=null&&A.first_name)&&!M.value){const I=b.value;i.message=`We regret to inform you that ${I.first_name} ${I.last_name} has passed away. Last night is on ${l(a)}, and the collection for burial assistance starts on ${l(y)}.`,i.memberId=I.id}else i.message=""},{immediate:!0});function L(){if(!i.memberId){h("Missing member ID. Please select a member first.","danger");return}if(M.value){h("Please fix the validation errors before sending.","danger");return}J.post(route("smsNotification.sendReminders"),{message:i.message,type:i.type,memberId:i.memberId,lastNight:i.lastNight,startOfContribution:i.startOfContribution},{onSuccess:()=>h("SMS sent successfully."),onError:()=>h("An error occurred while sending SMS.")})}function h(a,y){g.value=a,n.value=y,k.value=!0,setTimeout(()=>k.value=!1,4e3)}const l=a=>{const y={year:"numeric",month:"long",day:"numeric"};return new Date(a).toLocaleDateString(void 0,y)};return(a,y)=>(c(),u("div",yt,[e("div",_t,[U(X,{name:"fade"},{default:O(()=>[k.value?(c(),u("div",{key:0,class:P([["alert",n.value==="success"?"alert-success":"alert-danger"],"alert-dismissible fade show mb-3"]),role:"alert"},[q(p(g.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:y[0]||(y[0]=A=>k.value=!1),"aria-label":"Close"})],2)):S("",!0)]),_:1}),b.value.first_name?(c(),u("div",ht,[e("h4",$t,p(b.value.first_name)+" "+p(b.value.middle_name)+" "+p(b.value.last_name),1),e("p",kt,p(b.value.address),1)])):S("",!0),e("div",wt,[e("div",Mt,[y[4]||(y[4]=e("label",{class:"form-label fw-semibold text-secondary"},"Enter last night:",-1)),$(e("input",{type:"date",class:P(["form-control",{"is-invalid":M.value}]),"onUpdate:modelValue":y[1]||(y[1]=A=>o(i).lastNight=A)},null,2),[[w,o(i).lastNight]]),M.value?(c(),u("div",xt,p(x.value),1)):S("",!0)]),e("div",Ct,[y[5]||(y[5]=e("label",{class:"form-label fw-semibold text-secondary"},"Start of contribution:",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":y[2]||(y[2]=A=>o(i).startOfContribution=A)},null,512),[[w,o(i).startOfContribution]])])]),U(X,{name:"fade"},{default:O(()=>[o(i).message&&!M.value?(c(),u("div",St,[y[6]||(y[6]=e("label",{class:"form-label fw-semibold text-secondary"},"Message:",-1)),$(e("textarea",{class:"form-control","onUpdate:modelValue":y[3]||(y[3]=A=>o(i).message=A),rows:"4",style:{resize:"vertical","min-height":"100px"}},null,512),[[w,o(i).message]])])):S("",!0)]),_:1}),U(X,{name:"fade"},{default:O(()=>{var A;return[D.value?(c(),u("div",At,[U(o(Q),{href:a.route("smsNotification.sendToAllSelectedV2",{type:"deathReport",message:o(i).message,deceased:(A=b.value)==null?void 0:A.id,last:o(i).lastNight}),class:"btn-modern text-decoration-none"},{default:O(()=>y[7]||(y[7]=[e("i",{class:"bi bi-people-fill me-2"},null,-1),q("Send to all selected ")])),_:1},8,["href"]),e("button",{class:"btn-modern",onClick:L},y[8]||(y[8]=[e("i",{class:"bi bi-send-fill me-2"},null,-1),q("Send ")]))])):S("",!0)]}),_:1})])]))}},Bt=j(Nt,[["__scopeId","data-v-757f73ae"]]),Vt={class:"container-fluid d-flex flex-row justify-content-center main-container"},Et={class:"container mt-5"},Ut={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},Dt={class:"row g-3"},It={class:"col-12 d-md-none"},Tt={class:"row g-2"},Lt={class:"col-12"},qt={class:"col-12"},Rt={class:"col-12"},Ft={class:"col-md-4 d-none d-md-block"},Ot={class:"col-md-4 d-none d-md-block"},Pt={class:"col-md-4 d-none d-md-block"},jt={class:"col-12 col-md-6"},Ht={class:"col-12 col-md-6"},Wt={class:"col-12 col-md-6"},Gt={class:"col-12 col-md-6"},zt={class:"col-12 col-md-6"},Yt={class:"col-12 col-md-6"},Kt={class:"col-12 col-md-6"},Jt={key:0,class:"text-danger small mt-1"},Xt={class:"col-12"},Qt={class:"mt-4"},Zt={key:0,class:"text-center mt-3 text-muted"},es={key:1,class:"table-responsive mt-2"},ts={class:"table table-bordered table-striped align-middle"},ss=["onClick"],ls={class:"d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 gap-3"},os={key:1,class:"card mt-4 p-3 shadow-sm"},as={class:"col-md-6"},ns={class:"col-md-6"},ds={class:"col-md-6"},is={class:"col-md-6"},rs={class:"col-12 d-flex justify-content-end gap-2 mt-3"},us={__name:"EditMember",props:{member:{type:Object,default:()=>({})}},setup(B){const i=B,s=Z({first_name:"",last_name:"",address:"",contact_number:"",date_of_birth:"",purok:"",age:"",middle_name:"",status:"",occupation:"",gender:"",beneficiaries:[]}),b=f([]),g=f({name:"",relation:"",age:"",birth_date:""}),n=f(!1),k=f(""),x=async h=>{if(!h){console.log("No member ID provided");return}try{const l=await te.get(route("beneficiaries.fetch",{member:h}));l.data.success?(b.value=l.data.data,console.log("Beneficiaries fetched successfully:",l.data.data)):console.error("Failed to fetch beneficiaries:",l.data.message)}catch(l){console.error("Error fetching beneficiaries:",l)}};T(()=>i.member,h=>{h&&(s.first_name=h.first_name||"",s.last_name=h.last_name||"",s.address=h.address||"",s.contact_number=h.contact_number||"",s.date_of_birth=h.date_of_birth||"",s.purok=h.purok||"",s.age=h.age||"",s.middle_name=h.middle_name||"",s.status=h.status||"",s.occupation=h.occupation||"",s.gender=h.gender||"",s.beneficiaries=h.beneficiaries||[],h.id&&x(h.id))},{immediate:!0,deep:!0});const M=()=>{if(s.clearErrors(),!/^0\d{10}$/.test(s.contact_number)){s.setError("contact_number","Contact number must start with 0 and be exactly 11 digits.");return}s.beneficiaries=b.value,s.put(route("members.update",i.member.id),{onSuccess:()=>{k.value="Member updated successfully!",setTimeout(()=>k.value="",4e3),x(i.member.id)},onError:l=>console.error("An error occurred => ",l)})},D=()=>{const h={...g.value,member_id:i.member.id};b.value.push(h),g.value={name:"",relation:"",age:"",birth_date:""},n.value=!1},v=h=>{b.value.splice(h,1)},L=h=>{if(!h)return"";const l={year:"numeric",month:"long",day:"numeric"};return new Date(h).toLocaleDateString(void 0,l)};return(h,l)=>(c(),u("div",Vt,[e("div",Et,[k.value?(c(),u("div",Ut,[q(p(k.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=a=>k.value="")})])):S("",!0),e("form",{onSubmit:F(M,["prevent"]),class:"form"},[e("div",Dt,[e("div",It,[e("div",Tt,[e("div",Lt,[$(e("input",{type:"text",class:"form-control",placeholder:"First name","onUpdate:modelValue":l[1]||(l[1]=a=>o(s).first_name=a),required:""},null,512),[[w,o(s).first_name]])]),e("div",qt,[$(e("input",{type:"text",class:"form-control",placeholder:"Middle name","onUpdate:modelValue":l[2]||(l[2]=a=>o(s).middle_name=a)},null,512),[[w,o(s).middle_name]])]),e("div",Rt,[$(e("input",{type:"text",class:"form-control",placeholder:"Last name","onUpdate:modelValue":l[3]||(l[3]=a=>o(s).last_name=a)},null,512),[[w,o(s).last_name]])])])]),e("div",Ft,[$(e("input",{type:"text",class:"form-control",placeholder:"First name","onUpdate:modelValue":l[4]||(l[4]=a=>o(s).first_name=a),required:""},null,512),[[w,o(s).first_name]])]),e("div",Ot,[$(e("input",{type:"text",class:"form-control",placeholder:"Middle name","onUpdate:modelValue":l[5]||(l[5]=a=>o(s).middle_name=a)},null,512),[[w,o(s).middle_name]])]),e("div",Pt,[$(e("input",{type:"text",class:"form-control",placeholder:"Last name","onUpdate:modelValue":l[6]||(l[6]=a=>o(s).last_name=a)},null,512),[[w,o(s).last_name]])]),e("div",jt,[l[21]||(l[21]=e("label",{class:"form-label"},"Birth date",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":l[7]||(l[7]=a=>o(s).date_of_birth=a)},null,512),[[w,o(s).date_of_birth]])]),e("div",Ht,[$(e("input",{type:"number",class:"form-control",placeholder:"Age","onUpdate:modelValue":l[8]||(l[8]=a=>o(s).age=a),required:""},null,512),[[w,o(s).age]])]),e("div",Wt,[$(e("select",{class:"form-select","onUpdate:modelValue":l[9]||(l[9]=a=>o(s).gender=a),required:""},l[22]||(l[22]=[e("option",{value:"",disabled:""},"Gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[H,o(s).gender]])]),e("div",Gt,[$(e("select",{class:"form-select","onUpdate:modelValue":l[10]||(l[10]=a=>o(s).status=a),required:""},l[23]||(l[23]=[e("option",{value:"",disabled:""},"Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[H,o(s).status]])]),e("div",zt,[$(e("input",{type:"text",class:"form-control",placeholder:"Purok","onUpdate:modelValue":l[11]||(l[11]=a=>o(s).purok=a),required:""},null,512),[[w,o(s).purok]])]),e("div",Yt,[$(e("input",{type:"text",class:"form-control",placeholder:"Occupation","onUpdate:modelValue":l[12]||(l[12]=a=>o(s).occupation=a),required:""},null,512),[[w,o(s).occupation]])]),e("div",Kt,[$(e("input",{type:"text",class:"form-control",placeholder:"Contact no.","onUpdate:modelValue":l[13]||(l[13]=a=>o(s).contact_number=a),pattern:"[0-9]*",inputmode:"numeric"},null,512),[[w,o(s).contact_number]]),o(s).errors.contact_number?(c(),u("div",Jt,p(o(s).errors.contact_number),1)):S("",!0)]),e("div",Xt,[$(e("input",{type:"text",class:"form-control",placeholder:"Address","onUpdate:modelValue":l[14]||(l[14]=a=>o(s).address=a),required:""},null,512),[[w,o(s).address]])])]),e("div",Qt,[l[25]||(l[25]=e("h5",{class:"text-dark fw-light"},"Beneficiary",-1)),b.value.length===0?(c(),u("div",Zt," No beneficiary added ")):(c(),u("div",es,[e("table",ts,[l[24]||(l[24]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Relation"),e("th",null,"Age"),e("th",null,"Birthdate"),e("th",null,"Action")])],-1)),e("tbody",null,[(c(!0),u(W,null,Y(b.value,(a,y)=>(c(),u("tr",{key:y},[e("td",null,p(a.name),1),e("td",null,p(a.relation),1),e("td",null,p(a.age),1),e("td",null,p(L(a.birth_date)),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:A=>v(y)}," Delete ",8,ss)])]))),128))])])]))]),e("div",ls,[n.value?S("",!0):(c(),u("button",{key:0,class:"btn btn-primary w-100 w-md-auto",type:"button",onClick:l[15]||(l[15]=a=>n.value=!0)}," Add Beneficiary ")),l[26]||(l[26]=e("button",{class:"btn btn-success w-100 w-md-auto",type:"submit"},"Save",-1))])],32),n.value?(c(),u("div",os,[l[29]||(l[29]=e("h5",{class:"mb-3"},"Add Beneficiary",-1)),e("form",{onSubmit:F(D,["prevent"]),class:"row g-2"},[e("div",as,[$(e("input",{type:"text",placeholder:"Name",class:"form-control","onUpdate:modelValue":l[16]||(l[16]=a=>g.value.name=a),required:""},null,512),[[w,g.value.name]])]),e("div",ns,[$(e("input",{type:"text",placeholder:"Relation",class:"form-control","onUpdate:modelValue":l[17]||(l[17]=a=>g.value.relation=a),required:""},null,512),[[w,g.value.relation]])]),e("div",ds,[$(e("input",{type:"number",placeholder:"Age",class:"form-control","onUpdate:modelValue":l[18]||(l[18]=a=>g.value.age=a),required:""},null,512),[[w,g.value.age]])]),e("div",is,[l[27]||(l[27]=e("label",{class:"form-label small"},"Birthdate",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":l[19]||(l[19]=a=>g.value.birth_date=a),required:""},null,512),[[w,g.value.birth_date]])]),e("div",rs,[e("button",{type:"button",class:"btn btn-secondary",onClick:l[20]||(l[20]=a=>n.value=!1)}," Cancel "),l[28]||(l[28]=e("button",{type:"submit",class:"btn btn-primary"},"Save Beneficiary",-1))])],32)])):S("",!0)])]))}},cs=j(us,[["__scopeId","data-v-881cc22e"]]),ms={class:"main-section bg-light"},bs={class:"container table-container"},vs={class:"search-box mb-3 position-relative"},ps={key:0,class:"spinner-border text-primary spinner-sm position-absolute end-0 top-50 translate-middle-y me-3",role:"status"},fs={class:"table-responsive"},gs={class:"table table-bordered align-middle text-center"},ys={key:0},_s={key:1},hs={colspan:"9",class:"text-danger text-center"},$s={class:"text-start"},ks={class:"status-cell"},ws={class:"status-toggle"},Ms={class:"toggle-switch"},xs=["checked","onChange"],Cs={class:"status-cell"},Ss={class:"status-toggle"},As={class:"toggle-switch"},Ns=["data-member-id","checked","onClick"],Bs={class:"actions-column"},Vs={class:"action-buttons-large"},Es=["onClick"],Us=["onClick"],Ds={class:"action-buttons-small"},Is=["onClick"],Ts={key:2},Ls={class:"pagination-wrapper mt-3 mb-5"},qs={class:"pagination-controls"},Rs=["onClick","innerHTML"],Fs={class:"list-unstyled m-0"},Os={class:"modal fade",id:"editMember",tabindex:"-1"},Ps={class:"modal-dialog modal-lg"},js={class:"modal-content"},Hs={class:"modal-body"},Ws={class:"custom-modal"},Gs={class:"custom-modal-body"},zs=400,Ys={__name:"RegisteredMember",props:{members:{type:Object,default:()=>({data:[],links:[],prev_page_url:null,next_page_url:null})},deceasedMember:{type:Array,default:()=>[]}},setup(B){const i=B,s=f([]),b=f(!1),g=f({top:"0px",left:"0px"}),n=f(null),k=f(!1),x=f(""),M=f(""),D=f([]),v=f({}),L=f(!1),h=f({}),l=f(!1),a=f(""),y=f(null);f(!1),T(()=>i.members,m=>{s.value=m.data||[]},{immediate:!0}),T(()=>i.deceasedMember,m=>{D.value=m.data||[]},{immediate:!0});let A=null;T(M,m=>{A&&clearTimeout(A),A=setTimeout(()=>I(String(m||"").trim()),zs)});async function I(m){if(!m){s.value=i.members.data,console.log("Search cleared â€” showing default members:",s.value),l.value=!1;return}l.value=!0,a.value="",console.log(`ðŸ” Searching for: "${m}"`);try{const r=await te.get(route("members.search"),{params:{query:m}});console.log(" Raw Axios response:",r),console.log(" Response data:",r.data);let _=[];const N=(r==null?void 0:r.data)||{};if(Array.isArray(N.members))_=N.members;else if(N.members&&Array.isArray(N.members.data))_=N.members.data;else if(N.member&&typeof N.member=="object")_=[N.member];else if(Array.isArray(N.data))_=N.data;else{const E=Object.values(N).find(K=>{var R;return Array.isArray(K)&&((R=K[0])==null?void 0:R.id)});E&&(_=E)}console.log("ðŸ§¾ Normalized members array to display:",_),s.value=_}catch{}finally{l.value=!1}}const C=m=>{confirm("Are you sure you want to trash this member?")&&J.delete(route("deleteMember",{id:m}),{onSuccess:()=>{alert("Member trashed"),b.value=!1}})},t=m=>{const r=m.status==="active"?"inactive":"active";J.put(route("toggleMemberStatus",{id:m.id}),{status:r},{onSuccess:()=>{m.status=r,k.value=r==="active",x.value=`${m.first_name} ${m.middle_name} ${m.last_name}`}})},d=(m,r)=>{if(b.value&&n.value===r){b.value=!1,n.value=null;return}n.value=r,b.value=!0,be(()=>{const _=m.currentTarget.getBoundingClientRect(),N=document.querySelector(".actions-popup");if(!N)return;const E=N.offsetWidth,K=window.innerWidth;let R=_.right+window.scrollX+10;R+E>K&&(R=_.left+window.scrollX-E-10,R<0&&(R=10)),g.value={top:`${_.top+window.scrollY}px`,left:`${R}px`}})},V=m=>{b.value&&m.target&&!m.target.closest(".actions-popup")&&!m.target.closest(".three-dots-button")&&(b.value=!1,n.value=null)};ee(()=>document.addEventListener("click",V)),ue(()=>document.removeEventListener("click",V));const G=m=>{m&&J.visit(m,{preserveState:!0})},ne=m=>{v.value=m||null,L.value=!0,y.value=(m==null?void 0:m.id)||null},se=()=>{if(L.value=!1,y.value){const m=document.querySelector(`input[type="checkbox"][data-member-id="${y.value}"]`);m&&(m.checked=!1),y.value=null}},le=m=>{b.value=!1,h.value={...m}};document.getElementById("memberModalOverlay"),document.getElementById("memberModal"),document.getElementById("createBtn"),document.getElementById("closeBtn");const de=z(()=>{var m;return s.value.length<=5?[{label:"1",url:((m=i.members.links[0])==null?void 0:m.url)||null,active:!0}]:i.members.links});return(m,r)=>(c(),u(W,null,[U(o(ce),{title:"Registered members"}),U(ve,null,{default:O(()=>[e("div",ms,[U(pt),U(gt,{status:k.value,name:x.value},null,8,["status","name"]),e("div",bs,[e("div",vs,[$(e("input",{type:"text",class:"form-control search-input",placeholder:"Search members by name, contact, or purok...","onUpdate:modelValue":r[0]||(r[0]=_=>M.value=_)},null,512),[[w,M.value]]),l.value?(c(),u("div",ps,r[3]||(r[3]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):S("",!0)]),e("div",fs,[e("table",gs,[r[12]||(r[12]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"NAME"),e("th",null,"GENDER"),e("th",null,"AGE"),e("th",null,"CONTACT NO."),e("th",null,"STREET"),e("th",null,"STATUS"),e("th",null,"DECEASED"),e("th",null,"ACTION")])],-1)),e("tbody",null,[l.value?(c(),u("tr",ys,r[4]||(r[4]=[e("td",{colspan:"9",class:"text-center"},[e("div",{class:"spinner-border text-info",role:"status"}),e("p",{class:"mt-2 text-muted"},"Searching...")],-1)]))):S("",!0),a.value&&!l.value?(c(),u("tr",_s,[e("td",hs,p(a.value),1)])):S("",!0),(c(!0),u(W,null,Y(s.value,(_,N)=>(c(),u("tr",{key:N},[e("td",$s,p(_.first_name)+" "+p(_.middle_name)+" "+p(_.last_name),1),e("td",null,p(_.gender||"N/A"),1),e("td",null,p(_.age),1),e("td",null,p(_.contact_number),1),e("td",null,p(_.purok),1),e("td",ks,[e("div",ws,[e("label",Ms,[e("input",{type:"checkbox",checked:_.status==="active",onChange:E=>t(_)},null,40,xs),r[5]||(r[5]=e("span",{class:"toggle-slider"},null,-1))]),e("span",{class:P(["status-label",_.status==="active"?"active":"inactive"])},p(_.status==="active"?"Active":"Inactive"),3)])]),e("td",Cs,[e("div",Ss,[e("label",As,[e("input",{type:"checkbox","data-member-id":_.id,checked:D.value.some(E=>E.member_id===_.id),onClick:E=>ne(_)},null,8,Ns),r[6]||(r[6]=e("span",{class:"toggle-slider"},null,-1))])])]),e("td",Bs,[e("div",Vs,[U(o(Q),{href:m.route("viewMemberInfo",{id:_.id}),class:"me-1"},{default:O(()=>r[7]||(r[7]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["href"]),e("button",{"data-bs-toggle":"modal","data-bs-target":"#editMember",onClick:E=>le(_),class:"me-1"},r[8]||(r[8]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,Es),e("button",{onClick:E=>C(_.id)},r[9]||(r[9]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Us)]),e("div",Ds,[e("button",{class:"btn btn-sm btn-outline-dark three-dots-button",onClick:F(E=>d(E,_.id),["stop"])},r[10]||(r[10]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)]),8,Is)])])]))),128)),!l.value&&s.value.length===0?(c(),u("tr",Ts,r[11]||(r[11]=[e("td",{colspan:"9",class:"text-center text-muted"},"No members found",-1)]))):S("",!0)])])]),e("div",Ls,[e("div",qs,[(c(!0),u(W,null,Y(de.value,(_,N)=>(c(),u("button",{key:N,class:P(["btn pagination-btn",_.active?"btn-primary":"btn-outline-primary"]),onClick:E=>G(_.url),innerHTML:_.label},null,10,Rs))),128))])])])]),b.value?(c(),u("div",{key:0,class:"actions-popup bg-white border rounded shadow-sm p-2",style:me({top:g.value.top,left:g.value.left})},[e("ul",Fs,[e("li",null,[U(o(Q),{href:m.route("viewMemberInfo",{id:n.value}),class:"dropdown-item"},{default:O(()=>r[13]||(r[13]=[e("i",{class:"bi bi-eye me-2"},null,-1),q(" View")])),_:1},8,["href"])]),e("li",null,[e("button",{class:"dropdown-item w-100 text-start","data-bs-toggle":"modal","data-bs-target":"#editMember",onClick:r[1]||(r[1]=_=>le(s.value.find(N=>N.id===n.value)))},r[14]||(r[14]=[e("i",{class:"bi bi-pencil me-2"},null,-1),q(" Edit")]))]),e("li",null,[e("button",{class:"dropdown-item w-100 text-start text-danger",onClick:r[2]||(r[2]=_=>C(n.value))},r[15]||(r[15]=[e("i",{class:"bi bi-trash me-2"},null,-1),q(" Delete")]))])])],4)):S("",!0),e("div",Os,[e("div",Ps,[e("div",js,[r[16]||(r[16]=e("div",{class:"modal-header"},[e("h5",null,"Edit Member Info"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Hs,[U(cs,{member:h.value},null,8,["member"])])])])]),L.value?(c(),u("div",{key:1,class:"custom-modal-overlay",onClick:F(se,["self"])},[e("div",Ws,[e("div",{class:"custom-modal-header"},[r[17]||(r[17]=e("h3",null,"Add Deceased Info",-1)),e("span",{class:"close-icon",onClick:se},"Ã—")]),e("div",Gs,[U(Bt,{deceasedMember:v.value},null,8,["deceasedMember"])])])])):S("",!0)]),_:1})],64))}},Zs=j(Ys,[["__scopeId","data-v-3d21cafc"]]);export{Zs as default};
