import{r as i,s as p,j as K,x as Q,f as l,o as a,a as g,u as r,g as q,w as H,b as s,h as A,i as F,D as J,F as S,G as D,t as n,n as j,e as E,M as X,I as Y,d as Z,W as U,z as ee}from"./app-C_rMQMGW.js";import{_ as te}from"./not_found-DvAnRRcV.js";import{C as se}from"./CollectorLayout-_je7zD1F.js";import{P as oe,V as le}from"./ViewAsCollector-DzK6zTDN.js";import{_ as ae}from"./ToggleContribution-DIHE8L8p.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";import"./html2pdf-DQnMBPah.js";const ie={class:"container main-container"},re={class:"bg-light p-2 pt-0"},de={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},ue={class:"mt-3 mb-3 search-container"},ce={key:0,class:"mt-5"},be={key:1,class:"table-wrapper mt-3 desktop-view"},ve={class:"table-responsive"},pe={class:"table table-bordered table-hover align-middle text-center mb-0"},_e={class:"text-start"},fe=["onClick"],ke={key:0},ye={key:1},Ce={key:2,class:"mobile-view"},he={class:"mobile-cards-container"},ge={class:"mobile-card-header"},Me={class:"mobile-member-id"},we={class:"mobile-purok"},xe={class:"mobile-card-body"},Pe={class:"mobile-field"},Se={class:"mobile-value"},Ne={class:"mobile-field"},Ae={class:"mobile-value"},De={class:"mobile-actions"},me=["onClick"],Ie=["onClick"],Te={key:3,class:"container mt-4 text-center"},Le={class:"fw-light"},Ve={class:"text-success"},Oe={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Re={class:"modal-dialog"},Fe={class:"modal-content"},je={class:"modal-body"},Ee=["value"],Ue={class:"modal-footer"},ze=["disabled"],Be={class:"custom-modal"},$e={__name:"MemberContribution2",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(z){const b=z;let d=i([]),k=i(""),m=i([]),v=i([]),y=i(null),I=i(""),u=i(""),M=i({});const T=i([]),c=i({});p(()=>b.member,o=>d.value=o,{immediate:!0}),p(()=>b.selectedPurok,o=>k.value=o,{immediate:!0}),p(()=>b.collectors,o=>m.value=o,{immediate:!0}),p(()=>b.paidMembersId,o=>{v.value=Array.isArray(o)?o:[]},{immediate:!0}),p(()=>b.currentCollector,o=>M.value=o,{immediate:!0}),p(()=>b.currentDeceasedMembers,o=>T.value=o?Object.values(o):[],{immediate:!0}),p(()=>b.currentDeceasedMember,o=>c.value=o,{immediate:!0});const w=i(""),x=K(()=>{if(!w.value.trim())return d.value;const o=w.value.toLowerCase();return d.value.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(o)||t.last_name&&t.last_name.toLowerCase().includes(o)||t.middle_name&&t.middle_name.toLowerCase().includes(o)||t.contact_number&&t.contact_number.toLowerCase().includes(o)||t.purok&&t.purok.toLowerCase().includes(o))}),P=Q({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),B=o=>(o==null?void 0:o.toLowerCase().replace(/\s+/g,""))||"",L=(o,t,_)=>{var e,f;if(!o||!t){console.warn("Missing member data for preparePayment()");return}y.value=o,I.value=t,u.value="",U.post(route("smsNotification.sendScheduleContribution"),{id:o,message:"Successfully paid.",contact_number:_,collector:((e=M.value)==null?void 0:e.name)||"",purok:t,deceasedId:((f=c.value)==null?void 0:f.member_id)??null},{onSuccess:()=>{alert("Schedule Contribution sent successfully!")},onError:()=>{alert("Error sending Schedule Contribution")}})},$=()=>{P.member_id=y.value,P.purok=B(I.value),P.collector=u.value,P.post(route("contributions.store"),{onSuccess:()=>{const o=d.value.findIndex(t=>t.id===y.value);o!==-1&&(d.value[o]={...d.value[o],paid:!0}),ee(()=>{const t=Number(y.value);v.value.includes(t)||v.value.push(t)}),y.value=null,u.value=""}})},V=o=>{if(!o){console.warn("No memberId passed in unPaidFunc()");return}U.delete(route("collectorContribution.deleteContribution",o),{onSuccess:()=>{const t=d.value.findIndex(e=>e.id===o);t!==-1&&(d.value[t]={...d.value[t],paid:!1});const _=Number(o);v.value=v.value.filter(e=>e!==_)},onError:()=>{alert("Failed to unmark payment. Try again.")}})},N=i(!1),W=()=>N.value=!0,O=()=>N.value=!1,C=o=>Array.isArray(v.value)?v.value.some(t=>t==o):!1,G=o=>{C(o.id)?V(o.id):L(o.id,o.purok,o.contact_number)};return(o,t)=>(a(),l(S,null,[g(r(q),{title:"Member contribution"}),g(se,null,{default:H(()=>{var _;return[s("div",ie,[s("div",re,[s("div",de,[t[3]||(t[3]=s("div",{class:"page-title"},[s("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),s("div",ue,[F(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[J,w.value]])])]),g(oe,{activePurok:r(k),deceasedId:(_=c.value)==null?void 0:_.member_id},null,8,["activePurok","deceasedId"]),c.value?(a(),l("div",ce,[g(ae,{allDeceased:T.value,purok:r(k),data:c.value,deceased:c.value,"onUpdate:deceased":t[1]||(t[1]=e=>c.value=e)},null,8,["allDeceased","purok","data","deceased"])])):A("",!0),s("div",{class:"action-buttons"},[s("button",{class:"btn btn-dark view-report",onClick:W},"View Reports")]),x.value.length>0?(a(),l("div",be,[s("div",ve,[s("table",pe,[t[4]||(t[4]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"NAME"),s("th",null,"CONTACT NO."),s("th",null,"PUROK"),s("th",null,"STATUS")])],-1)),s("tbody",null,[(a(!0),l(S,null,D(x.value,(e,f)=>{var h;return a(),l("tr",{key:f},[s("td",_e,n(e==null?void 0:e.first_name)+" "+n(e==null?void 0:e.middle_name)+" "+n(e==null?void 0:e.last_name),1),s("td",null,n((e==null?void 0:e.contact_number)||"undefined"),1),s("td",null,n((e==null?void 0:e.purok)||"N/A"),1),s("td",null,[s("button",{class:j(["status-btn",{"status-paid":C(e.id),"status-unpaid":!C(e.id),disabled:e.purok.slice(-1)!==((h=r(M))==null?void 0:h.purok)}]),onClick:R=>G(e)},[C(e.id)?(a(),l("span",ke,"✔")):(a(),l("span",ye,"Paid"))],10,fe)])])}),128))])])])])):A("",!0),x.value.length>0?(a(),l("div",Ce,[s("div",he,[(a(!0),l(S,null,D(x.value,(e,f)=>{var h;return a(),l("div",{class:"mobile-card",key:f},[s("div",ge,[s("div",Me,"ID: "+n(e==null?void 0:e.id),1),s("div",we,n((e==null?void 0:e.purok)||"N/A"),1)]),s("div",xe,[s("div",Pe,[t[5]||(t[5]=s("label",null,"Name:",-1)),s("span",Se,n(e==null?void 0:e.first_name)+" "+n(e==null?void 0:e.middle_name)+" "+n(e==null?void 0:e.last_name),1)]),s("div",Ne,[t[6]||(t[6]=s("label",null,"Contact:",-1)),s("span",Ae,n((e==null?void 0:e.contact_number)||"undefined"),1)]),s("div",De,[C(e.id)?(a(),l("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:R=>V(e.id),title:"Mark member as unpaid"},t[7]||(t[7]=[s("i",{class:"bi bi-check-lg"},null,-1)]),8,Ie)):(a(),l("button",{key:0,class:j(["btn btn-danger btn-sm mobile-pay-btn",{disabled:e.purok.slice(-1)!==((h=r(M))==null?void 0:h.purok)}]),onClick:R=>L(e.id,e.purok,e.contact_number),title:"Mark member as paid"}," Paid ",10,me))])])])}),128))])])):(a(),l("div",Te,[t[10]||(t[10]=s("img",{src:te,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),s("h5",Le,[t[8]||(t[8]=E(" No contribution found for ")),s("span",Ve,n(r(k)||"N/A"),1),t[9]||(t[9]=E(". "))])]))])]),t[14]||(t[14]=s("div",{class:"container extra-space bg-dark"},null,-1)),s("div",Oe,[s("div",Re,[s("div",Fe,[t[13]||(t[13]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Select Collector"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s("div",je,[F(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>X(u)?u.value=e:u=e),class:"form-select"},[t[11]||(t[11]=s("option",{value:"",disabled:""},"Select collector",-1)),(a(!0),l(S,null,D(r(m),e=>(a(),l("option",{key:e.id,value:e.name},n(e.name),9,Ee))),128))],512),[[Y,r(u)]])]),s("div",Ue,[t[12]||(t[12]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:!r(u),"data-bs-dismiss":"modal"}," Done ",8,ze)])])])]),N.value?(a(),l("div",{key:0,class:"custom-modal-overlay",onClick:Z(O,["self"])},[s("div",Be,[s("button",{class:"close-btn",onClick:O},"×"),g(le,{deceased:c.value,purok:r(k)},null,8,["deceased","purok"])])])):A("",!0)]}),_:1})],64))}},Ye=ne($e,[["__scopeId","data-v-28abb6dd"]]);export{Ye as default};
