import{r as _,s as M,f as n,o as a,b as e,n as I,u as i,F as N,G as L,t as u,W as E,x as B,l as H,h as P,d as R,i as S,I as U,D as V,E as O,e as j,J as W,a as $,j as Y,g as z,w as G}from"./app-NvJDYXzK.js";import{_ as J}from"./not_found-DvAnRRcV.js";import{A as K}from"./AdminLayout-DHR4syta.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./ToggleContribution-Cj9qQHN8.js";import"./logo1-BZ0h4foK.js";const q={class:"d-flex align-items-center gap-2 text-muted small"},X=["onClick"],Z={__name:"Purok",props:{activePurok:{type:String,default:()=>""},currentDeceasedId:{type:[String,Number],default:null}},setup(C){const d=C;let c=_("");M(()=>d.activePurok,p=>{c.value=p},{immediate:!0});const v=["Purok 1","Purok 2","Purok 3","Purok 4"],g=p=>{const y=p.toLowerCase().replace(/\s+/g,"");E.get(route("contributions.togglePurok",{purok:y,deceasedId:d.currentDeceasedId||0}),{onSuccess:()=>console.log("changing purok"),onError:k=>console.log("An error occured: ",k)})},h=p=>p.toLowerCase().replace(/\s+/g,"");return(p,y)=>(a(),n("div",null,[e("div",q,[e("span",{class:I(["purok all-members-text",{"fw-bold active":i(c)=="all"}]),onClick:y[0]||(y[0]=k=>g("all"))},"ALL MEMBERS",2),e("div",null,[(a(),n(N,null,L(v,k=>e("span",{key:k,class:I(["mx-2 purok",{"fw-bold active":h(k)===i(c)}]),onClick:r=>g(k)},u(k),11,X)),64))])])]))}},ee=T(Z,[["__scopeId","data-v-9a43fba9"]]),te={class:"contri-container py-1"},se={class:"row justify-content-center"},oe={class:"col-md-8"},le={class:"card rounded-4 shadow-none border-0"},ne={class:"card-body p-4"},ae={key:0,class:"alert alert-success text-center fw-semibold",role:"alert"},re={class:"mb-3"},ie=["value"],de={key:0,class:"invalid-feedback"},ue={class:"mb-3"},ce={key:0,class:"invalid-feedback"},pe={class:"mb-3"},be={key:0,class:"mb-3"},_e={key:1,class:"text-danger"},ve={class:"mb-3"},fe=["value"],ge={class:"d-flex justify-content-end"},ke=["disabled"],ye={key:0,class:"spinner-border spinner-border-sm"},me={__name:"AddContribution",setup(C){const d=_([]),c=_([]),v=_([]),g=_([]),h=_([]),p=_(!1),y=_(""),r=B({member_id:"",amount:100,payment_date:(()=>{const o=new Date,t=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0"),m=String(o.getHours()).padStart(2,"0"),f=String(o.getMinutes()).padStart(2,"0");return`${t}-${l}-${s}T${m}:${f}`})(),collector:"",status:"paid",purok:"",deceased_id:""});H(async()=>{try{const o=await W.get(route("contributions.members.data")),{members:t,users:l,deceasedMembers:s}=o.data;d.value=t||[],g.value=l||[],h.value=s||[];const m=(t||[]).map(b=>({id:b.id,fullName:`${b.first_name} ${b.middle_name??""} ${b.last_name}`.replace(/\s+/g," ").trim()})),f=(l||[]).map(b=>({id:b.id,fullName:b.name}));c.value=[...m,...f],v.value=(l||[]).filter(b=>b.role==="collector"),console.log("Collectorss:",v.value)}catch(o){console.error(o)}}),M(()=>r.purok,o=>{if(!o)return;const t=parseInt(o.replace("purok",""),10),l=v.value.find(s=>Number(s.purok)===t);r.collector=l?l.name:""});const x=()=>{r.post(route("contributions.store"),{preserveScroll:!0,onSuccess:()=>{y.value="Contribution successfully created!",p.value=!0,setTimeout(()=>p.value=!1,3e3),r.reset()}})};return(o,t)=>(a(),n("div",null,[e("div",te,[e("div",se,[e("div",oe,[e("div",le,[t[13]||(t[13]=e("div",{class:"card-header text-center"},[e("h4",{class:"mb-0"},"Create Contribution")],-1)),e("div",ne,[p.value?(a(),n("div",ae,u(y.value),1)):P("",!0),e("form",{onSubmit:R(x,["prevent"])},[e("div",re,[t[6]||(t[6]=e("label",{class:"form-label"},"Member Name",-1)),S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>i(r).member_id=l),class:I(["form-select",{"is-invalid":i(r).errors.member_id}])},[t[5]||(t[5]=e("option",{disabled:"",value:""},"-- Select Member --",-1)),(a(!0),n(N,null,L(c.value,l=>(a(),n("option",{key:l.id,value:l.id},u(l.fullName),9,ie))),128))],2),[[U,i(r).member_id]]),i(r).errors.member_id?(a(),n("div",de,u(i(r).errors.member_id),1)):P("",!0)]),e("div",ue,[t[7]||(t[7]=e("label",{class:"form-label"},"Payment Date",-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>i(r).payment_date=l),type:"datetime-local",class:I(["form-control",{"is-invalid":i(r).errors.payment_date}])},null,2),[[V,i(r).payment_date]]),i(r).errors.payment_date?(a(),n("div",ce,u(i(r).errors.payment_date),1)):P("",!0)]),e("div",pe,[t[9]||(t[9]=e("label",{class:"form-label"},"Purok",-1)),S(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>i(r).purok=l),class:"form-control"},t[8]||(t[8]=[O('<option disabled value="">-- Select Purok --</option><option value="purok1">Purok 1</option><option value="purok2">Purok 2</option><option value="purok3">Purok 3</option><option value="purok4">Purok 4</option>',5)]),512),[[U,i(r).purok]])]),i(r).collector?(a(),n("div",be,[t[10]||(t[10]=e("label",{class:"form-label"},"Collector",-1)),S(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=l=>i(r).collector=l),readonly:""},null,512),[[V,i(r).collector]])])):(a(),n("div",_e,"No Collector for that purok.")),e("div",ve,[t[12]||(t[12]=e("label",{class:"form-label"},"Select Deceased Member",-1)),S(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>i(r).deceased_id=l),class:"form-control"},[t[11]||(t[11]=e("option",{disabled:"",value:""},"-- Select Deceased Member --",-1)),(a(!0),n(N,null,L(h.value,l=>(a(),n("option",{key:l.id,value:l.member_id},u(l.deceased_name),9,fe))),128))],512),[[U,i(r).deceased_id]])]),e("div",ge,[e("button",{type:"submit",class:"btn btn-success px-4 rounded-pill d-flex align-items-center gap-2",disabled:i(r).processing||!i(r).collector},[i(r).processing?(a(),n("span",ye)):P("",!0),j(" "+u(i(r).processing?"Submitting...":"Submit"),1)],8,ke)])],32)])])])])])]))}},he={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},xe={class:"modal-dialog",style:{"min-width":"60%"}},$e={class:"modal-content"},Ce={class:"modal-body"},Me={__name:"Header",setup(C){return(d,c)=>(a(),n("div",null,[c[1]||(c[1]=O('<div class="container-fluid d-flex flex-row justify-content-between align-items-center px-0 mb-2" data-v-31f09250><div data-v-31f09250><h6 class="mt-4 payment-contribution-text fs-5" style="transform:translateY(-20%);" data-v-31f09250><span class="d-none d-sm-none d-lg-inline" data-v-31f09250>Payment</span> Contribution</h6></div><div data-v-31f09250><button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" data-v-31f09250><span class="d-none d-sm-none d-lg-inline" data-v-31f09250>Add contribution</span><i class="bi bi-plus d-inline d-sm-inline d-lg-none" data-v-31f09250></i></button></div></div>',1)),e("div",he,[e("div",xe,[e("div",$e,[c[0]||(c[0]=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Add contribution"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ce,[$(me)])])])])]))}},Se=T(Me,[["__scopeId","data-v-31f09250"]]),F={__name:"Collector",props:{collectors:{type:Array,default:()=>[]},purok:{type:String,default:""}},setup(C){var v;const d=C,c=_("");return d.collectors.length!=0&&d.purok!=""?c.value=((v=d.collectors.find(g=>g.purok===d.purok.slice(-1)))==null?void 0:v.name)||"N/A":c.value="N/A",(g,h)=>(a(),n("div",null,[e("p",null,u(c.value),1)]))}},Pe={class:"main-container"},Ne={class:"container-fluid d-flex justify-content-end"},we={class:"search-container w-50"},Ae={class:"bg-light p-2"},De={class:""},Le={key:0,class:"mt-3"},Ie={key:1,class:"table-responsive mt-3 desktop-view"},Ue={class:"table table-bordered table-hover align-middle text-center"},Ve={class:"scrollable-tbody"},je={class:"text-start"},Te={key:0},Fe={key:1,class:"text-muted"},Ee={key:0,class:"badge bg-success"},Oe={key:1,class:"text-muted"},Be={class:"pagination-controls d-flex align-items-center justify-content-end gap-2 mt-3"},He=["disabled"],Re=["disabled"],We={key:2,class:"mobile-view"},Ye={class:"mobile-cards-container"},ze={class:"mobile-card-header"},Ge={class:"mobile-member-id"},Je={class:"mobile-status"},Ke={key:0,class:"badge bg-success"},Qe={key:1,class:"text-muted"},qe={class:"mobile-card-body"},Xe={class:"mobile-field"},Ze={class:"mobile-value"},et={class:"mobile-field-group"},tt={class:"mobile-field"},st={class:"mobile-value"},ot={class:"mobile-field"},lt={class:"mobile-value"},nt={class:"mobile-field"},at={key:0,class:"mobile-value"},rt={key:1,class:"text-muted"},it={class:"mobile-field"},dt={class:"mobile-value"},ut={class:"mobile-pagination d-flex align-items-center justify-content-between mt-3"},ct=["disabled"],pt=["disabled"],bt={key:3,class:"container mt-4 text-center"},_t={class:"fw-light"},vt={class:"text-success"},ft={__name:"MemberContribution",props:{member:{type:Object,default:()=>({data:[],links:{},meta:{}})},selectedPurok:{type:String,default:()=>""},collectors:{type:Array,default:()=>[]},currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(C){const d=C;let c=_([]),v=_(""),g=_([]);const h=_([]),p=_({});M(()=>d.member,o=>{c.value=(o==null?void 0:o.data)||[]},{immediate:!0}),M(()=>d.selectedPurok,o=>{v.value=o},{immediate:!0}),M(()=>d.collectors,o=>{g.value=o},{immediate:!0}),M(()=>d.currentDeceasedMembers,o=>{h.value=o?Object.values(o):[]},{immediate:!0}),M(()=>d.currentDeceasedMember,o=>{p.value=o},{immediate:!0});const y=o=>{const t={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString(void 0,t)};function k(o){return o==null?"N/A":parseFloat(o)}function r(o){o&&E.get(o,{},{preserveScroll:!0,preserveState:!0})}const w=_(""),x=Y(()=>{if(!w.value.trim())return c.value;const o=w.value.toLowerCase();return c.value.filter(t=>{var l,s,m,f;return t.first_name&&t.first_name.toLowerCase().includes(o)||t.last_name&&t.last_name.toLowerCase().includes(o)||t.middle_name&&t.middle_name.toLowerCase().includes(o)||t.purok&&t.purok.toLowerCase().includes(o)||((s=(l=t.contributions)==null?void 0:l[0])==null?void 0:s.collector)&&t.contributions[0].collector.toLowerCase().includes(o)||((f=(m=t.contributions)==null?void 0:m[0])==null?void 0:f.status)&&t.contributions[0].status.toLowerCase().includes(o)})});return(o,t)=>(a(),n(N,null,[$(i(z),{title:"Member contribution"}),e("div",null,[$(K,null,{default:G(()=>{var l;return[e("div",Pe,[e("div",Ne,[e("div",we,[S(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s),type:"text",class:"form-control",placeholder:"Search by name, purok, collector, or status..."},null,512),[[V,w.value]])])]),e("div",Ae,[e("div",De,[$(Se)]),$(ee,{activePurok:i(v),currentDeceasedId:(l=p.value)==null?void 0:l.member_id},null,8,["activePurok","currentDeceasedId"]),p.value?(a(),n("div",Le,[$(Q,{allDeceased:h.value,data:p.value,purok:i(v)},null,8,["allDeceased","data","purok"])])):P("",!0),Array.isArray(x.value)&&x.value.length>0?(a(),n("div",Ie,[e("table",Ue,[t[5]||(t[5]=e("thead",{class:""},[e("tr",null,[e("th",null,"NAME"),e("th",null,"AMOUNT"),e("th",null,"DATE"),e("th",null,"COLLECTOR"),e("th",null,"PUROK"),e("th",null,"STATUS")])],-1)),e("tbody",Ve,[(a(!0),n(N,null,L(x.value,(s,m)=>{var f,b,A,D;return a(),n("tr",{key:m},[e("td",je,u(s==null?void 0:s.first_name)+" "+u(s==null?void 0:s.middle_name)+" "+u(s==null?void 0:s.last_name),1),e("td",null,u(k((f=s==null?void 0:s.contributions[0])==null?void 0:f.amount)),1),e("td",null,[(b=s==null?void 0:s.contributions[0])!=null&&b.payment_date?(a(),n("span",Te,u(y((A=s==null?void 0:s.contributions[0])==null?void 0:A.payment_date)),1)):(a(),n("span",Fe,"..."))]),e("td",null,[$(F,{collectors:i(g),purok:s.purok},null,8,["collectors","purok"])]),e("td",null,u((s==null?void 0:s.purok)||"N/A"),1),e("td",null,[((D=s==null?void 0:s.contributions[0])==null?void 0:D.status)==="paid"?(a(),n("span",Ee,"Paid")):(a(),n("span",Oe,"Unpaid"))])])}),128))])]),e("div",Be,[e("button",{class:"btn btn-outline-primary",disabled:!d.member.prev_page_url,onClick:t[1]||(t[1]=s=>r(d.member.prev_page_url))}," Previous ",8,He),e("button",{class:"btn btn-outline-primary",disabled:!d.member.next_page_url,onClick:t[2]||(t[2]=s=>r(d.member.next_page_url))}," Next ",8,Re)])])):P("",!0),Array.isArray(x.value)&&x.value.length>0?(a(),n("div",We,[e("div",Ye,[(a(!0),n(N,null,L(x.value,(s,m)=>{var f,b,A,D;return a(),n("div",{class:"mobile-card",key:m},[e("div",ze,[e("div",Ge,"ID: "+u(s==null?void 0:s.id),1),e("div",Je,[((f=s==null?void 0:s.contributions[0])==null?void 0:f.status)==="paid"?(a(),n("span",Ke,"Paid")):(a(),n("span",Qe,"Unpaid"))])]),e("div",qe,[e("div",Xe,[t[6]||(t[6]=e("label",null,"Name:",-1)),e("span",Ze,u(s==null?void 0:s.first_name)+" "+u(s==null?void 0:s.middle_name)+" "+u(s==null?void 0:s.last_name),1)]),e("div",et,[e("div",tt,[t[7]||(t[7]=e("label",null,"Amount:",-1)),e("span",st,u(k((b=s==null?void 0:s.contributions[0])==null?void 0:b.amount)),1)]),e("div",ot,[t[8]||(t[8]=e("label",null,"Purok:",-1)),e("span",lt,u((s==null?void 0:s.purok)||"N/A"),1)])]),e("div",nt,[t[9]||(t[9]=e("label",null,"Date:",-1)),(A=s==null?void 0:s.contributions[0])!=null&&A.payment_date?(a(),n("span",at,u(y((D=s==null?void 0:s.contributions[0])==null?void 0:D.payment_date)),1)):(a(),n("span",rt,"..."))]),e("div",it,[t[10]||(t[10]=e("label",null,"Collector:",-1)),e("span",dt,[$(F,{collectors:i(g),purok:s.purok},null,8,["collectors","purok"])])])])])}),128))]),e("div",ut,[e("button",{class:"btn btn-outline-primary btn-sm",disabled:!d.member.prev_page_url,onClick:t[3]||(t[3]=s=>r(d.member.prev_page_url))}," ← Previous ",8,ct),e("button",{class:"btn btn-outline-primary btn-sm",disabled:!d.member.next_page_url,onClick:t[4]||(t[4]=s=>r(d.member.next_page_url))}," Next → ",8,pt)])])):(a(),n("div",bt,[t[13]||(t[13]=e("img",{src:J,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),e("h5",_t,[t[11]||(t[11]=j(" No contribution found in ")),e("span",vt,u(i(v)||"N/A"),1),t[12]||(t[12]=j(". "))])])),t[14]||(t[14]=e("div",{class:"container space-at-bottom"},null,-1))])])]}),_:1})])],64))}},$t=T(ft,[["__scopeId","data-v-eb874c33"]]);export{$t as default};
