import{r as c,s as C,f as i,o as r,b as e,F as x,G as L,n as R,u as p,t as n,W as B,l as q,j as W,e as S,J as G,x as H,a as T,g as J,w as K,h as V,i as Y,D as Q,N as X,I as Z,d as ee,z as te}from"./app-BcApPCIf.js";import{_ as oe}from"./not_found-DvAnRRcV.js";import{C as se}from"./CollectorLayout-SYCKRXy8.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as le}from"./ToggleContribution-C6UgYvaF.js";import{h as ne}from"./html2pdf-DfG1oiqs.js";import"./logo1-BZ0h4foK.js";const ae={class:"d-flex flex-row justify-content-between align-items-center px-0"},ie=["onClick"],re={__name:"PurokComponentForCollector",props:{activePurok:{type:String,default:()=>""},deceasedId:{type:Number,default:()=>0}},setup(N){const d=N;let a=c("");C(()=>d.activePurok,v=>{a.value=v},{immediate:!0});const k=["Purok 1","Purok 2","Purok 3","Purok 4"],y=v=>v.toLowerCase().replace(/\s+/g,""),_=v=>{console.log("deceasedId:",d.deceasedId);const h=y(v);B.get(route("collectorContribution.togglePurok",{purok:h,deceasedId:d.deceasedId}),{onSuccess:()=>console.log("Changing purok"),onError:b=>console.log("An error occurred:",b)})};return(v,h)=>(r(),i("div",ae,[e("div",null,[(r(),i(x,null,L(k,b=>e("span",{key:b,class:R(["mx-2 purok",{"fw-bold active":y(b)===p(a)}]),onClick:M=>_(b)},n(b),11,ie)),64))]),e("div",{class:R(["mx-2 purok",{"fw-bold active":p(a)==="all"}]),onClick:h[0]||(h[0]=b=>_("all"))}," All members ",2)]))}},de=U(re,[["__scopeId","data-v-2bdb649d"]]),ue={class:"header"},ce={class:"deceased-name"},be={class:"fw-light"},ve={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},pe={class:"fw-bold"},_e={class:"fw-bold"},fe={class:"table-container"},ke={class:"members-table"},ge={class:"total-amount"},Ce={__name:"ViewAsCollector",props:{deceased:{type:Object,default:()=>({})},purok:String},setup(N){const d=N,a=c([]),k=c(null),y=c({}),_=c(""),v=c(!1),h=async(u,s)=>{if(!(!u||!s))try{console.log("id: ",u),console.log("purok: ",s),v.value=!0;const f=await G.get(`/collector/contributions/${u}/${s}`);a.value=f.data.contributions||[],console.log(" Contributions fetched:",a.value)}catch(f){console.error(" Error fetching contributions:",f)}finally{v.value=!1}};C([()=>d.purok],([u])=>{_.value=u},{immediate:!1}),C(()=>d.deceased,u=>{y.value=u,console.log("deceased: ",y.value)},{immediate:!0}),q(()=>{var u;(u=d.deceased)!=null&&u.member_id&&d.purok&&h(d.deceased.member_id,d.purok)});const b=W(()=>a.value.reduce((u,s)=>u+parseFloat(s.amount||0),0)),M=()=>{const u=k.value,s={filename:"Contributions_Report.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};ne().from(u).set(s).save()};return(u,s)=>{var f,m,P,E,D;return r(),i(x,null,[e("button",{onClick:M,class:"download-btn btn btn-dark px-3 ms-2",title:"Download PDF"},s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:`M12 3a1 1 0 011 1v9.586l3.293-3.293a1 1 0 011.414 1.414l-5 
        5a1 1 0 01-1.414 0l-5-5a1 1 0 
        011.414-1.414L11 13.586V4a1 1 0 011-1zm-7 
        14a1 1 0 100 2h14a1 1 0 100-2H5z`})],-1)])),e("div",{ref_key:"pdfContent",ref:k,class:"document-container"},[e("div",ue,[s[3]||(s[3]=e("div",{class:"organization-name"},"BULAN P.R.O.T.E.C DAMAYAN FEDERATION",-1)),s[4]||(s[4]=e("div",{class:"organization-subtitle"},"(People's Responsible Organization Transforming Community)",-1)),s[5]||(s[5]=e("div",{class:"chapter-info fst-italic"},"Affiliated Bulan, Sorsogon Chapter Brgy. ______ C.Y 2021",-1)),s[6]||(s[6]=e("div",{class:"established fst-italic"},"Since 2016",-1)),e("div",ce,[s[1]||(s[1]=S(" Deceased Name: ")),s[2]||(s[2]=e("br",null,null,-1)),e("p",be,n(((f=y.value)==null?void 0:f.deceased_name)||""),1)])]),e("div",ve,[e("div",null,[s[7]||(s[7]=S(" Collector Name: ")),e("span",pe,n(((m=a.value[0])==null?void 0:m.collector)||""),1)]),e("div",null,[s[8]||(s[8]=S(" Purok: ")),e("span",_e,n(((D=a.value[0])==null?void 0:D.purok.charAt(((E=(P=a.value[0])==null?void 0:P.purok)==null?void 0:E.length)-1))||""),1)])]),e("div",fe,[s[10]||(s[10]=e("div",{class:"mb-3"},[e("strong",null,"MEMBERS")],-1)),e("table",ke,[s[9]||(s[9]=e("thead",null,[e("tr",null,[e("th",null,"No."),e("th",null,"NAME"),e("th",null,"STATUS"),e("th",null,"AMOUNT")])],-1)),e("tbody",null,[(r(!0),i(x,null,L(a.value,(g,I)=>{var A,O;return r(),i("tr",{key:I},[e("td",null,n(I+1),1),e("td",null,n(((A=g==null?void 0:g.member_contribution)==null?void 0:A.first_name)||"Member")+" "+n(((O=g==null?void 0:g.member_contribution)==null?void 0:O.last_name)||""),1),e("td",null,n(g.status),1),e("td",null,"₱"+n(Math.floor(g.amount).toLocaleString()),1)])}),128))])]),e("div",ge," TOTAL AMOUNT: ₱"+n(b.value.toLocaleString()),1)]),s[11]||(s[11]=e("div",{class:"signature"},[e("div",null,"Noted By:"),e("div",{class:"president-name"},"Melva Canale Delariarte"),e("div",null,"DAMAYAN PRESIDENT")],-1))],512)],64)}}},ye=U(Ce,[["__scopeId","data-v-7322785c"]]),he={class:"container main-container"},we={class:"bg-light p-2 pt-0"},Me={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},me={class:"mt-3 mb-3 search-container"},Pe={key:0,class:"mt-5"},xe={key:1,class:"table-wrapper mt-3 desktop-view"},Ae={class:"table-responsive"},Se={class:"table table-bordered table-hover align-middle text-center mb-0"},Ne={class:"text-start"},De=["onClick"],Ie=["onClick"],$e={key:2,class:"mobile-view"},Te={class:"mobile-cards-container"},Le={class:"mobile-card-header"},Ee={class:"mobile-member-id"},Oe={class:"mobile-purok"},Re={class:"mobile-card-body"},je={class:"mobile-field"},Fe={class:"mobile-value"},Ve={class:"mobile-field"},Be={class:"mobile-value"},Ue={class:"mobile-actions"},ze=["onClick"],Ye=["onClick"],We={key:3,class:"container mt-4 text-center"},qe={class:"fw-light"},Ge={class:"text-success"},He={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Je={class:"modal-dialog"},Ke={class:"modal-content"},Qe={class:"modal-body"},Xe=["value"],Ze={class:"modal-footer"},et=["disabled"],tt={class:"custom-modal"},ot={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(N){const d=N;let a=c([]),k=c(""),y=c([]),_=c([]),v=c(null),h=c(""),b=c(""),M=c({});const u=c([]),s=c({});C(()=>d.member,l=>a.value=l,{immediate:!0}),C(()=>d.selectedPurok,l=>k.value=l,{immediate:!0}),C(()=>d.collectors,l=>y.value=l,{immediate:!0}),C(()=>d.paidMembersId,l=>_.value=l,{immediate:!0}),C(()=>d.currentCollector,l=>M.value=l,{immediate:!0}),C(()=>d.currentDeceasedMembers,l=>u.value=l?Object.values(l):[],{immediate:!0}),C(()=>d.currentDeceasedMember,l=>s.value=l,{immediate:!0});const f=c(""),m=W(()=>{if(!f.value.trim())return a.value;const l=f.value.toLowerCase();return a.value.filter(o=>o.first_name&&o.first_name.toLowerCase().includes(l)||o.last_name&&o.last_name.toLowerCase().includes(l)||o.middle_name&&o.middle_name.toLowerCase().includes(l)||o.contact_number&&o.contact_number.toLowerCase().includes(l)||o.purok&&o.purok.toLowerCase().includes(l))}),P=H({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),E=l=>(l==null?void 0:l.toLowerCase().replace(/\s+/g,""))||"",D=(l,o,w)=>{v.value=l,h.value=o,b.value="",B.post(route("smsNotification.sendScheduleContribution"),{id:l,message:"Successfully paid.",contact_number:w,collector:M.value.name,purok:o,deceasedId:s.value.member_id||null},{onSuccess:()=>alert("Schedule Contribution sent successfully!"),onError:()=>alert("Error sending Schedule Contribution")})},g=()=>{P.member_id=v.value,P.purok=E(h.value),P.collector=b.value,P.post(route("contributions.store"),{onSuccess:()=>{const l=a.value.findIndex(o=>o.id===v.value);l!==-1&&(a.value[l]={...a.value[l],paid:!0}),te(()=>{_.value.includes(v.value)||_.value.push(v.value)})}})},I=l=>{const o=a.value.findIndex(w=>w.id===l);o!==-1&&(a.value[o]={...a.value[o],paid:!1}),B.delete(route("collectorContribution.deleteContribution",l),{onSuccess:()=>{_.value=_.value.filter(w=>w!==l)}})},A=c(!1),O=()=>A.value=!0,z=()=>A.value=!1;return(l,o)=>(r(),i(x,null,[T(p(J),{title:"Member contribution"}),T(se,null,{default:K(()=>{var w;return[e("div",he,[e("div",we,[e("div",Me,[o[3]||(o[3]=e("div",{class:"page-title"},[e("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),e("div",me,[Y(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[Q,f.value]])])]),T(de,{activePurok:p(k),deceasedId:(w=s.value)==null?void 0:w.member_id},null,8,["activePurok","deceasedId"]),s.value?(r(),i("div",Pe,[T(le,{allDeceased:u.value,purok:p(k),data:s.value,deceased:s.value,"onUpdate:deceased":o[1]||(o[1]=t=>s.value=t)},null,8,["allDeceased","purok","data","deceased"])])):V("",!0),e("div",{class:"action-buttons"},[e("button",{class:"btn btn-dark view-report",onClick:O},"View Reports")]),m.value.length>0?(r(),i("div",xe,[e("div",Ae,[e("table",Se,[o[5]||(o[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"NAME"),e("th",null,"CONTACT NO."),e("th",null,"PUROK"),e("th",null,"STATUS")])],-1)),e("tbody",null,[(r(!0),i(x,null,L(m.value,(t,j)=>{var $;return r(),i("tr",{key:j},[e("td",Ne,n(t==null?void 0:t.first_name)+" "+n(t==null?void 0:t.middle_name)+" "+n(t==null?void 0:t.last_name),1),e("td",null,n((t==null?void 0:t.contact_number)||"undefined"),1),e("td",null,n((t==null?void 0:t.purok)||"N/A"),1),e("td",null,[(p(_)||[]).includes(t==null?void 0:t.id)?(r(),i("button",{key:1,class:"btn btn-success",onClick:F=>I(t.id),title:"Mark member as unpaid"},o[4]||(o[4]=[e("i",{class:"bi bi-check-lg"},null,-1)]),8,Ie)):(r(),i("button",{key:0,class:R(["btn btn-danger",{disabled:t.purok.slice(-1)!==(($=p(M))==null?void 0:$.purok)}]),onClick:F=>D(t.id,t.purok,t.contact_number),title:"Mark member as paid"}," Paid ",10,De))])])}),128))])])])])):V("",!0),m.value.length>0?(r(),i("div",$e,[e("div",Te,[(r(!0),i(x,null,L(m.value,(t,j)=>{var $;return r(),i("div",{class:"mobile-card",key:j},[e("div",Le,[e("div",Ee,"ID: "+n(t==null?void 0:t.id),1),e("div",Oe,n((t==null?void 0:t.purok)||"N/A"),1)]),e("div",Re,[e("div",je,[o[6]||(o[6]=e("label",null,"Name:",-1)),e("span",Fe,n(t==null?void 0:t.first_name)+" "+n(t==null?void 0:t.middle_name)+" "+n(t==null?void 0:t.last_name),1)]),e("div",Ve,[o[7]||(o[7]=e("label",null,"Contact:",-1)),e("span",Be,n((t==null?void 0:t.contact_number)||"undefined"),1)]),e("div",Ue,[(p(_)||[]).includes(t==null?void 0:t.id)?(r(),i("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:F=>I(t.id),title:"Mark member as unpaid"},o[8]||(o[8]=[e("i",{class:"bi bi-check-lg"},null,-1),S(" Paid ")]),8,Ye)):(r(),i("button",{key:0,class:R(["btn btn-danger btn-sm mobile-pay-btn",{disabled:t.purok.slice(-1)!==(($=p(M))==null?void 0:$.purok)}]),onClick:F=>D(t.id,t.purok,t.contact_number),title:"Mark member as paid"}," Mark as Paid ",10,ze))])])])}),128))])])):(r(),i("div",We,[o[11]||(o[11]=e("img",{src:oe,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),e("h5",qe,[o[9]||(o[9]=S(" No contribution found for ")),e("span",Ge,n(p(k)||"N/A"),1),o[10]||(o[10]=S(". "))])]))])]),o[15]||(o[15]=e("div",{class:"container extra-space bg-dark"},null,-1)),e("div",He,[e("div",Je,[e("div",Ke,[o[14]||(o[14]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Select Collector"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Qe,[Y(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>X(b)?b.value=t:b=t),class:"form-select"},[o[12]||(o[12]=e("option",{value:"",disabled:""},"Select collector",-1)),(r(!0),i(x,null,L(p(y),t=>(r(),i("option",{key:t.id,value:t.name},n(t.name),9,Xe))),128))],512),[[Z,p(b)]])]),e("div",Ze,[o[13]||(o[13]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:g,disabled:!p(b),"data-bs-dismiss":"modal"}," Done ",8,et)])])])]),A.value?(r(),i("div",{key:0,class:"custom-modal-overlay",onClick:ee(z,["self"])},[e("div",tt,[e("button",{class:"close-btn",onClick:z},"×"),T(ye,{deceased:s.value,purok:p(k)},null,8,["deceased","purok"])])])):V("",!0)]}),_:1})],64))}},ut=U(ot,[["__scopeId","data-v-069189c3"]]);export{ut as default};
