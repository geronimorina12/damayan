import{r as k,C as ae,j as J,x as K,s as E,f as i,o as u,b as e,h as C,e as I,t as f,d as R,i as $,D as M,u as a,n as F,I as Y,E as ne,F as O,G as W,l as Q,J as Z,a as V,w as q,T as z,S as X,W as H,m as de,g as re,K as ie,z as ue}from"./app-BcApPCIf.js";import{A as ce}from"./AdminLayout-BUD_Vo90.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";const me={class:"container-fluid d-flex flex-row justify-content-center main-container"},be={class:"container mt-5"},ve={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},pe={class:"row g-3"},fe={class:"col-md-6"},ge={class:"col-md-6"},ye={key:0,class:"invalid-feedback d-block"},_e={class:"col-md-6"},he={class:"col-md-6"},$e={class:"col-md-6"},ke={class:"col-md-6"},we={class:"col-md-6"},Me={class:"col-md-6"},xe={class:"col-md-6"},Ae={class:"col-md-6"},Ce={key:0,class:"text-danger small mt-1"},Se={class:"col-12"},Ne={class:"mt-4"},Ve={key:0,class:"text-center mt-3 text-muted"},Ue={key:1,class:"table-responsive mt-2"},Be={class:"table table-bordered table-striped align-middle"},Ee=["onClick"],De={class:"d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 gap-3"},Ie={key:1,class:"card mt-4 p-3 shadow-sm"},Te={class:"col-md-6"},Le={class:"col-md-6"},qe={class:"col-md-6"},Re={class:"col-md-6"},Fe={key:0,class:"invalid-feedback d-block"},Pe={class:"col-12 d-flex justify-content-end gap-2 mt-3"},Oe=["disabled"],je={__name:"AddNewMember",props:{closeAddMemberModal:{},closeAddMemberModalModifiers:{}},emits:["update:closeAddMemberModal"],setup(U){const n=k({name:"",relation:"",age:"",birth_date:""}),l=ae(U,"closeAddMemberModal"),m=k([]),g=k(!1),d=k(""),w=k(""),A=k(""),x=J(()=>new Date().getFullYear()),D=v=>{if(!v)return"";const t=new Date,c=new Date(v);let T=t.getFullYear()-c.getFullYear();const j=t.getMonth()-c.getMonth();return(j<0||j===0&&t.getDate()<c.getDate())&&T--,T.toString()},B=(v,t)=>v&&new Date(v).getFullYear()>=x.value?(t.value="Birth year cannot be the current year or in the future.",!1):(t.value="",!0),b=K({first_name:"",last_name:"",address:"Bonga, Bulan, Sorsogon",contact_number:"",date_of_birth:"",purok:"",age:"",middle_name:"",status:"active",occupation:"",gender:"",beneficiaries:[]});E(()=>b.date_of_birth,v=>{B(v,A),v&&!A.value?b.age=D(v):b.age=""}),E(()=>n.value.birth_date,v=>{B(v,w),v&&!w.value?n.value.age=D(v):n.value.age=""});const h=()=>{if(b.clearErrors(),!/^0\d{10}$/.test(b.contact_number)){b.setError("contact_number","Contact number must start with 0 and be exactly 11 digits.");return}B(b.date_of_birth,A)&&(b.beneficiaries=m.value,b.post(route("addMemberPost"),{onSuccess:()=>{d.value="Member added successfully!",l.value=!0,setTimeout(()=>d.value="",4e3)},onError:t=>console.log("An error occurred => ",t)}))},s=()=>{B(n.value.birth_date,w)&&(m.value.push({...n.value}),n.value={name:"",relation:"",age:"",birth_date:""},w.value="",g.value=!1)},o=v=>{m.value.splice(v,1)},y=v=>{const t={year:"numeric",month:"long",day:"numeric"};return new Date(v).toLocaleDateString(void 0,t)};return(v,t)=>(u(),i("div",me,[e("div",be,[d.value?(u(),i("div",ve,[I(f(d.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=c=>d.value="")})])):C("",!0),e("form",{onSubmit:R(h,["prevent"]),class:"form"},[e("div",pe,[e("div",fe,[t[18]||(t[18]=e("label",{class:"form-label"},"Last name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Marinda","onUpdate:modelValue":t[1]||(t[1]=c=>a(b).last_name=c)},null,512),[[M,a(b).last_name]])]),e("div",ge,[t[19]||(t[19]=e("label",{class:"form-label"},"Birth date",-1)),$(e("input",{type:"date",class:F(["form-control",{"is-invalid":A.value}]),"onUpdate:modelValue":t[2]||(t[2]=c=>a(b).date_of_birth=c)},null,2),[[M,a(b).date_of_birth]]),A.value?(u(),i("div",ye,f(A.value),1)):C("",!0)]),e("div",_e,[t[20]||(t[20]=e("label",{class:"form-label"},"First name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Jovan","onUpdate:modelValue":t[3]||(t[3]=c=>a(b).first_name=c),required:""},null,512),[[M,a(b).first_name]])]),e("div",he,[t[21]||(t[21]=e("label",{class:"form-label"},"Age",-1)),$(e("input",{type:"number",class:"form-control",placeholder:"0","onUpdate:modelValue":t[4]||(t[4]=c=>a(b).age=c),required:"",disabled:""},null,512),[[M,a(b).age]])]),e("div",$e,[t[22]||(t[22]=e("label",{class:"form-label"},"Middle name",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Munticalbo","onUpdate:modelValue":t[5]||(t[5]=c=>a(b).middle_name=c)},null,512),[[M,a(b).middle_name]])]),e("div",ke,[t[24]||(t[24]=e("label",{class:"form-label"},"Gender",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=c=>a(b).gender=c),required:""},t[23]||(t[23]=[e("option",{value:"",disabled:""},"Select gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[Y,a(b).gender]])]),e("div",we,[t[26]||(t[26]=e("label",{class:"form-label"},"status",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=c=>a(b).status=c),disabled:""},t[25]||(t[25]=[e("option",{value:"active",selected:""},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[Y,a(b).status]])]),e("div",Me,[t[28]||(t[28]=e("label",{class:"form-label"},"Purok",-1)),$(e("select",{class:"form-select","onUpdate:modelValue":t[8]||(t[8]=c=>a(b).purok=c),required:""},t[27]||(t[27]=[ne('<option value="" disabled selected data-v-e77b1c17>Select Purok</option><option value="Purok 1" data-v-e77b1c17>Purok 1</option><option value="Purok 2" data-v-e77b1c17>Purok 2</option><option value="Purok 3" data-v-e77b1c17>Purok 3</option><option value="Purok 4" data-v-e77b1c17>Purok 4</option>',5)]),512),[[Y,a(b).purok]])]),e("div",xe,[t[29]||(t[29]=e("label",{class:"form-label"},"Occupation",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Farmer","onUpdate:modelValue":t[9]||(t[9]=c=>a(b).occupation=c),required:""},null,512),[[M,a(b).occupation]])]),e("div",Ae,[t[30]||(t[30]=e("label",{class:"form-label"},"Contact no.",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"09768734123","onUpdate:modelValue":t[10]||(t[10]=c=>a(b).contact_number=c),pattern:"[0-9]*",inputmode:"numeric"},null,512),[[M,a(b).contact_number]]),a(b).errors.contact_number?(u(),i("div",Ce,f(a(b).errors.contact_number),1)):C("",!0)]),e("div",Se,[t[31]||(t[31]=e("label",{class:"form-label"},"Address",-1)),$(e("input",{type:"text",class:"form-control",placeholder:"Bonga, Bulan, Sorsogon","onUpdate:modelValue":t[11]||(t[11]=c=>a(b).address=c),required:""},null,512),[[M,a(b).address]])])]),e("div",Ne,[t[33]||(t[33]=e("h5",{class:"text-dark fw-light"},"Beneficiary",-1)),m.value.length===0?(u(),i("div",Ve," No beneficiary added ")):(u(),i("div",Ue,[e("table",Be,[t[32]||(t[32]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Relation"),e("th",null,"Age"),e("th",null,"Birthdate"),e("th",null,"Action")])],-1)),e("tbody",null,[(u(!0),i(O,null,W(m.value,(c,T)=>(u(),i("tr",{key:T},[e("td",null,f(c.name),1),e("td",null,f(c.relation),1),e("td",null,f(c.age),1),e("td",null,f(y(c.birth_date)),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:j=>o(T)}," Delete ",8,Ee)])]))),128))])])]))]),e("div",De,[g.value?C("",!0):(u(),i("button",{key:0,class:"btn btn-primary w-100 w-md-auto",type:"button",onClick:t[12]||(t[12]=c=>g.value=!0)}," Add Beneficiary ")),t[34]||(t[34]=e("button",{class:"btn btn-success w-100 w-md-auto",type:"submit"},"Submit",-1))])],32),g.value?(u(),i("div",Ie,[t[36]||(t[36]=e("h5",{class:"mb-3"},"Add Beneficiary",-1)),e("form",{onSubmit:R(s,["prevent"]),class:"row g-2"},[e("div",Te,[$(e("input",{type:"text",placeholder:"Name",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=c=>n.value.name=c),required:""},null,512),[[M,n.value.name]])]),e("div",Le,[$(e("input",{type:"text",placeholder:"Relation",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=c=>n.value.relation=c),required:""},null,512),[[M,n.value.relation]])]),e("div",qe,[$(e("input",{type:"number",placeholder:"Age",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=c=>n.value.age=c),disabled:"",required:""},null,512),[[M,n.value.age]])]),e("div",Re,[t[35]||(t[35]=e("label",{class:"form-label small"},"Birthdate",-1)),$(e("input",{type:"date",class:F(["form-control",{"is-invalid":w.value}]),"onUpdate:modelValue":t[16]||(t[16]=c=>n.value.birth_date=c),required:""},null,2),[[M,n.value.birth_date]]),w.value?(u(),i("div",Fe,f(w.value),1)):C("",!0)]),e("div",Pe,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[17]||(t[17]=c=>g.value=!1)}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:!!w.value||!n.value.birth_date}," Save Beneficiary ",8,Oe)])],32)])):C("",!0)])]))}},Ye=P(je,[["__scopeId","data-v-e77b1c17"]]),We={class:"container mt-4"},Ge={key:0,class:"text-center my-5"},He={key:1,class:"alert alert-danger"},ze={key:2,class:"table-responsive"},Je={class:"table table-striped table-bordered shadow-sm"},Xe={key:3,class:"alert alert-info"},Ke={__name:"NewlyCreated",setup(U){const n=k([]),l=k(!0),m=k(null),g=async()=>{var w,A;try{const x=await Z.get("/member/new");n.value=x.data.data}catch(x){m.value=((A=(w=x.response)==null?void 0:w.data)==null?void 0:A.message)||"Failed to fetch latest members."}finally{l.value=!1}},d=w=>new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return Q(g),(w,A)=>(u(),i("div",We,[l.value?(u(),i("div",Ge,A[0]||(A[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):m.value?(u(),i("div",He,f(m.value),1)):n.value.length?(u(),i("div",ze,[e("table",Je,[A[1]||(A[1]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Address"),e("th",null,"Contact"),e("th",null,"Age"),e("th",null,"Gender"),e("th",null,"Registration Date")])],-1)),e("tbody",null,[(u(!0),i(O,null,W(n.value,x=>(u(),i("tr",{key:x.id},[e("td",null,f(x.first_name)+" "+f(x.middle_name)+" "+f(x.last_name),1),e("td",null,f(x.address),1),e("td",null,f(x.contact_number),1),e("td",null,f(x.age),1),e("td",null,f(x.gender),1),e("td",null,f(d(x.created_at)),1)]))),128))])])])):(u(),i("div",Xe," No newly registered members found. "))]))}},Qe=P(Ke,[["__scopeId","data-v-cb085a94"]]),Ze={class:"container-fluid d-flex flex-row justify-content-between align-items-center mb-2"},et={id:"addNewMemberModal",class:"custom-modal"},tt={class:"modal-content",style:{"min-width":"60%",height:"auto"}},st={class:"modal-header"},lt={class:"modal-body"},ot={id:"newCreatedMemberModal",class:"custom-modal",style:{"padding-top":"0"}},at={class:"modal-content",style:{"min-width":"60%",height:"auto"}},nt={class:"modal-header alig-items-center"},dt={class:"modal-body"},rt={__name:"Header",setup(U){const n=k(!1),l=g=>{document.getElementById(g).classList.add("show")},m=g=>{document.getElementById(g).classList.remove("show")};return window.addEventListener("click",g=>{document.querySelectorAll(".custom-modal").forEach(d=>{g.target===d&&d.classList.remove("show")})}),E(n,g=>{g&&(m("addNewMemberModal"),n.value=!1)}),(g,d)=>(u(),i("div",null,[e("div",Ze,[d[7]||(d[7]=e("div",null,[e("h5",{class:"ms-3 fw-light"},[e("span",{class:"d-none d-sm-none d-lg-inline-block me-2"},"Registered"),e("span",null,"Members")])],-1)),e("div",null,[e("button",{class:"modern-btn me-3",onClick:d[0]||(d[0]=R(w=>l("addNewMemberModal"),["prevent"]))},d[5]||(d[5]=[e("i",{class:"bi bi-person-plus"},null,-1),e("span",null,"Add Member",-1)])),e("button",{class:"modern-btn secondary",onClick:d[1]||(d[1]=w=>l("newCreatedMemberModal"))},d[6]||(d[6]=[e("i",{class:"bi bi-person-lines-fill"},null,-1),e("span",null,"Newly Created",-1)]))])]),e("div",et,[e("div",tt,[e("div",st,[d[8]||(d[8]=e("h3",null,"Add New Member",-1)),e("button",{class:"close-btn",onClick:d[2]||(d[2]=w=>m("addNewMemberModal"))},"Ã—")]),e("div",lt,[V(Ye,{closeAddMemberModal:n.value,"onUpdate:closeAddMemberModal":d[3]||(d[3]=w=>n.value=w)},null,8,["closeAddMemberModal"])])])]),e("div",ot,[e("div",at,[e("div",nt,[d[9]||(d[9]=e("div",{class:""},[e("h4",{class:"mb-3 text-dark fw-bold d-flex align-items-center"}," Newly Registered Member ")],-1)),e("button",{class:"close-btn2 fs-2",onClick:d[4]||(d[4]=w=>m("newCreatedMemberModal"))},"Ã—")]),e("div",dt,[V(Qe)])])])]))}},it=P(rt,[["__scopeId","data-v-fa52c126"]]),ut={__name:"Alert",props:{status:{type:Boolean,default:!1},name:{type:String,default:""}},setup(U){const n=U,l=k(!1),m=k(null),g=k("");return E(()=>n.status,d=>{m.value=d,g.value="bounce-in",l.value=!0,setTimeout(()=>{g.value="slide-out",setTimeout(()=>{l.value=!1},500)},3e3)}),(d,w)=>(u(),i("div",null,[l.value?(u(),i("div",{key:0,class:F(["alert alert-info",g.value]),role:"alert"},[I(f(U.name)+"'s status has been changed to ",1),e("strong",null,f(m.value?"Active":"Inactive"),1)],2)):C("",!0)]))}},ct=P(ut,[["__scopeId","data-v-f19df27b"]]),mt={class:"reminder-wrapper"},bt={class:"card shadow-sm p-4 rounded-4 bg-white border-0"},vt={key:0,class:"mb-4 text-center"},pt={class:"fw-bold text-primary mb-1"},ft={class:"text-muted mb-0"},gt={class:"row g-3"},yt={class:"col-md-6"},_t={key:0,class:"invalid-feedback d-block"},ht={class:"col-md-6"},$t={key:0,class:"mt-4"},kt={key:0,class:"mt-4 d-flex flex-wrap gap-3 justify-content-center"},wt={__name:"IsDeceased",props:{deceasedMember:{type:Object,default:()=>({})}},setup(U){const n=K({message:"",type:"deathReport",memberId:null,lastNight:"",startOfContribution:""}),l=U,m=k({}),g=k(""),d=k(""),w=k(!1),A=k(""),x=J(()=>!!A.value),D=J(()=>n.lastNight&&n.startOfContribution&&!x.value);Q(()=>{const o=new Date;n.startOfContribution=o.toISOString().split("T")[0]}),E(()=>l.deceasedMember,o=>{m.value=o},{immediate:!0});const B=o=>{if(!o){A.value="";return}const y=new Date(o),v=new Date;y.setHours(0,0,0,0),v.setHours(0,0,0,0),y<=v?A.value="The last night date cannot be set today or a past date.":A.value=""};E(()=>n.lastNight,o=>{B(o)}),E([()=>n.lastNight,()=>n.startOfContribution],([o,y])=>{var v;if(o&&y&&((v=m.value)!=null&&v.first_name)&&!x.value){const t=m.value;n.message=`We regret to inform you that ${t.first_name} ${t.last_name} has passed away. Last night is on ${s(o)}, and the collection for burial assistance starts on ${s(y)}.`,n.memberId=t.id}else n.message=""},{immediate:!0});function b(){if(!n.memberId){h("Missing member ID. Please select a member first.","danger");return}if(x.value){h("Please fix the validation errors before sending.","danger");return}H.post(route("smsNotification.sendReminders"),{message:n.message,type:n.type,memberId:n.memberId,lastNight:n.lastNight,startOfContribution:n.startOfContribution},{onSuccess:()=>h("SMS sent successfully."),onError:()=>h("An error occurred while sending SMS.")})}function h(o,y){g.value=o,d.value=y,w.value=!0,setTimeout(()=>w.value=!1,4e3)}const s=o=>{const y={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString(void 0,y)};return(o,y)=>(u(),i("div",mt,[e("div",bt,[V(z,{name:"fade"},{default:q(()=>[w.value?(u(),i("div",{key:0,class:F([["alert",d.value==="success"?"alert-success":"alert-danger"],"alert-dismissible fade show mb-3"]),role:"alert"},[I(f(g.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:y[0]||(y[0]=v=>w.value=!1),"aria-label":"Close"})],2)):C("",!0)]),_:1}),m.value.first_name?(u(),i("div",vt,[e("h4",pt,f(m.value.first_name)+" "+f(m.value.middle_name)+" "+f(m.value.last_name),1),e("p",ft,f(m.value.address),1)])):C("",!0),e("div",gt,[e("div",yt,[y[4]||(y[4]=e("label",{class:"form-label fw-semibold text-secondary"},"Enter last night:",-1)),$(e("input",{type:"date",class:F(["form-control",{"is-invalid":x.value}]),"onUpdate:modelValue":y[1]||(y[1]=v=>a(n).lastNight=v)},null,2),[[M,a(n).lastNight]]),x.value?(u(),i("div",_t,f(A.value),1)):C("",!0)]),e("div",ht,[y[5]||(y[5]=e("label",{class:"form-label fw-semibold text-secondary"},"Start of contribution:",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":y[2]||(y[2]=v=>a(n).startOfContribution=v)},null,512),[[M,a(n).startOfContribution]])])]),V(z,{name:"fade"},{default:q(()=>[a(n).message&&!x.value?(u(),i("div",$t,[y[6]||(y[6]=e("label",{class:"form-label fw-semibold text-secondary"},"Message:",-1)),$(e("textarea",{class:"form-control","onUpdate:modelValue":y[3]||(y[3]=v=>a(n).message=v),rows:"4",style:{resize:"vertical","min-height":"100px"}},null,512),[[M,a(n).message]])])):C("",!0)]),_:1}),V(z,{name:"fade"},{default:q(()=>{var v;return[D.value?(u(),i("div",kt,[V(a(X),{href:o.route("smsNotification.sendToAllSelectedV2",{type:"deathReport",message:a(n).message,deceased:(v=m.value)==null?void 0:v.id,last:a(n).lastNight}),class:"btn-modern text-decoration-none"},{default:q(()=>y[7]||(y[7]=[e("i",{class:"bi bi-people-fill me-2"},null,-1),I("Send to all selected ")])),_:1},8,["href"]),e("button",{class:"btn-modern",onClick:b},y[8]||(y[8]=[e("i",{class:"bi bi-send-fill me-2"},null,-1),I("Send ")]))])):C("",!0)]}),_:1})])]))}},Mt=P(wt,[["__scopeId","data-v-757f73ae"]]),xt={class:"container-fluid d-flex flex-row justify-content-center main-container"},At={class:"container mt-5"},Ct={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},St={class:"row g-3"},Nt={class:"col-12 d-md-none"},Vt={class:"row g-2"},Ut={class:"col-12"},Bt={class:"col-12"},Et={class:"col-12"},Dt={class:"col-md-4 d-none d-md-block"},It={class:"col-md-4 d-none d-md-block"},Tt={class:"col-md-4 d-none d-md-block"},Lt={class:"col-12 col-md-6"},qt={class:"col-12 col-md-6"},Rt={class:"col-12 col-md-6"},Ft={class:"col-12 col-md-6"},Pt={class:"col-12 col-md-6"},Ot={class:"col-12 col-md-6"},jt={class:"col-12 col-md-6"},Yt={key:0,class:"text-danger small mt-1"},Wt={class:"col-12"},Gt={class:"mt-4"},Ht={key:0,class:"text-center mt-3 text-muted"},zt={key:1,class:"table-responsive mt-2"},Jt={class:"table table-bordered table-striped align-middle"},Xt=["onClick"],Kt={class:"d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 gap-3"},Qt={key:1,class:"card mt-4 p-3 shadow-sm"},Zt={class:"col-md-6"},es={class:"col-md-6"},ts={class:"col-md-6"},ss={class:"col-md-6"},ls={class:"col-12 d-flex justify-content-end gap-2 mt-3"},os={__name:"EditMember",props:{member:{type:Object,default:()=>({})}},setup(U){const n=U,l=K({first_name:"",last_name:"",address:"",contact_number:"",date_of_birth:"",purok:"",age:"",middle_name:"",status:"",occupation:"",gender:"",beneficiaries:[]}),m=k([]),g=k({name:"",relation:"",age:"",birth_date:""}),d=k(!1),w=k(""),A=async h=>{if(!h){console.log("No member ID provided");return}try{const s=await Z.get(route("beneficiaries.fetch",{member:h}));s.data.success?(m.value=s.data.data,console.log("Beneficiaries fetched successfully:",s.data.data)):console.error("Failed to fetch beneficiaries:",s.data.message)}catch(s){console.error("Error fetching beneficiaries:",s)}};E(()=>n.member,h=>{h&&(l.first_name=h.first_name||"",l.last_name=h.last_name||"",l.address=h.address||"",l.contact_number=h.contact_number||"",l.date_of_birth=h.date_of_birth||"",l.purok=h.purok||"",l.age=h.age||"",l.middle_name=h.middle_name||"",l.status=h.status||"",l.occupation=h.occupation||"",l.gender=h.gender||"",l.beneficiaries=h.beneficiaries||[],h.id&&A(h.id))},{immediate:!0,deep:!0});const x=()=>{if(l.clearErrors(),!/^0\d{10}$/.test(l.contact_number)){l.setError("contact_number","Contact number must start with 0 and be exactly 11 digits.");return}l.beneficiaries=m.value,l.put(route("members.update",n.member.id),{onSuccess:()=>{w.value="Member updated successfully!",setTimeout(()=>w.value="",4e3),A(n.member.id)},onError:s=>console.error("An error occurred => ",s)})},D=()=>{const h={...g.value,member_id:n.member.id};m.value.push(h),g.value={name:"",relation:"",age:"",birth_date:""},d.value=!1},B=h=>{m.value.splice(h,1)},b=h=>{if(!h)return"";const s={year:"numeric",month:"long",day:"numeric"};return new Date(h).toLocaleDateString(void 0,s)};return(h,s)=>(u(),i("div",xt,[e("div",At,[w.value?(u(),i("div",Ct,[I(f(w.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=o=>w.value="")})])):C("",!0),e("form",{onSubmit:R(x,["prevent"]),class:"form"},[e("div",St,[e("div",Nt,[e("div",Vt,[e("div",Ut,[$(e("input",{type:"text",class:"form-control",placeholder:"First name","onUpdate:modelValue":s[1]||(s[1]=o=>a(l).first_name=o),required:""},null,512),[[M,a(l).first_name]])]),e("div",Bt,[$(e("input",{type:"text",class:"form-control",placeholder:"Middle name","onUpdate:modelValue":s[2]||(s[2]=o=>a(l).middle_name=o)},null,512),[[M,a(l).middle_name]])]),e("div",Et,[$(e("input",{type:"text",class:"form-control",placeholder:"Last name","onUpdate:modelValue":s[3]||(s[3]=o=>a(l).last_name=o)},null,512),[[M,a(l).last_name]])])])]),e("div",Dt,[$(e("input",{type:"text",class:"form-control",placeholder:"First name","onUpdate:modelValue":s[4]||(s[4]=o=>a(l).first_name=o),required:""},null,512),[[M,a(l).first_name]])]),e("div",It,[$(e("input",{type:"text",class:"form-control",placeholder:"Middle name","onUpdate:modelValue":s[5]||(s[5]=o=>a(l).middle_name=o)},null,512),[[M,a(l).middle_name]])]),e("div",Tt,[$(e("input",{type:"text",class:"form-control",placeholder:"Last name","onUpdate:modelValue":s[6]||(s[6]=o=>a(l).last_name=o)},null,512),[[M,a(l).last_name]])]),e("div",Lt,[s[21]||(s[21]=e("label",{class:"form-label"},"Birth date",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=o=>a(l).date_of_birth=o)},null,512),[[M,a(l).date_of_birth]])]),e("div",qt,[$(e("input",{type:"number",class:"form-control",placeholder:"Age","onUpdate:modelValue":s[8]||(s[8]=o=>a(l).age=o),required:""},null,512),[[M,a(l).age]])]),e("div",Rt,[$(e("select",{class:"form-select","onUpdate:modelValue":s[9]||(s[9]=o=>a(l).gender=o),required:""},s[22]||(s[22]=[e("option",{value:"",disabled:""},"Gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[Y,a(l).gender]])]),e("div",Ft,[$(e("select",{class:"form-select","onUpdate:modelValue":s[10]||(s[10]=o=>a(l).status=o),required:""},s[23]||(s[23]=[e("option",{value:"",disabled:""},"Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[Y,a(l).status]])]),e("div",Pt,[$(e("input",{type:"text",class:"form-control",placeholder:"Purok","onUpdate:modelValue":s[11]||(s[11]=o=>a(l).purok=o),required:""},null,512),[[M,a(l).purok]])]),e("div",Ot,[$(e("input",{type:"text",class:"form-control",placeholder:"Occupation","onUpdate:modelValue":s[12]||(s[12]=o=>a(l).occupation=o),required:""},null,512),[[M,a(l).occupation]])]),e("div",jt,[$(e("input",{type:"text",class:"form-control",placeholder:"Contact no.","onUpdate:modelValue":s[13]||(s[13]=o=>a(l).contact_number=o),pattern:"[0-9]*",inputmode:"numeric"},null,512),[[M,a(l).contact_number]]),a(l).errors.contact_number?(u(),i("div",Yt,f(a(l).errors.contact_number),1)):C("",!0)]),e("div",Wt,[$(e("input",{type:"text",class:"form-control",placeholder:"Address","onUpdate:modelValue":s[14]||(s[14]=o=>a(l).address=o),required:""},null,512),[[M,a(l).address]])])]),e("div",Gt,[s[25]||(s[25]=e("h5",{class:"text-dark fw-light"},"Beneficiary",-1)),m.value.length===0?(u(),i("div",Ht," No beneficiary added ")):(u(),i("div",zt,[e("table",Jt,[s[24]||(s[24]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Relation"),e("th",null,"Age"),e("th",null,"Birthdate"),e("th",null,"Action")])],-1)),e("tbody",null,[(u(!0),i(O,null,W(m.value,(o,y)=>(u(),i("tr",{key:y},[e("td",null,f(o.name),1),e("td",null,f(o.relation),1),e("td",null,f(o.age),1),e("td",null,f(b(o.birth_date)),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:v=>B(y)}," Delete ",8,Xt)])]))),128))])])]))]),e("div",Kt,[d.value?C("",!0):(u(),i("button",{key:0,class:"btn btn-primary w-100 w-md-auto",type:"button",onClick:s[15]||(s[15]=o=>d.value=!0)}," Add Beneficiary ")),s[26]||(s[26]=e("button",{class:"btn btn-success w-100 w-md-auto",type:"submit"},"Save",-1))])],32),d.value?(u(),i("div",Qt,[s[29]||(s[29]=e("h5",{class:"mb-3"},"Add Beneficiary",-1)),e("form",{onSubmit:R(D,["prevent"]),class:"row g-2"},[e("div",Zt,[$(e("input",{type:"text",placeholder:"Name",class:"form-control","onUpdate:modelValue":s[16]||(s[16]=o=>g.value.name=o),required:""},null,512),[[M,g.value.name]])]),e("div",es,[$(e("input",{type:"text",placeholder:"Relation",class:"form-control","onUpdate:modelValue":s[17]||(s[17]=o=>g.value.relation=o),required:""},null,512),[[M,g.value.relation]])]),e("div",ts,[$(e("input",{type:"number",placeholder:"Age",class:"form-control","onUpdate:modelValue":s[18]||(s[18]=o=>g.value.age=o),required:""},null,512),[[M,g.value.age]])]),e("div",ss,[s[27]||(s[27]=e("label",{class:"form-label small"},"Birthdate",-1)),$(e("input",{type:"date",class:"form-control","onUpdate:modelValue":s[19]||(s[19]=o=>g.value.birth_date=o),required:""},null,512),[[M,g.value.birth_date]])]),e("div",ls,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[20]||(s[20]=o=>d.value=!1)}," Cancel "),s[28]||(s[28]=e("button",{type:"submit",class:"btn btn-primary"},"Save Beneficiary",-1))])],32)])):C("",!0)])]))}},as=P(os,[["__scopeId","data-v-881cc22e"]]),ns={class:"main-section bg-light"},ds={class:"container table-container"},rs={class:"search-box mb-3 position-relative"},is={key:0,class:"spinner-border text-primary spinner-sm position-absolute end-0 top-50 translate-middle-y me-3",role:"status"},us={class:"table-responsive"},cs={class:"table table-bordered align-middle text-center"},ms={key:0},bs={key:1},vs={colspan:"9",class:"text-danger text-center"},ps={class:"text-start"},fs={class:"status-cell"},gs={class:"status-toggle"},ys={class:"toggle-switch"},_s=["checked","onChange"],hs={class:"status-cell"},$s={class:"status-toggle"},ks={class:"toggle-switch"},ws=["data-member-id","checked","onClick"],Ms={class:"actions-column"},xs={class:"action-buttons-large"},As=["onClick"],Cs=["onClick"],Ss={class:"action-buttons-small"},Ns=["onClick"],Vs={key:2},Us={class:"pagination-wrapper mt-3 mb-5"},Bs={class:"pagination-controls"},Es=["onClick","innerHTML"],Ds={class:"list-unstyled m-0"},Is={class:"modal fade",id:"editMember",tabindex:"-1"},Ts={class:"modal-dialog modal-lg"},Ls={class:"modal-content"},qs={class:"modal-body"},Rs={class:"custom-modal"},Fs={class:"custom-modal-body"},Ps=400,Os={__name:"RegisteredMember",props:{members:{type:Object,default:()=>({data:[],links:[],prev_page_url:null,next_page_url:null})},deceasedMember:{type:Array,default:()=>[]}},setup(U){const n=U,l=k([]),m=k(!1),g=k({top:"0px",left:"0px"}),d=k(null),w=k(!1),A=k(""),x=k(""),D=k([]),B=k({}),b=k(!1),h=k({}),s=k(!1),o=k(""),y=k(null);E(()=>n.members,p=>{l.value=p.data||[]},{immediate:!0}),E(()=>n.deceasedMember,p=>{D.value=p.data||[]},{immediate:!0});let v=null;E(x,p=>{v&&clearTimeout(v),v=setTimeout(()=>t(String(p||"").trim()),Ps)});async function t(p){if(!p){l.value=n.members.data,console.log("Search cleared â€” showing default members:",l.value),s.value=!1;return}s.value=!0,o.value="",console.log(`ðŸ” Searching for: "${p}"`);try{const r=await Z.get(route("members.search"),{params:{query:p}});console.log(" Raw Axios response:",r),console.log(" Response data:",r.data);let _=[];const S=(r==null?void 0:r.data)||{};if(Array.isArray(S.members))_=S.members;else if(S.members&&Array.isArray(S.members.data))_=S.members.data;else if(S.member&&typeof S.member=="object")_=[S.member];else if(Array.isArray(S.data))_=S.data;else{const N=Object.values(S).find(G=>{var L;return Array.isArray(G)&&((L=G[0])==null?void 0:L.id)});N&&(_=N)}console.log("ðŸ§¾ Normalized members array to display:",_),l.value=_}catch(r){console.error("âŒ Search error:",r),o.value="Error fetching search results."}finally{s.value=!1}}const c=p=>{confirm("Are you sure you want to trash this member?")&&H.delete(route("deleteMember",{id:p}),{onSuccess:()=>{alert("Member trashed"),m.value=!1}})},T=p=>{const r=p.status==="active"?"inactive":"active";H.put(route("toggleMemberStatus",{id:p.id}),{status:r},{onSuccess:()=>{p.status=r,w.value=r==="active",A.value=`${p.first_name} ${p.middle_name} ${p.last_name}`}})},j=(p,r)=>{if(m.value&&d.value===r){m.value=!1,d.value=null;return}d.value=r,m.value=!0,ue(()=>{const _=p.currentTarget.getBoundingClientRect(),S=document.querySelector(".actions-popup");if(!S)return;const N=S.offsetWidth,G=window.innerWidth;let L=_.right+window.scrollX+10;L+N>G&&(L=_.left+window.scrollX-N-10,L<0&&(L=10)),g.value={top:`${_.top+window.scrollY}px`,left:`${L}px`}})},ee=p=>{m.value&&p.target&&!p.target.closest(".actions-popup")&&!p.target.closest(".three-dots-button")&&(m.value=!1,d.value=null)};Q(()=>document.addEventListener("click",ee)),de(()=>document.removeEventListener("click",ee));const le=p=>{p&&H.visit(p,{preserveState:!0})},oe=p=>{B.value=p||null,b.value=!0,y.value=(p==null?void 0:p.id)||null},te=()=>{if(b.value=!1,y.value){const p=document.querySelector(`input[type="checkbox"][data-member-id="${y.value}"]`);p&&(p.checked=!1),y.value=null}},se=p=>{m.value=!1,h.value={...p}};return(p,r)=>(u(),i(O,null,[V(a(re),{title:"Registered members"}),V(ce,null,{default:q(()=>[e("div",ns,[V(it),V(ct,{status:w.value,name:A.value},null,8,["status","name"]),e("div",ds,[e("div",rs,[$(e("input",{type:"text",class:"form-control search-input",placeholder:"Search members by name, contact, or purok...","onUpdate:modelValue":r[0]||(r[0]=_=>x.value=_)},null,512),[[M,x.value]]),s.value?(u(),i("div",is,r[3]||(r[3]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):C("",!0)]),e("div",us,[e("table",cs,[r[12]||(r[12]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"NAME"),e("th",null,"GENDER"),e("th",null,"AGE"),e("th",null,"CONTACT NO."),e("th",null,"STREET"),e("th",null,"STATUS"),e("th",null,"DECEASED"),e("th",null,"ACTION")])],-1)),e("tbody",null,[s.value?(u(),i("tr",ms,r[4]||(r[4]=[e("td",{colspan:"9",class:"text-center"},[e("div",{class:"spinner-border text-info",role:"status"}),e("p",{class:"mt-2 text-muted"},"Searching...")],-1)]))):C("",!0),o.value&&!s.value?(u(),i("tr",bs,[e("td",vs,f(o.value),1)])):C("",!0),(u(!0),i(O,null,W(l.value,(_,S)=>(u(),i("tr",{key:S},[e("td",ps,f(_.first_name)+" "+f(_.middle_name)+" "+f(_.last_name),1),e("td",null,f(_.gender||"N/A"),1),e("td",null,f(_.age),1),e("td",null,f(_.contact_number),1),e("td",null,f(_.purok),1),e("td",fs,[e("div",gs,[e("label",ys,[e("input",{type:"checkbox",checked:_.status==="active",onChange:N=>T(_)},null,40,_s),r[5]||(r[5]=e("span",{class:"toggle-slider"},null,-1))]),e("span",{class:F(["status-label",_.status==="active"?"active":"inactive"])},f(_.status==="active"?"Active":"Inactive"),3)])]),e("td",hs,[e("div",$s,[e("label",ks,[e("input",{type:"checkbox","data-member-id":_.id,checked:D.value.some(N=>N.member_id===_.id),onClick:N=>oe(_)},null,8,ws),r[6]||(r[6]=e("span",{class:"toggle-slider"},null,-1))])])]),e("td",Ms,[e("div",xs,[V(a(X),{href:p.route("viewMemberInfo",{id:_.id}),class:"me-1"},{default:q(()=>r[7]||(r[7]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["href"]),e("button",{"data-bs-toggle":"modal","data-bs-target":"#editMember",onClick:N=>se(_),class:"me-1"},r[8]||(r[8]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,As),e("button",{onClick:N=>c(_.id)},r[9]||(r[9]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Cs)]),e("div",Ss,[e("button",{class:"btn btn-sm btn-outline-dark three-dots-button",onClick:R(N=>j(N,_.id),["stop"])},r[10]||(r[10]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)]),8,Ns)])])]))),128)),!s.value&&l.value.length===0?(u(),i("tr",Vs,r[11]||(r[11]=[e("td",{colspan:"9",class:"text-center text-muted"},"No members found",-1)]))):C("",!0)])])]),e("div",Us,[e("div",Bs,[(u(!0),i(O,null,W(n.members.links,(_,S)=>(u(),i("button",{key:S,class:F(["btn pagination-btn",_.active?"btn-primary":"btn-outline-primary"]),onClick:N=>le(_.url),innerHTML:_.label},null,10,Es))),128))])])])]),m.value?(u(),i("div",{key:0,class:"actions-popup bg-white border rounded shadow-sm p-2",style:ie({top:g.value.top,left:g.value.left})},[e("ul",Ds,[e("li",null,[V(a(X),{href:p.route("viewMemberInfo",{id:d.value}),class:"dropdown-item"},{default:q(()=>r[13]||(r[13]=[e("i",{class:"bi bi-eye me-2"},null,-1),I(" View")])),_:1},8,["href"])]),e("li",null,[e("button",{class:"dropdown-item w-100 text-start","data-bs-toggle":"modal","data-bs-target":"#editMember",onClick:r[1]||(r[1]=_=>se(l.value.find(S=>S.id===d.value)))},r[14]||(r[14]=[e("i",{class:"bi bi-pencil me-2"},null,-1),I(" Edit")]))]),e("li",null,[e("button",{class:"dropdown-item w-100 text-start text-danger",onClick:r[2]||(r[2]=_=>c(d.value))},r[15]||(r[15]=[e("i",{class:"bi bi-trash me-2"},null,-1),I(" Delete")]))])])],4)):C("",!0),e("div",Is,[e("div",Ts,[e("div",Ls,[r[16]||(r[16]=e("div",{class:"modal-header"},[e("h5",null,"Edit Member Info"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",qs,[V(as,{member:h.value},null,8,["member"])])])])]),b.value?(u(),i("div",{key:1,class:"custom-modal-overlay",onClick:R(te,["self"])},[e("div",Rs,[e("div",{class:"custom-modal-header"},[r[17]||(r[17]=e("h3",null,"Add Deceased Info",-1)),e("span",{class:"close-icon",onClick:te},"Ã—")]),e("div",Fs,[V(Mt,{deceasedMember:B.value},null,8,["deceasedMember"])])])])):C("",!0)]),_:1})],64))}},Hs=P(Os,[["__scopeId","data-v-aa5e6a8f"]]);export{Hs as default};
