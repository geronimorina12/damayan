import{r,s as p,j as K,x as Q,f as l,o as a,a as M,u as d,g as q,w as H,b as s,h as S,i as j,D as J,F as A,G as m,t as i,n as E,e as I,M as X,I as Y,d as Z,W as U,z as ee}from"./app-C_rMQMGW.js";import{_ as te}from"./not_found-DvAnRRcV.js";import{C as se}from"./CollectorLayout-_je7zD1F.js";import{P as oe,V as le}from"./ViewAsCollector-DzK6zTDN.js";import{_ as ae}from"./ToggleContribution-DIHE8L8p.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo1-BZ0h4foK.js";import"./html2pdf-DQnMBPah.js";const ie={class:"container main-container"},re={class:"bg-light p-2 pt-0"},de={class:"container-fluid d-flex justify-content-between align-items-center px-0 header-container"},ue={class:"mt-3 mb-3 search-container"},ce={key:0,class:"mt-5"},be={key:1,class:"table-wrapper mt-3 desktop-view"},ve={class:"table-responsive"},pe={class:"table table-bordered table-hover align-middle text-center mb-0"},_e={class:"text-start"},fe=["onClick"],ke={key:0},ye={key:1},Ce={key:2,class:"mobile-view"},he={class:"mobile-cards-container"},ge={class:"mobile-card-header"},Me={class:"mobile-member-id"},xe={class:"mobile-purok"},Pe={class:"mobile-card-body"},we={class:"mobile-field"},Ae={class:"mobile-value"},Ne={class:"mobile-field"},Se={class:"mobile-value"},me={class:"mobile-actions"},Ie=["onClick"],Te=["onClick"],De={key:3,class:"container mt-4 text-center"},Le={class:"fw-light"},Ve={class:"text-success"},Oe={class:"modal fade",id:"collectorModal",tabindex:"-1","aria-hidden":"true"},Re={class:"modal-dialog"},Fe={class:"modal-content"},je={class:"modal-body"},Ee=["value"],Ue={class:"modal-footer"},ze=["disabled"],Be={class:"custom-modal"},$e={__name:"MemberContribution",props:{member:Array,selectedPurok:String,collectors:Array,paidMembersId:Array,currentCollector:Object,currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(z){const b=z;let n=r([]),k=r(""),T=r([]),v=r([]),y=r(null),D=r(""),u=r(""),C=r({});const L=r([]),c=r({});p(()=>b.member,o=>{o?Array.isArray(o.data)?n.value=o.data:Array.isArray(o)?n.value=o:n.value=[]:n.value=[],console.log("Normalized Member data:",n.value)},{immediate:!0}),p(()=>b.selectedPurok,o=>k.value=o,{immediate:!0}),p(()=>b.collectors,o=>T.value=o,{immediate:!0}),p(()=>b.paidMembersId,o=>{v.value=Array.isArray(o)?o:[]},{immediate:!0}),p(()=>b.currentCollector,o=>{C.value=o||{},console.log("Current Collector:",C.value)},{immediate:!0}),p(()=>b.currentDeceasedMembers,o=>L.value=o?Object.values(o):[],{immediate:!0}),p(()=>b.currentDeceasedMember,o=>c.value=o,{immediate:!0});const x=r(""),P=K(()=>{if(!x.value.trim())return n.value;const o=x.value.toLowerCase();return n.value.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(o)||t.last_name&&t.last_name.toLowerCase().includes(o)||t.middle_name&&t.middle_name.toLowerCase().includes(o)||t.contact_number&&t.contact_number.toLowerCase().includes(o)||t.purok&&t.purok.toLowerCase().includes(o))}),w=Q({member_id:null,amount:100,payment_date:new Date().toISOString().split("T")[0],collector:null,purok:"",status:"paid"}),B=o=>(o==null?void 0:o.toLowerCase().replace(/\s+/g,""))||"",V=(o,t,_)=>{var e,f;if(!o||!t){console.warn("Missing member data for preparePayment()");return}y.value=o,D.value=t,u.value="",U.post(route("smsNotification.sendScheduleContribution"),{id:o,message:"Successfully paid.",contact_number:_,collector:((e=C.value)==null?void 0:e.name)||"",purok:t,deceasedId:((f=c.value)==null?void 0:f.member_id)??null},{onSuccess:()=>{alert("Schedule Contribution sent successfully!")},onError:()=>{alert("Error sending Schedule Contribution")}})},$=()=>{w.member_id=y.value,w.purok=B(D.value),w.collector=u.value,w.post(route("contributions.store"),{onSuccess:()=>{const o=n.value.findIndex(t=>t.id===y.value);o!==-1&&(n.value[o]={...n.value[o],paid:!0}),ee(()=>{const t=Number(y.value);v.value.includes(t)||v.value.push(t)}),y.value=null,u.value=""}})},O=o=>{if(!o){console.warn("No memberId passed in unPaidFunc()");return}U.delete(route("collectorContribution.deleteContribution",o),{onSuccess:()=>{const t=n.value.findIndex(e=>e.id===o);t!==-1&&(n.value[t]={...n.value[t],paid:!1});const _=Number(o);v.value=v.value.filter(e=>e!==_)},onError:()=>{alert("Failed to unmark payment. Try again.")}})},N=r(!1),W=()=>N.value=!0,R=()=>N.value=!1,h=o=>Array.isArray(v.value)?v.value.some(t=>t==o):!1,G=o=>{h(o.id)?O(o.id):V(o.id,o.purok,o.contact_number)};return(o,t)=>(a(),l(A,null,[M(d(q),{title:"Member contribution"}),M(se,null,{default:H(()=>{var _;return[s("div",ie,[s("div",re,[s("div",de,[t[3]||(t[3]=s("div",{class:"page-title"},[s("h6",{class:"mt-1 ms-2 fs-3"},"Payment Contribution")],-1)),s("div",ue,[j(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),type:"text",class:"form-control w-100",placeholder:"Search by name, contact, or purok..."},null,512),[[J,x.value]])])]),M(oe,{activePurok:d(k),deceasedId:(_=c.value)==null?void 0:_.member_id},null,8,["activePurok","deceasedId"]),c.value?(a(),l("div",ce,[M(ae,{allDeceased:L.value,purok:d(k),data:c.value,deceased:c.value,"onUpdate:deceased":t[1]||(t[1]=e=>c.value=e)},null,8,["allDeceased","purok","data","deceased"])])):S("",!0),s("div",{class:"action-buttons"},[s("button",{class:"btn btn-dark view-report",onClick:W},"View Reports")]),P.value.length>0?(a(),l("div",be,[s("div",ve,[s("table",pe,[t[4]||(t[4]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"NAME"),s("th",null,"CONTACT NO."),s("th",null,"PUROK"),s("th",null,"STATUS")])],-1)),s("tbody",null,[(a(!0),l(A,null,m(P.value,(e,f)=>{var g;return a(),l("tr",{key:f},[s("td",_e,i(e==null?void 0:e.first_name)+" "+i(e==null?void 0:e.middle_name)+" "+i(e==null?void 0:e.last_name),1),s("td",null,i((e==null?void 0:e.contact_number)||"undefined"),1),s("td",null,i((e==null?void 0:e.purok)||"N/A"),1),s("td",null,[s("button",{class:E(["status-btn",{"status-paid":h(e.id),"status-unpaid":!h(e.id),disabled:e.purok.slice(-1)!==((g=d(C))==null?void 0:g.purok)}]),onClick:F=>G(e)},[h(e.id)?(a(),l("span",ke,"✔ Paid")):(a(),l("span",ye,"Paid"))],10,fe)])])}),128))])])])])):S("",!0),P.value.length>0?(a(),l("div",Ce,[s("div",he,[(a(!0),l(A,null,m(P.value,(e,f)=>{var g;return a(),l("div",{class:"mobile-card",key:f},[s("div",ge,[s("div",Me,"ID: "+i(e==null?void 0:e.id),1),s("div",xe,i((e==null?void 0:e.purok)||"N/A"),1)]),s("div",Pe,[s("div",we,[t[5]||(t[5]=s("label",null,"Name:",-1)),s("span",Ae,i(e==null?void 0:e.first_name)+" "+i(e==null?void 0:e.middle_name)+" "+i(e==null?void 0:e.last_name),1)]),s("div",Ne,[t[6]||(t[6]=s("label",null,"Contact:",-1)),s("span",Se,i((e==null?void 0:e.contact_number)||"undefined"),1)]),s("div",me,[h(e.id)?(a(),l("button",{key:1,class:"btn btn-success btn-sm mobile-paid-btn",onClick:F=>O(e.id),title:"Mark member as unpaid"},t[7]||(t[7]=[s("i",{class:"bi bi-check-lg"},null,-1),I(" Paid ")]),8,Te)):(a(),l("button",{key:0,class:E(["btn btn-danger btn-sm mobile-pay-btn",{disabled:e.purok.slice(-1)!==((g=d(C))==null?void 0:g.purok)}]),onClick:F=>V(e.id,e.purok,e.contact_number),title:"Mark member as paid"}," Paid ",10,Ie))])])])}),128))])])):(a(),l("div",De,[t[10]||(t[10]=s("img",{src:te,alt:"No Data",class:"not-found-image image-rounded"},null,-1)),s("h5",Le,[t[8]||(t[8]=I(" No contribution found for ")),s("span",Ve,i(d(k)||"N/A"),1),t[9]||(t[9]=I(". "))])]))])]),t[14]||(t[14]=s("div",{class:"container extra-space bg-dark"},null,-1)),s("div",Oe,[s("div",Re,[s("div",Fe,[t[13]||(t[13]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Select Collector"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s("div",je,[j(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>X(u)?u.value=e:u=e),class:"form-select"},[t[11]||(t[11]=s("option",{value:"",disabled:""},"Select collector",-1)),(a(!0),l(A,null,m(d(T),e=>(a(),l("option",{key:e.id,value:e.name},i(e.name),9,Ee))),128))],512),[[Y,d(u)]])]),s("div",Ue,[t[12]||(t[12]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:!d(u),"data-bs-dismiss":"modal"}," Done ",8,ze)])])])]),N.value?(a(),l("div",{key:0,class:"custom-modal-overlay",onClick:Z(R,["self"])},[s("div",Be,[s("button",{class:"close-btn",onClick:R},"×"),M(le,{deceased:c.value,purok:d(k)},null,8,["deceased","purok"])])])):S("",!0)]}),_:1})],64))}},Ye=ne($e,[["__scopeId","data-v-68e9b720"]]);export{Ye as default};
