import{r as l,s as d,f as M,o as x,b as t,t as y,u,F as R,G as w,n as $,W as S,K as F,C as j,j as P,U as O,a as C,g as U,w as V,h as A,d as B}from"./app-B2PZaDBq.js";import{C as E}from"./CollectorLayout-Bi7VCnpL.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as T}from"./ViewAsCollector-DxnRbqa7.js";import"./logo1-BZ0h4foK.js";import"./html2pdf-DTn4ufS3.js";const H={class:"table-wrapper mt-3"},K={class:"container-fluid header-container"},L={class:"table"},W={class:"tbody"},z={style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},G={class:"bg-light"},q={class:"bg-light"},J={class:"bg-light"},Q={class:"bg-light"},X={class:"bg-light"},Y={__name:"SubHeaderForCollectorReport",props:{membersCount:{type:Number,default:0},amount:{type:Number,default:0},activePurok:{type:String,default:""},paidMembers:{type:Number,default:0},unpaidMembers:{type:Number,default:0}},setup(f){const e=f;let b=l(0),i=l(0),m=l(""),g=l(""),v=l("");return d(()=>e.amount,o=>{i.value=o},{immediate:!0}),d(()=>e.membersCount,o=>{b.value=o},{immediate:!0}),d(()=>e.activePurok,o=>{m.value=o},{immediate:!0}),d(()=>e.paidMembers,o=>{g.value=i.value/100},{immediate:!0}),d(()=>e.unpaidMembers,o=>{v.value=o.toString()+(o===1?" Member":" Members")},{immediate:!0}),(o,n)=>(x(),M("div",H,[t("div",K,[t("table",L,[n[0]||(n[0]=t("thead",{class:"thead"},[t("tr",{style:{"border-top":"1px solid #000","border-bottom":"1px solid #000"}},[t("td",{class:"bg-light"},"MEMBERS"),t("td",{class:"bg-light"},"AMOUNT"),t("td",{class:"bg-light"},"PUROK"),t("td",{class:"bg-light"},"PAID"),t("td",{class:"bg-light"},"UNPAID")])],-1)),t("tbody",W,[t("tr",z,[t("td",G,y(u(b))+" Members",1),t("td",q,y(u(i)),1),t("td",J,y(u(m)[5]||"All"),1),t("td",Q,y(u(g)),1),t("td",X,y(u(b)-u(g)),1)])])])])]))}},Z=I(Y,[["__scopeId","data-v-565aad73"]]),ee={class:"d-flex flex-row justify-content-between align-items-center px-0"},te=["onClick"],re={__name:"PurokComponentForCollectorReport",props:{activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},deceasedId:{type:Number,default:()=>0}},setup(f){const e=f;let b=l(""),i=l("all"),m=l(0);d(()=>e.activePurok,n=>{i.value=n},{immediate:!0}),d(()=>e.activeStatus,n=>{b.value=n},{immediate:!0}),d(()=>e.deceasedId,n=>{m.value=n},{immediate:!0});const g=["purok1","purok2","purok3","purok4"],v=n=>{S.get(route("collector.togglePurok",{status:b.value,purok:n,deceasedId:m.value}),{onSuccess:()=>console.log("changing purok"),onError:s=>console.log("An error occured: ",s)})},o=n=>`Purok ${n.replace("purok","")}`;return(n,s)=>(x(),M("div",ee,[t("div",null,[(x(),M(R,null,w(g,r=>t("span",{key:r,class:$(["mx-2 purok",{"fw-bold active":r===u(i)}]),onClick:c=>v(r)},y(o(r)),11,te)),64))])]))}},se=I(re,[["__scopeId","data-v-7d1eccef"]]),ae={class:"d-flex flex-column align-items-center",style:{height:"120px"}},oe={class:"d-flex align-items-center gap-4"},le={class:"fw-bold text-dark mb-0"},ne={__name:"Toggle",props:F({data:{type:Object,default:()=>({})},allDeceased:{type:Array,default:()=>[]},purok:{type:String,default:()=>""}},{deceased:{},deceasedModifiers:{}}),emits:["update:deceased"],setup(f){const e=f,b=l(e.data.report_id??null);l(e.data.member_id??null);const i=j(f,"deceased"),m=P(()=>e.allDeceased.findIndex(s=>Number(s.report_id)===Number(b.value)));function g(s){var h;if(!e.allDeceased.length)return-1;const r=e.allDeceased.length,c=(h=e.allDeceased[s])==null?void 0:h.member_id;for(let p=1;p<=r;p++){const k=(s+p)%r,_=e.allDeceased[k];if(_&&String(_.member_id)!==String(c))return k}return-1}function v(s){var h;if(!e.allDeceased.length)return-1;const r=e.allDeceased.length,c=(h=e.allDeceased[s])==null?void 0:h.member_id;for(let p=1;p<=r;p++){const k=(s-p+r)%r,_=e.allDeceased[k];if(_&&String(_.member_id)!==String(c))return k}return-1}const o=()=>{const s=m.value;if(s===-1)return;const r=v(s);if(r===-1)return;const c=e.allDeceased[r];c&&S.get(route("collector.toggleDeceased",{id:c.member_id,purok:e.purok}),{},{preserveScroll:!0})},n=()=>{const s=m.value;if(s===-1)return;const r=g(s);if(r===-1)return;const c=e.allDeceased[r];c&&(i.value=c,console.log("deceased_id: ",c.member_id),console.log("deceased_id: ",e.purok),S.get(route("collector.toggleDeceased",{id:c.member_id,purok:e.purok}),{},{preserveScroll:!0}))};return(s,r)=>(x(),M("div",ae,[r[2]||(r[2]=t("h5",{class:"mb-3"},"This contribution belongs to:",-1)),t("div",oe,[t("button",{onClick:o,class:"btn btn-light rounded-circle shadow-sm"},r[0]||(r[0]=[t("i",{class:"bi bi-arrow-left fs-4"},null,-1)])),t("h5",le,y(e.data.deceased_name||"No name available"),1),t("button",{onClick:n,class:"btn btn-light rounded-circle shadow-sm"},r[1]||(r[1]=[t("i",{class:"bi bi-arrow-right fs-4"},null,-1)]))])]))}},de={key:0,class:"mt-3"},ie={class:"purok-container container-fluid d-flex justify-content-end align-items-center"},ce={class:"custom-modal"},ue={__name:"Index",props:{contributions:{type:Array,default:()=>[]},activePurok:{type:String,default:()=>"all"},activeStatus:{type:String,default:()=>"paid"},contributionsIds:{type:Array,default:()=>[]},members:{type:Array,default:()=>[]},currentDeceasedMembers:{type:Array,default:()=>[]},currentDeceasedMember:{type:Object,default:()=>({})}},setup(f){const e=f;let b=l([]),i=l("all"),m=l(0),g=l("paid"),v=l([]);const o=l([]),n=l([]),s=l({});d(()=>e.contributions,a=>{b.value=a,console.log("Updated contributions:",O(a)),m.value=parseInt(a.reduce((D,N)=>D+parseFloat(N.amount),0))},{immediate:!0}),d(()=>e.activePurok,a=>{i.value=a},{immediate:!0}),d(()=>e.activeStatus,a=>{g.value=a},{immediate:!0}),d(()=>e.contributionsIds,a=>{v.value=Array.isArray(a)?[...a]:[]},{immediate:!0}),d(()=>e.members,a=>{o.value=a},{immediate:!0}),d(()=>e.currentDeceasedMembers,a=>{n.value=a?Object.values(a):[]},{immediate:!0}),d(()=>e.currentDeceasedMember,a=>{s.value=a},{immediate:!0});const r=P(()=>o.value.filter(a=>v.value.includes(a.id)).length),c=P(()=>o.value.filter(a=>!v.value.includes(a.id)).length),h=P(()=>o.value.length),p=l(!1),k=()=>{p.value=!0,console.log("Report Modal Opened")},_=()=>p.value=!1;return(a,D)=>(x(),M("div",null,[C(u(U),{title:"Report"}),C(E,null,{default:V(()=>[D[0]||(D[0]=t("div",{class:"head container"},[t("h5",{class:"mb-0"},"Report"),t("p",{class:"d-none d-lg-block"},"Contribution Report")],-1)),s.value?(x(),M("div",de,[C(ne,{allDeceased:n.value,data:s.value,purok:u(i)},null,8,["allDeceased","data","purok"])])):A("",!0),t("div",{class:"action-buttons"},[t("button",{class:"btn btn-dark view-report",onClick:k},"View Reports")]),t("div",ie,[C(se,{activePurok:u(i),activeStatus:u(g),deceasedId:s.value.member_id},null,8,["activePurok","activeStatus","deceasedId"])]),C(Z,{membersCount:h.value,amount:Number(u(m)),activePurok:u(i),paidMembers:r.value,unpaidMembers:c.value},null,8,["membersCount","amount","activePurok","paidMembers","unpaidMembers"]),p.value?(x(),M("div",{key:1,class:"custom-modal-overlay",onClick:B(_,["self"])},[t("div",ce,[t("button",{class:"close-btn",onClick:_},"Ã—"),C(T,{deceased:s.value,purok:u(i)},null,8,["deceased","purok"])])])):A("",!0)]),_:1})]))}},_e=I(ue,[["__scopeId","data-v-3a616b8a"]]);export{_e as default};
